<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×“×™×§×ª ×§×•×œ ×¡×ª×™×• - ×™×©×™×¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9fafb;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 12px;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
            transition: all 0.3s;
        }
        button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .log {
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px solid #374151;
        }
        .log-entry.error {
            color: #ef4444;
        }
        .log-entry.success {
            color: #10b981;
        }
        .log-entry.info {
            color: #3b82f6;
        }
        .status {
            text-align: center;
            font-size: 24px;
            margin: 20px 0;
            padding: 15px;
            background: #f0fdf4;
            border-radius: 12px;
            border: 2px solid #10b981;
        }
        .instructions {
            background: #fef3c7;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #f59e0b;
            margin: 20px 0;
        }
        .instructions h3 {
            margin-top: 0;
            color: #92400e;
        }
        .instructions ul {
            margin: 10px 0;
            padding-right: 20px;
        }
        .instructions li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ ×‘×“×™×§×ª ×§×•×œ ×¡×ª×™×• ×”×¨×•×‘×•×˜×™</h1>
        
        <div class="instructions">
            <h3>ğŸ“‹ ×”×•×¨××•×ª:</h3>
            <ul>
                <li>×œ×—×¥ ×¢×œ ×”×›×¤×ª×•×¨ ×œ××˜×”</li>
                <li>×‘×“×•×§ ××ª ×”×œ×•×’×™× ×‘×§×•× ×¡×•×œ (F12)</li>
                <li>×”××–×Ÿ ×œ×§×•×œ - ×¦×¨×™×š ×œ×”×™×•×ª <strong>×¨×•×‘×•×˜×™, ××”×™×¨, ×•× ××•×š</strong></li>
                <li>×× ×–×” ×”×§×•×œ ×”× ×›×•×Ÿ - ×–×” ××•××¨ ×©×”×§×•×“ ×¢×•×‘×“!</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>ğŸ¯ ×‘×“×™×§×” ×™×©×™×¨×”</h2>
            <p>×–×” ×‘×“×™×•×§ ××•×ª×• ×§×•×“ ×©×‘-StavBot.svelte</p>
            <button id="testBtn" onclick="testStavVoice()">ğŸ”Š × ×’×Ÿ ×§×•×œ ×¡×ª×™×•</button>
            <button id="stopBtn" onclick="stopAudio()" disabled>â¹ï¸ ×¢×¦×•×¨</button>
        </div>

        <div class="status" id="status">
            ×œ×—×¥ ×¢×œ ×”×›×¤×ª×•×¨ ×›×“×™ ×œ×”×ª×—×™×œ
        </div>

        <div class="log" id="log"></div>
    </div>

    <script>
        let currentAudio = null;
        let isSpeaking = false;

        function addLog(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            
            // Also log to console
            console.log(message);
        }

        function updateStatus(message, emoji = 'ğŸ¤') {
            document.getElementById('status').textContent = `${emoji} ${message}`;
        }

        function stopAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
                isSpeaking = false;
                updateStatus('×”×•×¤×¡×§', 'â¹ï¸');
                addLog('â¹ï¸ Audio stopped by user', 'info');
                document.getElementById('testBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
            }
        }

        async function testStavVoice() {
            const testBtn = document.getElementById('testBtn');
            const stopBtn = document.getElementById('stopBtn');
            
            testBtn.disabled = true;
            stopBtn.disabled = false;
            
            // Clear previous logs
            document.getElementById('log').innerHTML = '';
            
            const text = '×”×™×™! ×× ×™ ×¡×ª×™×•. ×–×” ×”×§×•×œ ×”×¨×•×‘×•×˜×™ ×”××§×•×¨×™ ×©×œ×™ ××”××¢×¨×›×ª ×”×™×©× ×”. ×”×§×•×œ ×¦×¨×™×š ×œ×”×™×©××¢ ××”×™×¨, × ××•×š, ×•×¨×•×‘×•×˜×™.';
            
            addLog('ğŸ¤ [STAV] Starting TTS test...', 'info');
            addLog(`ğŸ“ Text: ${text.substring(0, 50)}...`, 'info');
            updateStatus('××ª×—×™×œ...', 'â³');
            
            try {
                const API_KEY = 'AIzaSyBexR71l9bdJ28OKx8P7QhyQDQpqTPa56o';
                const url = `https://texttospeech.googleapis.com/v1/text:synthesize?key=${API_KEY}`;
                
                addLog('ğŸ“¡ [STAV] Calling Google TTS API...', 'info');
                updateStatus('×§×•×¨× ×œ-Google TTS...', 'ğŸ“¡');
                
                const requestBody = {
                    input: { text: text },
                    voice: {
                        languageCode: 'he-IL',
                        name: 'he-IL-Wavenet-A',
                        ssmlGender: 'FEMALE'
                    },
                    audioConfig: {
                        audioEncoding: 'MP3',
                        pitch: -5.0,
                        speakingRate: 1.35,
                        volumeGainDb: 0.0,
                        effectsProfileId: ['small-bluetooth-speaker-class-device']
                    }
                };
                
                addLog(`ğŸ”§ Voice: ${requestBody.voice.name}`, 'info');
                addLog(`ğŸ”§ Pitch: ${requestBody.audioConfig.pitch}`, 'info');
                addLog(`ğŸ”§ Speed: ${requestBody.audioConfig.speakingRate}`, 'info');
                addLog(`ğŸ”§ Effects: ${requestBody.audioConfig.effectsProfileId[0]}`, 'info');
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                
                addLog(`ğŸ“¡ [STAV] Response status: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
                if (!response.ok) {
                    const errorText = await response.text();
                    addLog(`âŒ [STAV] HTTP Error: ${response.status} ${errorText}`, 'error');
                    updateStatus('×©×’×™××” ×‘-API', 'âŒ');
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const data = await response.json();
                addLog(`ğŸ“¦ [STAV] Response data keys: ${Object.keys(data).join(', ')}`, 'success');
                
                if (data.error) {
                    addLog(`âŒ [STAV] API Error: ${JSON.stringify(data.error)}`, 'error');
                    updateStatus('×©×’×™××” ×-Google', 'âŒ');
                    throw new Error(data.error.message || JSON.stringify(data.error));
                }
                
                if (!data.audioContent) {
                    addLog('âŒ [STAV] No audioContent in response', 'error');
                    updateStatus('××™×Ÿ ××•×“×™×•', 'âŒ');
                    throw new Error('No audio content received');
                }
                
                addLog(`âœ… [STAV] Got audio! Length: ${data.audioContent.length}`, 'success');
                updateStatus('×™×•×¦×¨ ××•×“×™×•...', 'ğŸµ');
                
                const audio = new Audio('data:audio/mp3;base64,' + data.audioContent);
                currentAudio = audio;
                isSpeaking = true;
                
                audio.onloadeddata = () => {
                    addLog(`âœ… [STAV] Audio loaded, duration: ${audio.duration.toFixed(2)}s`, 'success');
                    updateStatus('××•×“×™×• × ×˜×¢×Ÿ', 'âœ…');
                };
                
                audio.onplay = () => {
                    addLog('â–¶ï¸ [STAV] Audio playing...', 'success');
                    updateStatus('×× ×’×Ÿ ×¢×›×©×™×•! ğŸµ', 'â–¶ï¸');
                };
                
                audio.onended = () => {
                    addLog('âœ… [STAV] Audio finished', 'success');
                    updateStatus('×”×¡×ª×™×™× ×‘×”×¦×œ×—×”!', 'âœ…');
                    isSpeaking = false;
                    currentAudio = null;
                    testBtn.disabled = false;
                    stopBtn.disabled = true;
                };
                
                audio.onerror = (e) => {
                    addLog(`âŒ [STAV] Audio playback error: ${JSON.stringify(audio.error)}`, 'error');
                    updateStatus('×©×’×™××” ×‘× ×™×’×•×Ÿ', 'âŒ');
                    isSpeaking = false;
                    currentAudio = null;
                    testBtn.disabled = false;
                    stopBtn.disabled = true;
                };
                
                await audio.play();
                addLog('ğŸµ [STAV] Play() called successfully', 'success');
                
            } catch (error) {
                addLog(`âŒ [STAV] TTS Error: ${error.message}`, 'error');
                addLog(`âŒ [STAV] Error stack: ${error.stack}`, 'error');
                updateStatus('×©×’×™××”!', 'âŒ');
                isSpeaking = false;
                currentAudio = null;
                testBtn.disabled = false;
                stopBtn.disabled = true;
            }
        }

        // Add initial log
        addLog('âœ… Test page loaded successfully', 'success');
        addLog('ğŸ“‹ Ready to test Stav voice', 'info');
        addLog('ğŸ¯ This is the EXACT same code as StavBot.svelte', 'info');
    </script>
</body>
</html>
