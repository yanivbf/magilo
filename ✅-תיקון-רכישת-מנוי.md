# ✅ תיקון רכישת מנוי

## הבעיה שהייתה:
```
POST http://localhost:5173/api/subscription/activate-page 500 (Internal Server Error)
```

כשניסית לרכוש מנוי, קיבלת שגיאת 500.

## הסיבה:
1. ה-API ניסה לעדכן דף ב-Strapi עם `pageId` רגיל
2. Strapi 5 דורש `documentId` במקום ID מספרי
3. לא היה טיפול נכון במקרה שה-pageId הוא מספר

## התיקון:

### 1. עדכנו את `/api/subscription/activate-page`
- מקבל גם `pageId` וגם `documentId`
- אם מקבל רק `pageId`, קודם שולף את ה-`documentId` מ-Strapi
- משתמש ב-`documentId` לעדכון הדף
- יוצר/מעדכן רשומת subscription ב-Strapi

### 2. עדכנו את `/subscribe`
- שולח את הפרמטר כ-`documentId` (במקום `pageId`)
- מוסיף לוגים טובים יותר
- מציג הודעת שגיאה מפורטת

## איך זה עובד עכשיו:

### זרימה מלאה:
1. **בדשבורד** - לוחצים על "הפעל מנוי פרימיום"
2. **מועברים ל-`/subscribe?pageId=<documentId>`**
3. **בוחרים תוכנית** (חודשי/שנתי)
4. **לוחצים "הפעל מנוי"**
5. **API מקבל את ה-documentId**
6. **API מחפש את הדף ב-Strapi**
7. **API מעדכן את הדף:**
   - `subscriptionStatus: 'active'`
   - `subscriptionExpiry: <תאריך עתידי>`
8. **API יוצר/מעדכן רשומת subscription**
9. **מוצג הודעת הצלחה**
10. **מועבר חזרה לדשבורד**

## בדוק עכשיו:

1. פתח את הדשבורד: `http://localhost:5173/dashboard`
2. בחר דף שאין לו מנוי
3. לחץ על "הפעל מנוי פרימיום" (כפתור צהוב)
4. בחר תוכנית (חודשי ₪59 או שנתי ₪590)
5. לחץ "הפעל מנוי"
6. אמור לעבוד! ✅

## מה קורה אחרי הפעלת מנוי:

- הדף מקבל סטטוס `subscriptionStatus: 'active'`
- נקבע תאריך תפוגה (`subscriptionExpiry`)
- נוצרת רשומה בטבלת `subscriptions` ב-Strapi
- בדשבורד הדף יופיע עם תג "פרימיום" ירוק
- הכפתור ישתנה ל-"נהל מנוי"

## אם עדיין יש שגיאה:

### בדוק ב-Console:
```javascript
// אמור לראות:
📄 Activating subscription for page: <documentId>
✅ Page subscription activated: {...}
```

### אם יש שגיאה:
1. בדוק ש-Strapi רץ על פורט 1337
2. בדוק שיש `STRAPI_API_TOKEN` ב-`.env`
3. בדוק שהדף קיים ב-Strapi
4. בדוק את הלוגים של Strapi

## קבצים שעודכנו:

1. ✅ `new-app/src/routes/api/subscription/activate-page/+server.js`
   - תמיכה ב-documentId
   - שליפת documentId אם צריך
   - יצירת רשומת subscription

2. ✅ `new-app/src/routes/subscribe/+page.svelte`
   - שליחת documentId במקום pageId
   - לוגים משופרים
   - הודעות שגיאה מפורטות

---

**🎉 עכשיו רכישת מנוי אמורה לעבוד!**

נסה שוב לרכוש מנוי ותראה שזה עובד.
