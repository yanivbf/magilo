<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” ×œ××” ×”×§×•×œ ×œ× ×¢×•×‘×“ ×‘××¨×§×˜×¤×œ×™×™×¡?</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #667eea;
            margin-bottom: 20px;
        }
        .test-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px 5px;
            transition: all 0.3s;
        }
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .error {
            color: #ff4444;
        }
        .success {
            color: #00ff00;
        }
        .info {
            color: #00aaff;
        }
        .warning {
            color: #ffaa00;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ×œ××” ×”×§×•×œ ×œ× ×¢×•×‘×“ ×‘××¨×§×˜×¤×œ×™×™×¡?</h1>
        
        <p><strong>×‘×“×™×§×” ×–×• ×ª×¨××” ×œ×š ×‘×“×™×•×§ ××” ×§×•×¨×” ×›×©×× ×¡×™× ×œ×”×¤×¢×™×œ ××ª ×”×§×•×œ:</strong></p>
        
        <button class="test-btn" onclick="testGoogleTTS()">ğŸ¤ ×‘×“×•×§ ×§×•×œ Google TTS</button>
        <button class="test-btn" onclick="clearLog()">ğŸ—‘ï¸ × ×§×” ×œ×•×’</button>
        
        <div class="log" id="log">
ğŸ“‹ ×œ×•×’ ×™×•×¤×™×¢ ×›××Ÿ...
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString('he-IL');
            const className = type;
            logEl.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(`[${type.toUpperCase()}]`, message);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = 'ğŸ“‹ ×œ×•×’ × ×•×§×”...\n';
        }

        async function testGoogleTTS() {
            clearLog();
            log('ğŸš€ ××ª×—×™×œ ×‘×“×™×§×”...', 'info');
            
            const testText = '×©×œ×•×, ×× ×™ ×¡×ª×™×•';
            log(`ğŸ“ ×˜×§×¡×˜ ×œ×‘×“×™×§×”: "${testText}"`, 'info');
            
            // Clean text (same as in StavBot)
            const cleanText = testText
                .replace(/<[^>]*>/g, '')
                .replace(/&[^;]+;/g, '')
                .replace(/\*\*([^*]+)\*\*/g, '$1')
                .replace(/\[([^\]]+)\]\([^)]+\)/g, '$1')
                .replace(/[ğŸ˜ŠğŸ’¡ğŸ“ğŸ“ğŸ“§ğŸ ğŸ’°âœ…âŒğŸ”—ğŸ“„ğŸªğŸ‰ğŸ“ğŸ”§ğŸ‘ï¸ğŸ¯ğŸ”ğŸ“šğŸ“ğŸ”ŠğŸ¤ğŸ”´]/g, '')
                .replace(/\*\*/g, '')
                .replace(/\*/g, '')
                .replace(/\([^)]*\)/g, '')
                .replace(/\.{2,}/g, '')
                .replace(/\n\n+/g, '. ')
                .replace(/\n/g, '. ')
                .replace(/â€¢/g, '')
                .replace(/\|/g, '')
                .replace(/\s+/g, ' ')
                .trim();
            
            log(`ğŸ§¹ ×˜×§×¡×˜ ××—×¨×™ × ×™×§×•×™: "${cleanText}"`, 'info');
            
            try {
                const API_KEY = 'AIzaSyBexR71l9bdJ28OKx8P7QhyQDQpqTPa56o';
                log('ğŸ”‘ API Key: ' + API_KEY.substring(0, 20) + '...', 'info');
                
                const url = `https://texttospeech.googleapis.com/v1/text:synthesize?key=${API_KEY}`;
                log('ğŸŒ URL: ' + url.substring(0, 60) + '...', 'info');
                
                const requestBody = {
                    input: { text: cleanText },
                    voice: {
                        languageCode: 'he-IL',
                        name: 'he-IL-Wavenet-A',
                        ssmlGender: 'FEMALE'
                    },
                    audioConfig: {
                        audioEncoding: 'MP3',
                        pitch: -5.0,
                        speakingRate: 1.35,
                        volumeGainDb: 0.0,
                        effectsProfileId: ['small-bluetooth-speaker-class-device']
                    }
                };
                
                log('ğŸ“¦ Request Body:', 'info');
                log(JSON.stringify(requestBody, null, 2), 'info');
                
                log('â³ ×©×•×œ×— ×‘×§×©×” ×œ-Google TTS API...', 'warning');
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });
                
                log(`ğŸ“¡ Response Status: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                log(`ğŸ“‹ Response Headers:`, 'info');
                for (const [key, value] of response.headers.entries()) {
                    log(`   ${key}: ${value}`, 'info');
                }
                
                const data = await response.json();
                
                if (data.error) {
                    log('âŒ ×©×’×™××” ×-Google TTS:', 'error');
                    log(JSON.stringify(data.error, null, 2), 'error');
                    throw new Error(data.error.message);
                }
                
                if (data.audioContent) {
                    log('âœ… ×”×ª×§×‘×œ ××•×“×™×• ×-Google TTS!', 'success');
                    log(`ğŸ“Š ×’×•×“×œ ××•×“×™×• (base64): ${data.audioContent.length} ×ª×•×•×™×`, 'success');
                    
                    log('ğŸ”Š ×× ×¡×” ×œ× ×’×Ÿ...', 'warning');
                    const audio = new Audio('data:audio/mp3;base64,' + data.audioContent);
                    
                    audio.onloadeddata = () => {
                        log('âœ… ×”××•×“×™×• × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”!', 'success');
                        log(`â±ï¸ ××©×š: ${audio.duration.toFixed(2)} ×©× ×™×•×ª`, 'info');
                    };
                    
                    audio.onplay = () => {
                        log('â–¶ï¸ ×”××•×“×™×• ××ª×—×™×œ ×œ× ×’×Ÿ...', 'success');
                    };
                    
                    audio.onended = () => {
                        log('âœ… ×”××•×“×™×• ×”×¡×ª×™×™×!', 'success');
                        log('ğŸ‰ ×”×‘×“×™×§×” ×”×¦×œ×™×—×”! ×”×§×•×œ ×¢×•×‘×“ ××•×©×œ×!', 'success');
                    };
                    
                    audio.onerror = (e) => {
                        log('âŒ ×©×’×™××” ×‘× ×™×’×•×Ÿ ×”××•×“×™×•:', 'error');
                        log(JSON.stringify(e, null, 2), 'error');
                    };
                    
                    await audio.play();
                    log('ğŸµ ×”×§×•×œ ×× ×’×Ÿ ×¢×›×©×™×•...', 'success');
                    
                } else {
                    log('âŒ ×œ× ×”×ª×§×‘×œ ×ª×•×›×Ÿ ××•×“×™×•', 'error');
                    log('Response:', 'error');
                    log(JSON.stringify(data, null, 2), 'error');
                }
                
            } catch (error) {
                log('âŒ ×©×’×™××” ×›×œ×œ×™×ª:', 'error');
                log(`   ×©×: ${error.name}`, 'error');
                log(`   ×”×•×“×¢×”: ${error.message}`, 'error');
                log(`   Stack: ${error.stack}`, 'error');
                
                if (error.message.includes('CORS')) {
                    log('âš ï¸ ×–×• ×©×’×™××ª CORS - ×”×“×¤×“×¤×Ÿ ×—×•×¡× ××ª ×”×‘×§×©×”', 'warning');
                } else if (error.message.includes('quota')) {
                    log('âš ï¸ ×—×¨×™×’×” ××”××›×¡×” ×©×œ Google TTS', 'warning');
                } else if (error.message.includes('API key')) {
                    log('âš ï¸ ×‘×¢×™×” ×¢× ×”-API Key', 'warning');
                }
            }
        }

        log('âœ… ×“×£ ×”×‘×“×™×§×” ××•×›×Ÿ!', 'success');
        log('ğŸ‘‰ ×œ×—×¥ ×¢×œ "×‘×“×•×§ ×§×•×œ Google TTS" ×›×“×™ ×œ×”×ª×—×™×œ', 'info');
    </script>
</body>
</html>
