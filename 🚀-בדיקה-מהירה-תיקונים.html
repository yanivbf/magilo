<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ ×‘×“×™×§×” ××”×™×¨×” - ×ª×™×§×•× ×™×</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f8ff;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 5px solid;
        }
        .success {
            background: #e8f5e8;
            border-color: #4caf50;
            color: #2e7d32;
        }
        .error {
            background: #ffebee;
            border-color: #f44336;
            color: #c62828;
        }
        .warning {
            background: #fff3e0;
            border-color: #ff9800;
            color: #ef6c00;
        }
        .info {
            background: #e3f2fd;
            border-color: #2196f3;
            color: #1565c0;
        }
        button {
            background: linear-gradient(45deg, #2196f3, #21cbf3);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            margin: 8px;
            font-weight: bold;
            transition: all 0.3s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }
        .urgent {
            background: linear-gradient(45deg, #ff5722, #ff9800);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        .progress {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #4caf50, #8bc34a);
            transition: width 0.5s;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ ×‘×“×™×§×” ××”×™×¨×” - ×ª×™×§×•× ×™×</h1>
        
        <div class="info">
            <h3>ğŸ“Š ×¡×˜×˜×•×¡ ×›×œ×œ×™</h3>
            <div class="progress">
                <div class="progress-bar" id="overallProgress" style="width: 0%"></div>
            </div>
            <p id="overallStatus">××ª×—×™×œ ×‘×“×™×§×•×ª...</p>
        </div>

        <div class="grid">
            <div class="card">
                <h3>ğŸ” ×‘×“×™×§×ª ××™××•×ª</h3>
                <div id="authStatus" class="status info">×‘×•×“×§...</div>
                <button onclick="testAuth()">×‘×“×•×§ ××™××•×ª</button>
                <button onclick="fixAuth()" class="urgent">×ª×§×Ÿ ××™××•×ª</button>
            </div>

            <div class="card">
                <h3>ğŸª ×‘×“×™×§×ª Cookies</h3>
                <div id="cookieStatus" class="status info">×‘×•×“×§...</div>
                <button onclick="testCookies()">×‘×“×•×§ Cookies</button>
                <button onclick="fixCookies()" class="urgent">×ª×§×Ÿ Cookies</button>
            </div>

            <div class="card">
                <h3>ğŸ’¾ ×‘×“×™×§×ª localStorage</h3>
                <div id="localStorageStatus" class="status info">×‘×•×“×§...</div>
                <button onclick="testLocalStorage()">×‘×“×•×§ localStorage</button>
                <button onclick="fixLocalStorage()" class="urgent">×ª×§×Ÿ localStorage</button>
            </div>

            <div class="card">
                <h3>ğŸ”— ×‘×“×™×§×ª Google OAuth</h3>
                <div id="googleStatus" class="status info">×‘×•×“×§...</div>
                <button onclick="testGoogle()">×‘×“×•×§ Google</button>
                <button onclick="fixGoogle()" class="urgent">×ª×§×Ÿ Google</button>
            </div>
        </div>

        <div class="status warning">
            <h3>âš¡ ×¤×¢×•×œ×•×ª ××”×™×¨×•×ª</h3>
            <button onclick="runAllTests()">×‘×“×•×§ ×”×›×œ</button>
            <button onclick="fixAllIssues()" class="urgent">×ª×§×Ÿ ×”×›×œ</button>
            <button onclick="resetEverything()" class="urgent">××™×¤×•×¡ ××œ×</button>
            <button onclick="goToDashboard()">×œ×š ×œ×“×©×‘×•×¨×“</button>
        </div>

        <div id="detailedResults"></div>
    </div>

    <script>
        let testsCompleted = 0;
        const totalTests = 4;

        function updateProgress() {
            const progress = (testsCompleted / totalTests) * 100;
            document.getElementById('overallProgress').style.width = progress + '%';
            document.getElementById('overallStatus').textContent = 
                `×”×•×©×œ××• ${testsCompleted} ××ª×•×š ${totalTests} ×‘×“×™×§×•×ª (${Math.round(progress)}%)`;
        }

        function setStatus(elementId, type, message) {
            const element = document.getElementById(elementId);
            element.className = `status ${type}`;
            element.textContent = message;
        }

        async function testAuth() {
            setStatus('authStatus', 'info', '×‘×•×“×§ ××™××•×ª...');
            
            try {
                // ×‘×“×•×§ cookie
                const cookies = document.cookie;
                const userIdMatch = cookies.match(/userId=([^;]+)/);
                const userId = userIdMatch ? userIdMatch[1] : null;
                
                if (userId) {
                    // ×‘×“×•×§ ×¢× ×”×©×¨×ª
                    const response = await fetch('/api/user/current');
                    if (response.ok) {
                        const data = await response.json();
                        setStatus('authStatus', 'success', `âœ… ××—×•×‘×¨: ${data.name || userId}`);
                    } else {
                        setStatus('authStatus', 'warning', `âš ï¸ Cookie ×§×™×™× ××‘×œ ×©×¨×ª ×œ× ××–×”×”: ${userId}`);
                    }
                } else {
                    setStatus('authStatus', 'error', 'âŒ ×œ× ××—×•×‘×¨ - ××™×Ÿ userId');
                }
            } catch (error) {
                setStatus('authStatus', 'error', `âŒ ×©×’×™××”: ${error.message}`);
            }
            
            testsCompleted++;
            updateProgress();
        }

        function testCookies() {
            setStatus('cookieStatus', 'info', '×‘×•×“×§ cookies...');
            
            try {
                // × ×¡×” ×œ×™×¦×•×¨ cookie
                document.cookie = 'test=value; path=/';
                
                // ×‘×“×•×§ ×× × ×•×¦×¨
                if (document.cookie.includes('test=value')) {
                    const cookies = document.cookie.split(';').length;
                    setStatus('cookieStatus', 'success', `âœ… Cookies ×¢×•×‘×“×™× (${cookies} cookies)`);
                } else {
                    setStatus('cookieStatus', 'error', 'âŒ ×œ× ×™×›×•×œ ×œ×™×¦×•×¨ cookies');
                }
            } catch (error) {
                setStatus('cookieStatus', 'error', `âŒ ×©×’×™××” ×‘cookies: ${error.message}`);
            }
            
            testsCompleted++;
            updateProgress();
        }

        function testLocalStorage() {
            setStatus('localStorageStatus', 'info', '×‘×•×“×§ localStorage...');
            
            try {
                localStorage.setItem('test', 'value');
                const value = localStorage.getItem('test');
                localStorage.removeItem('test');
                
                if (value === 'value') {
                    setStatus('localStorageStatus', 'success', 'âœ… localStorage ×¢×•×‘×“ ×ª×§×™×Ÿ');
                } else {
                    setStatus('localStorageStatus', 'error', 'âŒ localStorage ×œ× ×¢×•×‘×“');
                }
            } catch (error) {
                setStatus('localStorageStatus', 'error', `âŒ localStorage ×—×¡×•×: ${error.message}`);
            }
            
            testsCompleted++;
            updateProgress();
        }

        function testGoogle() {
            setStatus('googleStatus', 'info', '×‘×•×“×§ Google OAuth...');
            
            const currentUrl = window.location.origin;
            const expectedUrls = [
                'http://localhost:3000',
                'http://localhost:5173',
                'http://localhost:5174',
                'http://localhost:5175'
            ];
            
            if (expectedUrls.includes(currentUrl)) {
                setStatus('googleStatus', 'success', `âœ… ×¤×•×¨×˜ ××•×’×“×¨: ${currentUrl}`);
            } else {
                setStatus('googleStatus', 'error', `âŒ ×¤×•×¨×˜ ×œ× ××•×’×“×¨: ${currentUrl}`);
            }
            
            testsCompleted++;
            updateProgress();
        }

        function fixAuth() {
            const tempUserId = 'temp_' + Date.now();
            document.cookie = `userId=${tempUserId}; path=/; max-age=3600`;
            setStatus('authStatus', 'success', `âœ… ×”×•×’×“×¨ ××©×ª××© ×–×× ×™: ${tempUserId}`);
            
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        }

        function fixCookies() {
            try {
                // × ×§×” cookies ×™×©× ×™×
                document.cookie.split(";").forEach(function(c) { 
                    document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                });
                
                // ×¦×•×¨ cookie ×—×“×©
                const userId = 'user_' + Date.now();
                document.cookie = `userId=${userId}; path=/; max-age=86400`;
                
                setStatus('cookieStatus', 'success', 'âœ… Cookies ×ª×•×§× ×•');
            } catch (error) {
                setStatus('cookieStatus', 'error', `âŒ ×©×’×™××” ×‘×ª×™×§×•×Ÿ: ${error.message}`);
            }
        }

        function fixLocalStorage() {
            try {
                localStorage.clear();
                setStatus('localStorageStatus', 'success', 'âœ… localStorage × ×•×§×”');
            } catch (error) {
                setStatus('localStorageStatus', 'warning', 'âš ï¸ localStorage ×œ× ×–××™×Ÿ - × ×©×ª××© ×¨×§ ×‘cookies');
            }
        }

        function fixGoogle() {
            const currentPort = window.location.port || '80';
            const googleConsoleUrl = 'https://console.developers.google.com/apis/credentials';
            
            alert(`
ğŸ”§ ×ª×™×§×•×Ÿ Google OAuth:

1. ×¤×ª×—: ${googleConsoleUrl}
2. ×”×•×¡×£ ××ª ×”×›×ª×•×‘×•×ª:
   â€¢ JavaScript origins: ${window.location.origin}
   â€¢ Redirect URIs: ${window.location.origin}/api/auth/google

3. ×©××•×¨ ×•×‘×“×•×§ ×©×•×‘
            `);
            
            window.open(googleConsoleUrl, '_blank');
            setStatus('googleStatus', 'warning', 'âš ï¸ ×¢×“×›×Ÿ ×‘-Google Console ×•×‘×“×•×§ ×©×•×‘');
        }

        async function runAllTests() {
            testsCompleted = 0;
            updateProgress();
            
            await testAuth();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testCookies();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testLocalStorage();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testGoogle();
        }

        function fixAllIssues() {
            fixAuth();
            fixCookies();
            fixLocalStorage();
            
            alert('âœ… ×›×œ ×”×ª×™×§×•× ×™× ×”×•×¤×¢×œ×•! ×”×“×£ ×™×ª×¨×¢× ×Ÿ...');
            setTimeout(() => {
                window.location.reload();
            }, 2000);
        }

        function resetEverything() {
            if (confirm('âš ï¸ ×”×× ××ª×” ×‘×˜×•×— ×©××ª×” ×¨×•×¦×” ×œ××¤×¡ ×”×›×œ?')) {
                try {
                    // × ×§×” localStorage
                    localStorage.clear();
                    
                    // × ×§×” sessionStorage
                    sessionStorage.clear();
                    
                    // × ×§×” cookies
                    document.cookie.split(";").forEach(function(c) { 
                        document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
                    });
                    
                    alert('âœ… ×”×›×œ × ×•×§×”! ×”×“×£ ×™×ª×¨×¢× ×Ÿ...');
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } catch (error) {
                    alert('âŒ ×©×’×™××” ×‘××™×¤×•×¡: ' + error.message);
                }
            }
        }

        function goToDashboard() {
            window.location.href = '/dashboard';
        }

        // ×”×¤×¢×œ ×‘×“×™×§×•×ª ××•×˜×•××˜×™×•×ª ×‘×˜×¢×™× ×ª ×”×“×£
        window.onload = function() {
            setTimeout(runAllTests, 1000);
        };
    </script>
</body>
</html>