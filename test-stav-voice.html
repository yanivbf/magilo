<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤ ×‘×“×™×§×ª ×§×•×œ ×¡×ª×™×•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9fafb;
            border-radius: 12px;
        }
        
        .test-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
            margin-bottom: 15px;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            width: 100%;
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .status {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
        }
        
        .status.success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status.error {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status.info {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .quick-tests {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }
        
        .quick-tests button {
            padding: 10px;
            font-size: 14px;
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .info-box {
            background: #eff6ff;
            border-right: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .info-box h4 {
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .info-box p {
            color: #1e40af;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ ×‘×“×™×§×ª ×§×•×œ ×¡×ª×™×•</h1>
        <p class="subtitle">×‘×“×•×§ ××ª ×”×§×•×œ ×”××§×•×¨×™ ×©×œ ×¡×ª×™×• ×¢× Google TTS</p>
        
        <div class="info-box">
            <h4>ğŸ“‹ ×”×’×“×¨×•×ª ×”×§×•×œ:</h4>
            <p>
                <strong>×§×•×œ:</strong> he-IL-Wavenet-A (× ×©×™, ××™×›×•×ª ×’×‘×•×”×”)<br>
                <strong>Pitch:</strong> 0 (×˜×‘×¢×™)<br>
                <strong>Speaking Rate:</strong> 1.1 (×§×¦×ª ××”×™×¨)
            </p>
        </div>
        
        <div class="test-section">
            <h3>âœï¸ ×˜×§×¡×˜ ××•×ª×× ××™×©×™×ª</h3>
            <textarea id="customText" placeholder="×”×§×œ×“ ×›××Ÿ ×˜×§×¡×˜ ×œ×‘×“×™×§×”...">×©×œ×•×! ×× ×™ ×¡×ª×™×•, ×”×¢×•×–×¨×ª ×”×•×•×™×¨×˜×•××œ×™×ª ×©×œ×š. ×× ×™ ×›××Ÿ ×œ×¢×–×•×¨ ×œ×š ×œ××¦×•× ××ª ×”×“×£ ×”××•×©×œ×!</textarea>
            <button id="speakCustom" onclick="speakCustom()">
                <span id="customIcon">ğŸ”Š</span>
                <span id="customText">×”×§×¨× ×˜×§×¡×˜</span>
            </button>
            <div id="customStatus"></div>
        </div>
        
        <div class="test-section">
            <h3>âš¡ ×‘×“×™×§×•×ª ××”×™×¨×•×ª</h3>
            <div class="quick-tests">
                <button onclick="speakQuick('×”×™×™! ×× ×™ ×¡×ª×™×• ğŸ‘‹')">×‘×¨×›×” ×§×¦×¨×”</button>
                <button onclick="speakQuick('×× ×™ ×™×›×•×œ×” ×œ×¢×–×•×¨ ×œ×š ×œ××¦×•× ××¡×¤×¨×”, ×—× ×•×ª, ××• ×›×œ ×¢×¡×§ ××—×¨')">×—×™×¤×•×© ×¢×¡×§×™×</button>
                <button onclick="speakQuick('××¦××ª×™ 5 ×ª×•×¦××•×ª ××ª××™××•×ª ×‘×ª×œ ××‘×™×‘')">×ª×•×¦××•×ª ×—×™×¤×•×©</button>
                <button onclick="speakQuick('×”×× ×ª×¨×¦×” ×œ×¨××•×ª ×¢×•×“ ××¤×©×¨×•×™×•×ª?')">×©××œ×”</button>
            </div>
        </div>
    </div>
    
    <script>
        let currentAudio = null;
        
        async function speakCustom() {
            const text = document.getElementById('customText').value.trim();
            if (!text) {
                showStatus('customStatus', 'error', '× × ×œ×”×–×™×Ÿ ×˜×§×¡×˜');
                return;
            }
            
            await speak(text, 'customStatus', 'customIcon', 'customText');
        }
        
        async function speakQuick(text) {
            await speak(text, 'customStatus', 'customIcon', 'customText');
        }
        
        async function speak(text, statusId, iconId, textId) {
            // Stop current audio if playing
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
                resetButton(iconId, textId);
                return;
            }
            
            const statusEl = document.getElementById(statusId);
            const iconEl = document.getElementById(iconId);
            const textEl = document.getElementById(textId);
            
            // Show loading
            iconEl.innerHTML = '<span class="spinner"></span>';
            textEl.textContent = '××™×™×¦×¨ ×§×•×œ...';
            showStatus(statusId, 'info', '×©×•×œ×— ×‘×§×©×” ×œ-Google TTS...');
            
            try {
                const response = await fetch('http://localhost:5177/api/tts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ text })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const contentType = response.headers.get('content-type');
                
                if (contentType && contentType.includes('audio')) {
                    // Success - play audio
                    const audioBlob = await response.blob();
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const audio = new Audio(audioUrl);
                    
                    currentAudio = audio;
                    
                    iconEl.textContent = 'â¸ï¸';
                    textEl.textContent = '×¢×¦×•×¨';
                    showStatus(statusId, 'success', 'âœ… ×× ×’×Ÿ ×§×•×œ...');
                    
                    audio.onended = () => {
                        currentAudio = null;
                        URL.revokeObjectURL(audioUrl);
                        resetButton(iconId, textId);
                        showStatus(statusId, 'success', 'âœ… ×”×¡×ª×™×™×!');
                    };
                    
                    audio.onerror = () => {
                        currentAudio = null;
                        URL.revokeObjectURL(audioUrl);
                        resetButton(iconId, textId);
                        showStatus(statusId, 'error', 'âŒ ×©×’×™××” ×‘× ×™×’×•×Ÿ');
                    };
                    
                    await audio.play();
                } else {
                    // Fallback to browser TTS
                    const data = await response.json();
                    if (data.fallback) {
                        showStatus(statusId, 'info', 'âš ï¸ ××©×ª××© ×‘×§×•×œ ×”×“×¤×“×¤×Ÿ (××™×Ÿ API Key)');
                        useBrowserTTS(text);
                        resetButton(iconId, textId);
                    } else {
                        throw new Error(data.error || 'Unknown error');
                    }
                }
                
            } catch (error) {
                console.error('TTS Error:', error);
                showStatus(statusId, 'error', `âŒ ×©×’×™××”: ${error.message}`);
                resetButton(iconId, textId);
            }
        }
        
        function useBrowserTTS(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'he-IL';
                utterance.rate = 0.9;
                utterance.pitch = 1.1;
                window.speechSynthesis.speak(utterance);
            }
        }
        
        function resetButton(iconId, textId) {
            document.getElementById(iconId).textContent = 'ğŸ”Š';
            document.getElementById(textId).textContent = '×”×§×¨× ×˜×§×¡×˜';
        }
        
        function showStatus(id, type, message) {
            const el = document.getElementById(id);
            el.className = `status ${type}`;
            el.textContent = message;
            el.style.display = 'block';
        }
    </script>
</body>
</html>
