# ✅ עריכה ישירה בדף הצפייה

## מה עשינו?

### 1. שינוי ההפניה אחרי יצירת דף
**לפני:** הדף הפנה ל-`/pages/[slug]` (דף ביניים עם 2 כפתורים)  
**אחרי:** הדף מפנה ישירות ל-`/view/[slug]` (הדף המלא)

**קובץ:** `new-app/src/routes/api/create-structured-page/+server.js`
```javascript
pageUrl: `/view/${slug}` // Redirect directly to view page
```

### 2. הוספת בדיקת בעלות בדף הצפייה
**קובץ:** `new-app/src/routes/view/[slug]/+page.server.js`

הוספנו:
- קבלת `locals` מה-load function
- בדיקה אם המשתמש הנוכחי הוא הבעלים של הדף
- החזרת `isOwner: true/false` ל-component

```javascript
const currentUserId = locals.user?.id || locals.userId;
const pageOwnerId = attrs.user?.data?.id || attrs.user?.id || attrs.userId;
const isOwner = currentUserId && pageOwnerId && String(currentUserId) === String(pageOwnerId);
```

### 3. הוספת כפתורי עריכה לדף הצפייה
**קובץ:** `new-app/src/routes/view/[slug]/+page.svelte`

הוספנו סרגל עריכה צף עם 2 כפתורים (רק אם `isOwner === true`):
- **ערוך דף** - מפנה ל-`/manage/[pageId]` (ממשק ניהול מלא)
- **דשבורד** - מפנה ל-`/dashboard` (רשימת כל הדפים)

```svelte
{#if data.isOwner}
	<div class="edit-toolbar">
		<a href="/manage/{data.page.id}" class="toolbar-btn">
			ערוך דף
		</a>
		<a href="/dashboard" class="toolbar-btn secondary">
			דשבורד
		</a>
	</div>
{/if}
```

## התוצאה

### תהליך יצירת דף חדש:
1. ✅ משתמש יוצר דף ב-`/page-creator`
2. ✅ הדף נשמר ב-Strapi עם מקטעים ומוצרים
3. ✅ הפניה אוטומטית ל-`/view/[slug]` - הדף המלא
4. ✅ סרגל עריכה צף מופיע למעלה (כי המשתמש הוא הבעלים)
5. ✅ לחיצה על "ערוך דף" מפנה לממשק ניהול מלא
6. ✅ משתמשים אחרים רואים את הדף ללא כפתורי עריכה

### מצבי תצוגה:
- **בעל הדף:** רואה את הדף + סרגל עריכה צף
- **משתמשים אחרים:** רואים רק את הדף (ללא כפתורי עריכה)

## קבצים ששונו
1. `new-app/src/routes/api/create-structured-page/+server.js` - שינוי ההפניה
2. `new-app/src/routes/view/[slug]/+page.server.js` - הוספת בדיקת בעלות
3. `new-app/src/routes/view/[slug]/+page.svelte` - הוספת כפתורי עריכה

## בדיקה
נסה ליצור חנות חדשה ב-`http://localhost:5173/page-creator` ותראה:
1. הדף נפתח אוטומטית עם כל המקטעים
2. סרגל עריכה צף מופיע למעלה
3. לחיצה על "ערוך דף" מפנה לממשק ניהול
