# ✅ תיקון תצוגה ציבורית + מנוי לכל דף - הושלם

## מה תוקן?

### 1. תצוגה ציבורית נקייה ב-`/view/[slug]`
**בעיה:** כפתורי "החלף תמונה" ו"שמור" הופיעו בתצוגה הציבורית  
**תיקון:** הוסרו כל כפתורי העריכה מהתצוגה הציבורית

**שינויים:**
- הוסרו כפתורי "החלף תמונה" ו"שמור" מ-Hero Section
- `editMode` שונה ל-`false` בתצוגה הציבורית
- התצוגה עכשיו **לקריאה בלבד** - אתר מוגמר

---

### 2. מנוי לכל דף בנפרד (לא למשתמש)
**בעיה:** המנוי היה למשתמש ולא לדף ספציפי  
**תיקון:** כל דף עכשיו יכול להיות עם מנוי משלו

**שינויים:**

#### א. דשבורד - תצוגת סטטוס לפי דף
```javascript
// לפני: data.subscriptionStatus (למשתמש)
// אחרי: page.subscriptionStatus (לכל דף)

{#if page.subscriptionStatus === 'active'}
    <div>⚡ פעיל</div>
{:else}
    <div>⏳ ממתין</div>
{/if}
```

#### ב. כפתור הפעלת מנוי - לדף ספציפי
```javascript
// לפני: goto('/subscribe')
// אחרי: goto(`/subscribe?pageId=${page.documentId}`)

onclick={() => {
    console.log('🎯 Activating subscription for page:', page.documentId);
    goto(`/subscribe?pageId=${page.documentId || page.id}`);
}}
```

#### ג. דף מנוי - מקבל pageId
```javascript
// קורא pageId מה-URL
const urlParams = new URLSearchParams(window.location.search);
pageId = urlParams.get('pageId') || '';

// שולח ל-API החדש
fetch('/api/subscription/activate-page', {
    method: 'POST',
    body: JSON.stringify({ pageId, months })
});
```

#### ד. API חדש - `/api/subscription/activate-page`
```javascript
// מעדכן את הדף ב-Strapi עם מנוי
PUT /api/pages/${pageId}
{
    data: {
        subscriptionStatus: 'active',
        subscriptionExpiry: expiryDate.toISOString()
    }
}
```

---

## מבנה המערכת

### מסלולי דפים:

1. **`/view/[slug]`** - תצוגה ציבורית
   - ✅ ללא כפתורי עריכה
   - ✅ ללא כפתור שמירה
   - ✅ רק תוכן לקריאה
   - **זה מה שנפתח כשלוחצים "צפה"**

2. **`/pages/[slug]`** - מועבר אוטומטית ל-`/view/[slug]`
   - הפניה מיידית בצד השרת

3. **`/edit/[slug]`** או **Page Creator** - מצב עריכה
   - עם כלי עריכה מלאים
   - **זה מה שנפתח כשלוחצים "ערוך"**

---

### מנוי לדף:

```
משתמש
  ├── דף 1 (מנוי פעיל עד 01/01/2026)
  ├── דף 2 (ללא מנוי)
  └── דף 3 (מנוי פעיל עד 15/02/2026)
```

**כל דף יכול להיות:**
- ⚡ **פעיל** - עם מנוי Premium
- ⏳ **ממתין** - ללא מנוי

---

## קבצים ששונו

### 1. Frontend
- `new-app/src/routes/view/[slug]/+page.svelte` - הסרת כפתורי עריכה
- `new-app/src/routes/dashboard/+page.svelte` - מנוי לפי דף
- `new-app/src/routes/subscribe/+page.svelte` - קבלת pageId

### 2. Backend
- `new-app/src/routes/api/subscription/activate-page/+server.js` - API חדש
- `new-app/src/routes/dashboard/+page.server.js` - מחזיר subscriptionStatus לכל דף

---

## בדיקה

### 1. תצוגה ציבורית:
1. פתח דשבורד: http://localhost:5173/dashboard
2. לחץ "צפה" על דף
3. **תוצאה:** אתר מוגמר ללא כפתורי עריכה ✅

### 2. מנוי לדף:
1. פתח דשבורד
2. לחץ "הפעל מנוי לדף זה" על דף ספציפי
3. **תוצאה:** נפתח `/subscribe?pageId=xxx`
4. לחץ "הפעל מנוי"
5. **תוצאה:** רק הדף הזה מקבל מנוי פעיל ✅

### 3. דפים שונים - מנויים שונים:
1. צור 2 דפים
2. הפעל מנוי רק לדף אחד
3. **תוצאה:** 
   - דף 1: ⚡ פעיל
   - דף 2: ⏳ ממתין

---

## סיכום

✅ תצוגה ציבורית נקייה ללא כפתורי עריכה  
✅ מנוי לכל דף בנפרד (לא למשתמש)  
✅ כל דף עם סטטוס מנוי משלו  
✅ כפתור "הפעל מנוי" מפנה לדף ספציפי  
✅ API חדש לעדכון מנוי לדף  

**המערכת מוכנה לשימוש!** 🎉
