<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoPage - ×“×£ ×›× ×™×¡×”</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Rubik', sans-serif;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #4f46e5;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top-color: #4f46e5;
            animation: spin 1s ease-in-out infinite;
        }
        
        .loading-dots {
            display: inline-block;
        }
        
        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
        
        /* Generation Loading Animation Styles */
        .gen-loader {
            width: 60px; 
            height: 60px;
            border-radius: 50%;
            perspective: 800px;
            margin: 0 auto 20px;
        }
        
        .gen-loader .inner {
            position: absolute;
            box-sizing: border-box;
            width: 100%; 
            height: 100%;
            border-radius: 50%;
        }
        
        .gen-loader .inner.one {
            left: 0%; 
            top: 0%;
            animation: rotate-one 1.5s linear infinite;
            border-bottom: 3px solid #8b5cf6;
        }
        
        .gen-loader .inner.two {
            right: 0%; 
            top: 0%;
            animation: rotate-two 1.5s linear infinite;
            border-right: 3px solid #ec4899;
        }
        
        .gen-loader .inner.three {
            right: 0%; 
            bottom: 0%;
            animation: rotate-three 1.5s linear infinite;
            border-top: 3px solid #3b82f6;
        }
        
        @keyframes rotate-one { 
            0% { transform: rotateX(35deg) rotateY(-45deg) rotateZ(0deg); } 
            100% { transform: rotateX(35deg) rotateY(-45deg) rotateZ(360deg); } 
        }
        
        @keyframes rotate-two { 
            0% { transform: rotateX(50deg) rotateY(10deg) rotateZ(0deg); } 
            100% { transform: rotateX(50deg) rotateY(10deg) rotateZ(360deg); } 
        }
        
        @keyframes rotate-three { 
            0% { transform: rotateX(35deg) rotateY(55deg) rotateZ(0deg); } 
            100% { transform: rotateX(35deg) rotateY(55deg) rotateZ(360deg); } 
        }
        
        .gen-text {
            text-align: center;
            font-weight: 500;
            color: #6b7280;
            margin-top: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .debug {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            text-align: right;
            max-height: 150px;
            overflow-y: auto;
            word-break: break-all;
        }
        .project-saved-indicator {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            animation: slideInRight 0.3s ease-out;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .status-badge {
            display: inline-block;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
        }

        /* Tooltip styles */
        [data-tooltip] {
            position: relative;
        }
        
        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
            z-index: 1000;
            margin-bottom: 5px;
            animation: fadeIn 0.2s ease-in-out;
        }
        
        [data-tooltip]:hover::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 4px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            margin-bottom: 1px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-50%) translateY(5px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        .status-completed {
            background-color: #d1fae5;
            color: #065f46;
        }
        .status-processing {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        /* Dropdown Menu Styles */
        .dropdown-menu {
            min-width: 180px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        .dropdown-menu.show {
            display: block;
            animation: dropdownFadeIn 0.2s ease-out;
        }
        @keyframes dropdownFadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="bg-gray-100 transition-all duration-500">

    <div id="app-container" class="min-h-screen flex items-center justify-center p-4">

        <div id="login-view" class="w-full max-w-6xl mx-auto hidden">
            <div class="bg-white rounded-2xl shadow-2xl flex flex-col md:flex-row-reverse overflow-hidden">
                <div class="w-full md:w-1/2 p-8 sm:p-12 flex flex-col justify-center">
                    <h1 class="text-4xl md:text-5xl font-bold text-indigo-700 mb-4 leading-tight">×“×£ × ×—×™×ª×” ×× ×¦×—.<br/>×‘×œ×—×™×¦×ª ×›×¤×ª×•×¨.</h1>
                    <p class="text-gray-800 text-lg leading-relaxed mb-6">
                        ×ª×¤×¡×™×§ ×œ×‘×–×‘×– ×–××Ÿ ×•×›×¡×£. ×”×‘×•×˜ ×”×—×›× ×©×œ AutoPage ×™×‘× ×” ×œ×š ×“×£ × ×—×™×ª×” ××§×¦×•×¢×™ ×©×××™×¨ ×’×•×œ×©×™× ×œ×œ×§×•×—×•×ª - ×ª×•×š ×“×§×•×ª, ×‘×œ×™ ×¦×•×¨×š ×‘×§×•×“ ××• ×™×“×¢ ×‘×¢×™×¦×•×‘.
                    </p>
                     <ul class="space-y-4 text-gray-700 mb-8 text-base">
                        <li class="flex items-center gap-3">âœ¨ <b>×™×¦×™×¨×” ××™×™×“×™×ª:</b> ×¢× ×” ×¢×œ ×›××” ×©××œ×•×ª ×•×”×“×£ ×©×œ×š ×‘××•×•×™×¨.</li>
                        <li class="flex items-center gap-3">ğŸ¨ <b>×¢×™×¦×•×‘ ×™×•×§×¨×ª×™:</b> ×‘×—×¨ ××ª×•×š ×ª×‘× ×™×•×ª ×©× ×¨××•×ª ×›××™×œ×• ×¢×•×¦×‘×• ×‘×¡×˜×•×“×™×•.</li>
                        <li class="flex items-center gap-3">ğŸš€ <b>××•×›×Ÿ ×œ×¦××™×—×”:</b> ×—×™×‘×•×¨ ×§×œ ×œ×•×•××˜×¡××¤, ××™××™×™×œ ×•× ×™×”×•×œ ×œ×™×“×™×.</li>
                        <li class="flex items-center gap-3">ğŸ’¡ <b>24/7 ×‘×©×‘×™×œ×š:</b> ×”×‘×•×˜ ×¢×•× ×” ×œ×’×•×œ×©×™× ×’× ×›×©××ª×” ×™×©×Ÿ.</li>
                    </ul>
                    
                    <!-- Auth Tabs -->
                    <div class="flex mb-6 border-b border-gray-200">
                        <button id="loginTab" class="flex-1 py-3 px-4 text-center font-medium text-indigo-600 border-b-2 border-indigo-600" onclick="showAuthTab('login')">
                            ×”×ª×—×‘×¨×•×ª
                        </button>
                        <button id="registerTab" class="flex-1 py-3 px-4 text-center font-medium text-gray-500 hover:text-gray-700" onclick="showAuthTab('register')">
                            ×”×¨×©××”
                        </button>
                    </div>

                    <!-- Login Form -->
                    <div id="loginForm" class="auth-form">
                        <div class="mb-4">
                            <label for="loginEmail" class="block text-sm font-medium text-gray-700 mb-2">××™××™×™×œ:</label>
                            <input type="email" id="loginEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="×”×›× ×¡ ××ª ×”××™××™×™×œ ×©×œ×š">
                        </div>
                        <div class="mb-4">
                            <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-2">×¡×™×¡××”:</label>
                            <input type="password" id="loginPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="×”×›× ×¡ ××ª ×”×¡×™×¡××” ×©×œ×š">
                        </div>
                        <button onclick="loginWithEmail()" class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-bold hover:bg-indigo-700 transition-transform transform hover:scale-105 mb-3">
                            ×”×ª×—×‘×¨
                        </button>
                        <button onclick="resetPassword()" class="w-full text-indigo-600 py-2 px-4 font-medium hover:text-indigo-800 transition">
                            ×©×›×—×ª ×¡×™×¡××”?
                        </button>
                    </div>

                    <!-- Register Form -->
                    <div id="registerForm" class="auth-form hidden">
                        <div class="mb-4">
                            <label for="registerEmail" class="block text-sm font-medium text-gray-700 mb-2">××™××™×™×œ:</label>
                            <input type="email" id="registerEmail" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="×”×›× ×¡ ××ª ×”××™××™×™×œ ×©×œ×š">
                        </div>
                        <div class="mb-4">
                            <label for="registerPassword" class="block text-sm font-medium text-gray-700 mb-2">×¡×™×¡××”:</label>
                            <input type="password" id="registerPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="×”×›× ×¡ ×¡×™×¡××” ×—×“×©×”">
                        </div>
                        <div class="mb-4">
                            <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-2">××™×©×•×¨ ×¡×™×¡××”:</label>
                            <input type="password" id="confirmPassword" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="×”×›× ×¡ ×©×•×‘ ××ª ×”×¡×™×¡××”">
                        </div>
                        <button onclick="registerWithEmail()" class="w-full bg-green-600 text-white py-3 px-4 rounded-lg font-bold hover:bg-green-700 transition-transform transform hover:scale-105 mb-3">
                            ×”×¨×©×
                        </button>
                    </div>

                    <!-- Divider -->
                    <div class="flex items-center my-6">
                        <div class="flex-1 border-t border-gray-300"></div>
                        <span class="px-4 text-gray-500 text-sm">××•</span>
                        <div class="flex-1 border-t border-gray-300"></div>
                    </div>
                    
                    <button id="googleSignInBtn" class="w-full bg-red-600 text-white py-4 px-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3 hover:bg-red-700 transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:bg-gray-400">
                        <svg class="w-6 h-6" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        <span>×”×ª×—×‘×¨ ×¢× Google</span>
                    </button>
                    <div id="loading" class="mt-4 flex items-center justify-center gap-2 text-gray-500 hidden">
                        <div class="loader"></div>
                        <span>××ª×—×‘×¨...</span>
                    </div>
                    <div id="error-message" class="bg-red-100 text-red-700 p-3 rounded-lg mt-4 hidden"></div>
                    <div id="success-message" class="bg-green-100 text-green-700 p-3 rounded-lg mt-4 hidden"></div>
                </div>
                
                <aside class="relative bg-slate-100 p-4 w-full md:w-1/2 hidden md:flex items-center justify-center">
                    <div id="slides-container" class="relative w-full max-w-md h-[480px] overflow-hidden rounded-xl shadow-lg">
                        </div>
                    <button id="prev" class="absolute top-1/2 -translate-y-1/2 right-7 bg-white/90 hover:bg-white rounded-full w-9 h-9 grid place-items-center shadow z-10">â€¹</button>
                    <button id="next" class="absolute top-1/2 -translate-y-1/2 left-7 bg-white/90 hover:bg-white rounded-full w-9 h-9 grid place-items-center shadow z-10">â€º</button>
                    <div id="dots" class="absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-2 z-10"></div>
                </aside>
            </div>
        </div>


        <div id="dashboard-view" class="w-full max-w-5xl hidden">
            <div class="bg-slate-50 p-4 rounded-2xl shadow-2xl">
                <!-- ×›×¤×ª×•×¨×™ ×¤×¢×•×œ×” ×¨××©×™×™× -->
                <div class="flex justify-end gap-4 mb-1">
                    <button id="account-summary-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                        <svg class="w-5 h-5 inline-block ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        ×¡×™×›×•× ×—×©×‘×•×Ÿ
                    </button>
                    <button id="admin-panel-btn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition-colors hidden">
                        <svg class="w-5 h-5 inline-block ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31-2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        ×¤×× ×œ ×× ×”×œ
                    </button>
                </div>
                
                <!-- User info and logout button -->
                <div class="flex items-center justify-between mb-1 pb-1 border-b border-gray-200">
                    <div class="flex items-center gap-2">
                        <img id="user-avatar" src="https://placehold.co/80x80/E2E8F0/4A5568?text=U" alt="×ª××•× ×ª ×¤×¨×•×¤×™×œ" class="w-8 h-8 rounded-full object-cover">
                        <div class="text-right">
                            <div id="user-name" class="font-semibold text-gray-700 text-xs">
                                <span class="loading-dots">×˜×•×¢×Ÿ</span>
                            </div>
                            <div id="subscription-status" class="text-xs text-gray-500">
                                <span id="subscription-badge" class="inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                    <span id="subscription-text">××©×ª××© ×¨×©×•×</span>
                                </span>
                            </div>
                        </div>
                        <button onclick="signOut()" title="×”×ª× ×ª×§" class="text-gray-500 hover:text-red-600 transition">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                        </button>
                    </div>
                </div>

                <div id="projects-section">
                    <div class="flex justify-between items-center mb-1">
                         <h2 class="text-2xl font-bold text-gray-800">×“×¤×™ ×”× ×—×™×ª×” ×©×œ×™</h2>
                        <button onclick="goToFullApp()" class="bg-indigo-600 text-white py-2 px-6 rounded-lg font-bold hover:bg-indigo-700 transition-transform transform hover:scale-105 flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                            <span>×“×£ ×—×“×©</span>
                        </button>
                    </div>
                    <div id="projects-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Page Subscription Modal -->
    <div id="page-subscription-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">×”×¤×¢×œ ×× ×•×™ ×œ×¦×¤×™×™×” ×‘×“×£</h3>
                        <p class="text-gray-600">×”×¤×¢×œ ×× ×•×™ ×—×•×“×©×™ ×‘-â‚ª39 ×œ×¦×¤×™×™×” ×‘×“×£ ×–×”</p>
                    </div>
                
                <div class="space-y-4 mb-6">
                    <div class="flex items-center gap-3 p-3 bg-green-50 rounded-lg">
                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="text-sm text-gray-700">×’×™×©×” ××œ××” ×œ×“×£</span>
                    </div>
                    <div class="flex items-center gap-3 p-3 bg-green-50 rounded-lg">
                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="text-sm text-gray-700">×§×™×©×•×¨ ×§×‘×•×¢ ×œ×“×£</span>
                    </div>
                    <div class="flex items-center gap-3 p-3 bg-green-50 rounded-lg">
                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="text-sm text-gray-700">×¢×“×›×•× ×™× ××•×˜×•××˜×™×™×</span>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg p-4 mb-6">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-indigo-600 mb-1">â‚ª39</div>
                        <div class="text-sm text-gray-500">×œ×—×•×“×©</div>
                    </div>
                </div>

                <div class="flex gap-3">
                    <button onclick="closePageSubscriptionModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-300 transition">
                        ×‘×™×˜×•×œ
                    </button>
                        <button onclick="processPageSubscription()" class="flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg font-bold hover:bg-indigo-700 transition">
                            ×”×¤×¢×œ ×× ×•×™
                        </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Subscription Modal -->
    <div id="subscription-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
                <div class="text-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">×× ×•×™ AutoPage Pro</h3>
                    <p class="text-gray-600">×”×ª×—×œ ×× ×•×™ ×—×•×“×©×™ ×‘-â‚ª39 ×•×§×‘×œ ×’×™×©×” ××œ××”</p>
                </div>
                
                <div class="space-y-4 mb-6">
                    <div class="flex items-center gap-3 p-3 bg-green-50 rounded-lg">
                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="text-sm text-gray-700">×™×¦×™×¨×ª ×“×¤×™× ×œ×œ× ×”×’×‘×œ×”</span>
                    </div>
                    <div class="flex items-center gap-3 p-3 bg-green-50 rounded-lg">
                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="text-sm text-gray-700">×§×™×©×•×¨ ×§×‘×•×¢ ×œ×“×£ ×©×œ×š</span>
                    </div>
                    <div class="flex items-center gap-3 p-3 bg-green-50 rounded-lg">
                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span class="text-sm text-gray-700">×ª××™×›×” ×˜×›× ×™×ª 24/7</span>
                    </div>
                </div>

                <div class="bg-gray-50 rounded-lg p-4 mb-6">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-indigo-600 mb-1">â‚ª39</div>
                        <div class="text-sm text-gray-500">×œ×—×•×“×©</div>
                    </div>
                </div>

                <div class="flex gap-3">
                    <button onclick="closeSubscriptionModal()" class="flex-1 bg-gray-200 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-300 transition">
                        ×‘×™×˜×•×œ
                    </button>
                    <button onclick="processSubscription()" class="flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg font-bold hover:bg-indigo-700 transition">
                        ×”×ª×—×œ ×× ×•×™
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="fixed inset-0 bg-gray-100 z-50 hidden">
        <div class="flex h-screen">
            <!-- Sidebar -->
            <div class="w-64 bg-white shadow-lg border-l border-gray-200">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h1 class="text-xl font-bold text-gray-800">×¤×× ×œ ×× ×”×œ</h1>
                        <button id="close-admin-panel" class="text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <nav class="mt-6">
                    <div class="px-3 space-y-1">
                        <button id="dashboard-tab" class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-white bg-indigo-600">
                            <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v1H8V5z"></path>
                            </svg>
                            ×“×©×‘×•×¨×“
                        </button>
                        
                        <button id="users-tab" class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-50 hover:text-gray-900">
                            <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                            </svg>
                            ××©×ª××©×™×
                        </button>
                        
                        <button id="finance-tab" class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-50 hover:text-gray-900">
                            <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                            ×›×¡×¤×™×
                        </button>
                        
                        <button id="analytics-tab" class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-50 hover:text-gray-900">
                            <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            ×¡×˜×˜×™×¡×˜×™×§×•×ª
                        </button>
                        
                        <button id="settings-tab" class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-50 hover:text-gray-900">
                            <svg class="w-5 h-5 ml-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            ×”×’×“×¨×•×ª
                        </button>
                    </div>
                </nav>
            </div>
            
            <!-- Main Content -->
            <div class="flex-1 flex flex-col overflow-hidden">
                <!-- Top Bar -->
                <header class="bg-white shadow-sm border-b border-gray-200">
                    <div class="px-6 py-4">
                        <div class="flex items-center justify-between">
                            <h2 id="admin-page-title" class="text-2xl font-semibold text-gray-800">×“×©×‘×•×¨×“</h2>
                            <div class="flex items-center space-x-4">
                                <div class="text-sm text-gray-500">
                                    <span id="admin-current-time"></span>
                                </div>
                                <div class="w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center text-white text-sm font-medium">
                                    A
                                </div>
                            </div>
                        </div>
                    </div>
                </header>
                
                <!-- Content Area -->
                <main class="flex-1 overflow-y-auto bg-gray-50 p-6">

                    <!-- Dashboard Content -->
                    <div id="dashboard-content" class="tab-content">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <div class="w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center">
                                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="mr-4">
                                        <p class="text-sm font-medium text-gray-500">××©×ª××©×™× ×‘××¢×¨×›×ª</p>
                                        <p class="text-2xl font-semibold text-gray-900" id="dashboard-total-users">
                                            <span class="loading-dots">×˜×•×¢×Ÿ</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <div class="w-8 h-8 bg-green-500 rounded-md flex items-center justify-center">
                                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="mr-4">
                                        <p class="text-sm font-medium text-gray-500">×”×›× ×¡×•×ª ×—×•×“×©×™×•×ª</p>
                                        <p class="text-2xl font-semibold text-gray-900" id="dashboard-monthly-revenue">
                                            <span class="loading-dots">×˜×•×¢×Ÿ</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <div class="w-8 h-8 bg-green-500 rounded-md flex items-center justify-center">
                                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="mr-4">
                                        <p class="text-sm font-medium text-gray-500">×“×¤×™× ×¤×¢×™×œ×™×</p>
                                        <p class="text-2xl font-semibold text-gray-900" id="dashboard-active-pages">0</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <div class="w-8 h-8 bg-amber-500 rounded-md flex items-center justify-center">
                                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="mr-4">
                                        <p class="text-sm font-medium text-gray-500">×“×¤×™× ×œ× ×¤×¢×™×œ×™×</p>
                                        <p class="text-2xl font-semibold text-gray-900" id="dashboard-inactive-pages">0</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                                <div class="p-6 border-b border-gray-200">
                                    <h3 class="text-lg font-medium text-gray-900">×¤×¢×™×œ×•×ª ××—×¨×•× ×”</h3>
                                </div>
                                <div class="p-6 max-h-96 overflow-y-auto">
                                    <div id="recent-activity" class="space-y-4">
                                        <!-- ×¤×¢×™×œ×•×ª ×××™×ª×™×ª ×ª×™×˜×¢×Ÿ ×›××Ÿ -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                                <div class="p-6 border-b border-gray-200">
                                    <h3 class="text-lg font-medium text-gray-900">×¡×˜×˜×™×¡×˜×™×§×•×ª ××”×™×¨×•×ª</h3>
                                </div>
                                <div class="p-6">
                                    <div class="space-y-4">
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm font-medium text-gray-500">××©×ª××©×™× ×—×“×©×™× ×”×©×‘×•×¢</span>
                                            <span class="text-sm font-semibold text-gray-900" id="weekly-new-users">1</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm font-medium text-gray-500">×“×¤×™× ×©× ×•×¦×¨×• ×”×©×‘×•×¢</span>
                                            <span class="text-sm font-semibold text-gray-900" id="weekly-new-pages">0</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm font-medium text-gray-500">×”×›× ×¡×•×ª ×”×©×‘×•×¢</span>
                                            <span class="text-sm font-semibold text-gray-900" id="weekly-revenue">â‚ª0</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm font-medium text-gray-500">×©×™×¢×•×¨ ×”××¨×”</span>
                                            <span class="text-sm font-semibold text-gray-900" id="conversion-rate">100%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Users Management Content -->
                    <div id="users-content" class="tab-content hidden">
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                            <div class="p-6 border-b border-gray-200">
                                <div class="flex items-center justify-between">
                                    <h3 class="text-lg font-medium text-gray-900">× ×™×”×•×œ ××©×ª××©×™×</h3>
                                    <button class="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700">
                                        ××©×ª××© ×—×“×©
                                    </button>
                                </div>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">××©×ª××©</th>
                                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">××™××™×™×œ</th>
                                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">×ª××¨×™×š ×”×¦×˜×¨×¤×•×ª</th>
                                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">×× ×•×™</th>
                                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">×¤×¢×•×œ×•×ª</th>
                                        </tr>
                                    </thead>
                                    <tbody id="users-table-body" class="bg-white divide-y divide-gray-200">
                                        <!-- Users will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Finance Management Content -->
                    <div id="finance-content" class="tab-content hidden">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <div class="w-8 h-8 bg-green-500 rounded-md flex items-center justify-center">
                                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="mr-4">
                                        <p class="text-sm font-medium text-gray-500">×”×›× ×¡×•×ª ×—×•×“×©×™×•×ª</p>
                                        <p class="text-2xl font-semibold text-gray-900" id="monthly-revenue">â‚ª2,450</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <div class="w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center">
                                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="mr-4">
                                        <p class="text-sm font-medium text-gray-500">××©×ª××©×™× ××—×•×‘×¨×™×</p>
                                        <p class="text-2xl font-semibold text-gray-900" id="active-users">1</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <div class="w-8 h-8 bg-purple-500 rounded-md flex items-center justify-center">
                                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="mr-4">
                                        <p class="text-sm font-medium text-gray-500">×“×¤×™× ×©× ×•×¦×¨×•</p>
                                        <p class="text-2xl font-semibold text-gray-900" id="total-pages">47</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                            <div class="p-6 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">×”×™×¡×˜×•×¨×™×™×ª ×ª×©×œ×•××™×</h3>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">××©×ª××©</th>
                                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">×¡×›×•×</th>
                                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">×ª××¨×™×š</th>
                                            <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">×¡×˜×˜×•×¡</th>
                                        </tr>
                                    </thead>
                                    <tbody id="payments-table-body" class="bg-white divide-y divide-gray-200">
                                        <!-- Payments will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Analytics Content -->
                    <div id="analytics-content" class="tab-content hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                                <div class="p-6 border-b border-gray-200">
                                    <h3 class="text-lg font-medium text-gray-900">×¡×˜×˜×•×¡ ×“×¤×™×</h3>
                                </div>
                                <div class="p-6">
                                    <div id="pages-status-chart" class="h-64 flex items-center justify-center">
                                        <div class="text-center">
                                            <div class="w-32 h-32 mx-auto mb-4 relative">
                                                <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                                                    <circle cx="50" cy="50" r="40" stroke="#e5e7eb" stroke-width="8" fill="none"/>
                                                    <circle id="pages-progress" cx="50" cy="50" r="40" stroke="#10b981" stroke-width="8" fill="none" 
                                                            stroke-dasharray="251.2" stroke-dashoffset="251.2" stroke-linecap="round"/>
                                                </svg>
                                                <div class="absolute inset-0 flex items-center justify-center">
                                                    <span id="pages-percentage" class="text-2xl font-bold text-gray-700">0%</span>
                                                </div>
                                            </div>
                                            <div class="space-y-2">
                                                <div class="flex items-center justify-between text-sm">
                                                    <span class="text-gray-600">×“×¤×™× ×¤×¢×™×œ×™×</span>
                                                    <span id="active-pages-count" class="font-medium">0</span>
                                                </div>
                                                <div class="flex items-center justify-between text-sm">
                                                    <span class="text-gray-600">×“×¤×™× ×œ× ×¤×¢×™×œ×™×</span>
                                                    <span id="inactive-pages-count" class="font-medium">0</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                                <div class="p-6 border-b border-gray-200">
                                    <h3 class="text-lg font-medium text-gray-900">×”×›× ×¡×•×ª ×—×•×“×©×™×•×ª</h3>
                                </div>
                                <div class="p-6">
                                    <div id="revenue-chart" class="h-64 flex items-center justify-center">
                                        <div class="text-center">
                                            <div class="text-4xl font-bold text-green-600 mb-2" id="monthly-revenue-display">â‚ª0</div>
                                            <div class="text-sm text-gray-500 mb-4">×”×›× ×¡×•×ª ×”×—×•×“×©</div>
                                            <div class="space-y-3">
                                                <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                                                    <span class="text-sm text-gray-600">×“×¤×™× ×¤×¢×™×œ×™×</span>
                                                    <span id="revenue-active-pages" class="font-medium text-green-600">0</span>
                                                </div>
                                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                                    <span class="text-sm text-gray-600">×“×¤×™× ×œ× ×¤×¢×™×œ×™×</span>
                                                    <span id="revenue-inactive-pages" class="font-medium text-gray-600">0</span>
                                                </div>
                                                <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                                                    <span class="text-sm text-gray-600">×¤×•×˜× ×¦×™××œ ×”×›× ×¡×•×ª</span>
                                                    <span id="revenue-potential" class="font-medium text-blue-600">â‚ª0</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                                <div class="p-6 border-b border-gray-200">
                                    <div class="flex items-center justify-between">
                                        <h3 class="text-lg font-medium text-gray-900">×¤×¢×™×œ×•×ª</h3>
                                        <div class="flex bg-gray-100 rounded-lg p-1">
                                            <button id="daily-btn" class="px-3 py-1 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-md transition-colors" onclick="changeActivityPeriod('daily')">×™×•××™</button>
                                            <button id="weekly-btn" class="px-3 py-1 text-sm font-medium bg-white text-gray-900 shadow-sm rounded-md transition-colors" onclick="changeActivityPeriod('weekly')">×©×‘×•×¢×™</button>
                                            <button id="monthly-btn" class="px-3 py-1 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-md transition-colors" onclick="changeActivityPeriod('monthly')">×—×•×“×©×™</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-6">
                                    <div id="weekly-activity-chart" class="h-64">
                                        <div class="space-y-4">
                                            <div class="flex items-center justify-between p-4 bg-blue-50 rounded-lg">
                                                <div class="flex items-center">
                                                    <div class="w-3 h-3 bg-blue-500 rounded-full ml-2"></div>
                                                    <span class="text-sm text-gray-600">×“×¤×™× ×©× ×•×¦×¨×• ×”×©×‘×•×¢</span>
                                                </div>
                                                <span id="weekly-pages-created" class="font-bold text-blue-600">0</span>
                                            </div>
                                            <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg">
                                                <div class="flex items-center">
                                                    <div class="w-3 h-3 bg-green-500 rounded-full ml-2"></div>
                                                    <span class="text-sm text-gray-600">×“×¤×™× ×©×”×•×¤×¢×œ×• ×”×©×‘×•×¢</span>
                                                </div>
                                                <span id="weekly-pages-activated" class="font-bold text-green-600">0</span>
                                            </div>
                                            <div class="flex items-center justify-between p-4 bg-purple-50 rounded-lg">
                                                <div class="flex items-center">
                                                    <div class="w-3 h-3 bg-purple-500 rounded-full ml-2"></div>
                                                    <span class="text-sm text-gray-600">×”×›× ×¡×•×ª ×”×©×‘×•×¢</span>
                                                </div>
                                                <span id="weekly-revenue-display" class="font-bold text-purple-600">â‚ª0</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                                <div class="p-6 border-b border-gray-200">
                                    <h3 class="text-lg font-medium text-gray-900">×¡×˜×˜×™×¡×˜×™×§×•×ª ××©×ª××©×™×</h3>
                                </div>
                                <div class="p-6">
                                    <div id="users-stats-chart" class="h-64">
                                        <div class="space-y-4">
                                            <div class="flex items-center justify-between p-4 bg-indigo-50 rounded-lg">
                                                <div class="flex items-center">
                                                    <div class="w-3 h-3 bg-indigo-500 rounded-full ml-2"></div>
                                                    <span class="text-sm text-gray-600">×¡×”"×› ××©×ª××©×™× ××—×•×‘×¨×™×</span>
                                                </div>
                                                <span id="total-users-count" class="font-bold text-indigo-600">0</span>
                                            </div>
                                            <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg">
                                                <div class="flex items-center">
                                                    <div class="w-3 h-3 bg-green-500 rounded-full ml-2"></div>
                                                    <span class="text-sm text-gray-600">××©×ª××©×™× ××—×•×‘×¨×™×</span>
                                                </div>
                                                <span id="active-users-count" class="font-bold text-green-600">0</span>
                                            </div>
                                            <div class="flex items-center justify-between p-4 bg-amber-50 rounded-lg">
                                                <div class="flex items-center">
                                                    <div class="w-3 h-3 bg-amber-500 rounded-full ml-2"></div>
                                                    <span class="text-sm text-gray-600">××©×ª××©×™× ×œ× ××—×•×‘×¨×™×</span>
                                                </div>
                                                <span id="inactive-users-count" class="font-bold text-amber-600">0</span>
                                            </div>
                                            <div class="flex items-center justify-between p-4 bg-red-50 rounded-lg">
                                                <div class="flex items-center">
                                                    <div class="w-3 h-3 bg-red-500 rounded-full ml-2"></div>
                                                    <span class="text-sm text-gray-600">×©×™×¢×•×¨ ×”××¨×”</span>
                                                </div>
                                                <span id="conversion-rate-display" class="font-bold text-red-600">0%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Settings Content -->
                    <div id="settings-content" class="tab-content hidden">
                        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
                            <div class="p-6 border-b border-gray-200">
                                <h3 class="text-lg font-medium text-gray-900">×”×’×“×¨×•×ª ××¢×¨×›×ª</h3>
                            </div>
                            <div class="p-6">
                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">×©× ×”××¢×¨×›×ª</label>
                                        <input type="text" value="AutoPage" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">××™××™×™×œ ×× ×”×œ</label>
                                        <input type="email" value="admin@autopage.com" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">×”×’×“×¨×•×ª ××‘×˜×—×”</label>
                                        <div class="space-y-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" checked class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <span class="mr-2 text-sm text-gray-700">×“×•×¨×© ××™××•×ª ×“×•-×©×œ×‘×™</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <span class="mr-2 text-sm text-gray-700">×”×’×‘×œ ××¡×¤×¨ × ×™×¡×™×•× ×•×ª ×”×ª×—×‘×¨×•×ª</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">× ×™×§×•×™ × ×ª×•× ×™×</label>
                                        <div class="bg-yellow-50 border border-yellow-200 rounded-md p-4">
                                            <p class="text-sm text-gray-700 mb-3">
                                                ğŸ§¹ × ×§×” × ×ª×•× ×™× ×™×ª×•××™× (×§× ×™×•×ª ×•××•×–×× ×™× ××“×¤×™× ×©× ××—×§×•)
                                            </p>
                                            <button onclick="cleanOrphanedData()" class="bg-yellow-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-yellow-700">
                                                ğŸ—‘ï¸ × ×§×” × ×ª×•× ×™× ×™×ª×•××™×
                                            </button>
                                        </div>
                                    </div>
                                    <div class="flex justify-end">
                                        <button class="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700">
                                            ×©××•×¨ ×”×’×“×¨×•×ª
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <script>
        // --- Performance Optimization for Edge ---
        // Disable console.log in production for better Edge performance
        const isEdge = navigator.userAgent.indexOf('Edg') > -1;
        if (isEdge) {
            // Completely disable console in Edge
            console.log = function() {};
            console.info = function() {};
            console.debug = function() {};
            console.warn = function() {};
            
            // Add timeout protection for all async operations
            window.EDGE_TIMEOUT = 5000; // 5 seconds max for any operation
            
            // Disable all animations in Edge
            document.documentElement.style.setProperty('--animation-duration', '0s');
        }
        
        // --- ×”×’×“×¨×•×ª ---
        const supabaseUrl = 'https://osoqfadqohqcauawzmmq.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9zb3FmYWRxb2hxY2F1YXd6bW1xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2OTIzMjMsImV4cCI6MjA3MzI2ODMyM30.TBLmKIntYGSfBm2StItfWm87-ebojV_NbaKNcYNWMPg';
        const googleClientId = '589919062235-o6ohhnon54a12dav2lg24goh1m4ks43p.apps.googleusercontent.com';

        const { createClient } = supabase;
        const supabaseClient = createClient(supabaseUrl, supabaseKey);
        let currentUser = null;
        let subscriptionData = null;
        let subscriptionTimer = null;
        let currentPageForSubscription = null;
        let projects = []; // Global projects array for manageProject access

        // --- Admin Variables ---
        const ADMIN_USER_ID = 'fae06b49-1239-4ba5-93db-244ce2851fb4'; // ×”×× ×”×œ ×”× ×•×›×—×™
        let isAdmin = false;
        let adminTimeInterval = null; // Prevent memory leak from multiple intervals
        let isDashboardLoading = false; // Prevent multiple simultaneous dashboard loads
        let loadProjectsTimeout = null; // Debounce loadProjects calls
        let isLoadingProjects = false; // Prevent concurrent loadProjects calls

        // --- User Session Management ---
        function saveCurrentUser(user) {
            if (user) {
                sessionStorage.setItem('currentUser', JSON.stringify(user));
            }
        }

        function loadCurrentUser() {
            try {
                const stored = sessionStorage.getItem('currentUser');
                return stored ? JSON.parse(stored) : null;
            } catch (error) {
                console.error('Error loading user from session:', error);
                return null;
            }
        }

        function clearCurrentUser() {
            sessionStorage.removeItem('currentUser');
        }

        // --- DOM Elements ---
        const loginView = document.getElementById('login-view');
        const dashboardView = document.getElementById('dashboard-view');
        const adminPanelBtn = document.getElementById('admin-panel-btn');
        const adminPanel = document.getElementById('admin-panel');
        const closeAdminPanel = document.getElementById('close-admin-panel');
        const adminPageTitle = document.getElementById('admin-page-title');
        const adminCurrentTime = document.getElementById('admin-current-time');
        
        // --- Subscription Functions ---
        function openSubscriptionModal() {
            document.getElementById('subscription-modal').classList.remove('hidden');
        }

        function closeSubscriptionModal() {
            document.getElementById('subscription-modal').classList.add('hidden');
        }

        async function processSubscription() {
            if (!currentUser) {
                showError('×¢×œ×™×š ×œ×”×™×•×ª ××—×•×‘×¨ ×›×“×™ ×œ×¨×›×•×© ×× ×•×™');
                return;
            }

            // ×¡×™××•×œ×¦×™×” ×©×œ ×ª×©×œ×•× - ×‘×¤×•×¢×œ ×›××Ÿ ×™×”×™×” ×©×™×œ×•×‘ ×¢× ××¢×¨×›×ª ×ª×©×œ×•××™×
            try {
                // ×™×¦×™×¨×ª ×× ×•×™ ×—×“×©
                const subscriptionEndDate = new Date();
                subscriptionEndDate.setMonth(subscriptionEndDate.getMonth() + 1);

                subscriptionData = {
                    userId: currentUser.id,
                    startDate: new Date().toISOString(),
                    endDate: subscriptionEndDate.toISOString(),
                    isActive: true,
                    pageUrl: `${window.location.origin}/pages/${currentUser.id}/landing.html`
                };

                // ×©××™×¨×” ×‘-localStorage (×‘×¤×•×¢×œ ×™×”×™×” ×‘×‘×¡×™×¡ × ×ª×•× ×™×)
                localStorage.setItem(`subscription_${currentUser.id}`, JSON.stringify(subscriptionData));

                closeSubscriptionModal();
                // updateSubscriptionUI(); // ×œ× × ×“×¨×© ×™×•×ª×¨
                startSubscriptionCountdown();
                
                showSuccess('×”×× ×•×™ ×”×•×¤×¢×œ ×‘×”×¦×œ×—×”!');
                
            } catch (error) {
                console.error('Subscription error:', error);
                showError('×©×’×™××” ×‘×”×¤×¢×œ×ª ×”×× ×•×™');
            }
        }

        function updateSubscriptionUI() {
            // ×”×¤×•× ×§×¦×™×” ×”×–×• ×›×‘×¨ ×œ× × ×“×¨×©×ª ×›×™ ×”×¡×¨× ×• ××ª ×”××œ×× ×˜×™× ××”×“×£ ×”×¨××©×™
            // ×›×œ ×”×× ×•×™×™× ×”× ×¤×¨×˜×™×™× ×œ×›×œ ×“×£
            console.log('updateSubscriptionUI called - no longer needed');
        }

        function startSubscriptionCountdown() {
            if (!subscriptionData || !subscriptionData.isActive) return;

            const subscriptionCountdown = document.getElementById('subscription-countdown');
            
            function updateCountdown() {
                const now = new Date().getTime();
                const endDate = new Date(subscriptionData.endDate).getTime();
                const timeLeft = endDate - now;

                if (timeLeft <= 0) {
                    // ×”×× ×•×™ ×¤×’
                    subscriptionData.isActive = false;
                    localStorage.setItem(`subscription_${currentUser.id}`, JSON.stringify(subscriptionData));
                    // updateSubscriptionUI(); // ×œ× × ×“×¨×© ×™×•×ª×¨
                    showError('×”×× ×•×™ ×©×œ×š ×¤×’. ×× × ×—×“×© ××ª ×”×× ×•×™ ×œ×”××©×š ×”×©×™××•×©.');
                    // Clear interval when subscription expires
                    if (subscriptionTimer) {
                        clearInterval(subscriptionTimer);
                        subscriptionTimer = null;
                    }
                    return;
                }

                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));

                subscriptionCountdown.textContent = `× ×•×ª×¨×•: ${days} ×™××™×, ${hours} ×©×¢×•×ª, ${minutes} ×“×§×•×ª`;
            }

            updateCountdown();
            // Clear previous interval to prevent memory leak
            if (subscriptionTimer) {
                clearInterval(subscriptionTimer);
            }
            subscriptionTimer = setInterval(updateCountdown, 60000); // ×¢×“×›×•×Ÿ ×›×œ ×“×§×”
        }

        function loadSubscriptionData() {
            if (!currentUser) return;
            
            const stored = localStorage.getItem(`subscription_${currentUser.id}`);
            if (stored) {
                subscriptionData = JSON.parse(stored);
                
                // ×‘×“×•×§ ×× ×”×× ×•×™ ×¢×“×™×™×Ÿ ×¤×¢×™×œ
                const now = new Date().getTime();
                const endDate = new Date(subscriptionData.endDate).getTime();
                
                if (now > endDate) {
                    subscriptionData.isActive = false;
                    localStorage.setItem(`subscription_${currentUser.id}`, JSON.stringify(subscriptionData));
                }
            }
            
            // updateSubscriptionUI(); // ×œ× × ×“×¨×© ×™×•×ª×¨
        }

        // --- Page Subscription Functions ---
        function openPageSubscriptionModal(pageId) {
            console.log('Opening subscription modal for page:', pageId);
            currentPageForSubscription = pageId;
            document.getElementById('page-subscription-modal').classList.remove('hidden');
        }

        function closePageSubscriptionModal() {
            document.getElementById('page-subscription-modal').classList.add('hidden');
            currentPageForSubscription = null;
        }

        // --- Account Summary Modal Functions ---
        function openAccountSummaryModal() {
            document.getElementById('account-summary-modal').classList.remove('hidden');
            // ×¢×“×›×Ÿ ××ª ×”× ×ª×•× ×™× ×‘××•×“×œ ×¢× × ×ª×•× ×™× ×××™×ª×™×™×
            updateModalAccountSummary();
        }

        function closeAccountSummaryModal() {
            document.getElementById('account-summary-modal').classList.add('hidden');
        }

        async function updateModalAccountSummary() {
            console.log('=== updateModalAccountSummary called ===');
            console.log('Current user:', currentUser);
            
            if (!currentUser || !currentUser.id) {
                console.log('No current user, skipping modal update');
                return;
            }

            try {
                // ×§×‘×œ ××ª ×”×“×¤×™× ××”×©×¨×ª (×›××• ×‘-loadProjects)
                console.log('Fetching pages from server...');
                const response = await fetch(`/api/pages/${currentUser.id}`);
                const serverData = await response.json();
                const serverPages = serverData.pages || [];
                console.log('Server pages for modal:', serverPages);
                
                // ×§×‘×œ ×’× ×“×¤×™× ××§×•××™×™×
                const localData = JSON.parse(localStorage.getItem('autopage_data') || '{}');
                const localPages = localData.pages || [];
                console.log('Local pages for modal:', localPages);
                
                // ×©×œ×‘ ××ª ×”× ×ª×•× ×™×
                const allPages = [...serverPages, ...localPages];
                console.log('All pages for modal:', allPages);

                // ×¡×¤×•×¨ ×× ×•×™×™× ×¤×¢×™×œ×™× (×›××• ×‘-loadProjects)
                let activeSubscriptions = 0;
                allPages.forEach(page => {
                    const pageKey = `local_${page.fileName}`;
                    const pageSubscription = localStorage.getItem(`page_subscription_${pageKey}`);
                    console.log(`Checking subscription for ${pageKey}:`, pageSubscription);
                    if (pageSubscription) {
                        const subscriptionData = JSON.parse(pageSubscription);
                        console.log(`Subscription data for ${pageKey}:`, subscriptionData);
                        if (subscriptionData.isActive) {
                            activeSubscriptions++;
                        }
                    }
                });

                console.log(`Modal - Total pages: ${allPages.length}, Active subscriptions: ${activeSubscriptions}`);

                // ×—×©×‘ ×—×™×•×‘ ×—×•×“×©×™ (â‚ª39 ×œ×›×œ ×“×£ ×¤×¢×™×œ ×‘×œ×‘×“)
                const monthlyCharge = activeSubscriptions * 39;
                const lastUpdateTime = new Date().toLocaleString('he-IL');

                // ×¢×“×›×Ÿ ××ª ×”××•×“×œ
                document.getElementById('modal-account-total-pages').textContent = allPages.length;
                document.getElementById('modal-account-active-pages').textContent = activeSubscriptions;
                document.getElementById('modal-account-monthly-charge').textContent = `â‚ª${monthlyCharge}`;
                document.getElementById('modal-last-update').textContent = lastUpdateTime;

                // ×¢×“×›×Ÿ ××ª ×”×ª×¦×•×’×•×ª ×”××§×“×™××•×ª ×”×§×˜× ×•×ª
                document.getElementById('modal-total-pages-icon').textContent = allPages.length;
                document.getElementById('modal-active-pages-icon').textContent = activeSubscriptions;
                document.getElementById('modal-monthly-charge-amount').textContent = monthlyCharge;

                console.log('Modal Account Summary Updated:', {
                    totalPages: allPages.length,
                    activePages: activeSubscriptions,
                    monthlyCharge,
                    serverPages: serverPages.length,
                    localPages: localPages.length
                });

            } catch (error) {
                console.error('Error updating modal account summary:', error);
                // ×”×¦×’ × ×ª×•× ×™× ×‘×¨×™×¨×ª ××—×“×œ
                document.getElementById('modal-account-total-pages').textContent = '0';
                document.getElementById('modal-account-active-pages').textContent = '0';
                document.getElementById('modal-account-monthly-charge').textContent = 'â‚ª0';
                document.getElementById('modal-last-update').textContent = new Date().toLocaleString('he-IL');
            }
        }

        async function processPageSubscription() {
            console.log('ğŸ”” Processing subscription for:', currentPageForSubscription);
            console.log('ğŸ‘¤ Current user:', currentUser);
            
            if (!currentUser || !currentPageForSubscription) {
                showError('×©×’×™××” ×‘×¤×¨×˜×™ ×”×× ×•×™');
                return;
            }

            try {
                // ×™×¦×™×¨×ª ×× ×•×™ ×œ×“×£ ×¡×¤×¦×™×¤×™
                const subscriptionEndDate = new Date();
                subscriptionEndDate.setMonth(subscriptionEndDate.getMonth() + 1);

                const pageSubscriptionData = {
                    pageId: currentPageForSubscription,
                    userId: currentUser.id,
                    startDate: new Date().toISOString(),
                    endDate: subscriptionEndDate.toISOString(),
                    isActive: true
                };

                // ×©××™×¨×” ×‘-localStorage
                const storageKey = `page_subscription_${currentPageForSubscription}`;
                localStorage.setItem(storageKey, JSON.stringify(pageSubscriptionData));
                console.log('âœ… Subscription saved to localStorage with key:', storageKey);
                console.log('ğŸ“¦ Subscription data:', pageSubscriptionData);
                
                // ×‘×“×•×§ ×©×”× ×ª×•× ×™× × ×©××¨×• ×‘×”×¦×œ×—×”
                const savedData = localStorage.getItem(storageKey);
                console.log('ğŸ” Verification - data saved?', savedData !== null);

                closePageSubscriptionModal();
                
                // ×¢×“×›×Ÿ ××ª ×”×›×¨×˜×™×¡ ××™×™×“×™×ª
                console.log('ğŸ”„ Looking for project card:', currentPageForSubscription);
                const projectCard = document.querySelector(`[data-project-id="${currentPageForSubscription}"]`);
                console.log('ğŸ“Œ Project card found:', projectCard !== null);
                
                if (projectCard) {
                    // ××¦× ××ª ××–×•×¨ ×”×›×¤×ª×•×¨×™× - ×¢×“×›× ×• ××ª ×”-selector
                    const actionButtonsDiv = projectCard.querySelector('.flex.items-center.justify-between');
                    console.log('ğŸ”˜ Action buttons div found:', actionButtonsDiv !== null);
                    
                    if (actionButtonsDiv) {
                        // ××¦× ××ª ×”×›×¤×ª×•×¨ ×”×¦×”×•×‘ "×”×¤×¢×œ ×× ×•×™" ×•×”×—×œ×£ ××•×ª×• ×‘×›×¤×ª×•×¨ ×™×¨×•×§ "×¦×¤×”"
                        const subscribeBtn = actionButtonsDiv.querySelector('button.bg-yellow-500');
                        if (subscribeBtn) {
                            subscribeBtn.outerHTML = `
                                <button onclick="viewProject('${currentPageForSubscription}')" class="bg-green-500 text-white px-3 py-2 rounded text-sm font-medium hover:bg-green-600 transition shadow-sm" style="min-width: 60px;">
                                    ×¦×¤×”
                                </button>`;
                            console.log('âœ… Button updated successfully!');
                        }
                        
                        // ×¢×“×›×Ÿ ××ª ×”×ª×’ ×©×œ ×”×¡×˜×˜×•×¡
                        const statusBadge = projectCard.querySelector('.status-badge');
                        if (statusBadge) {
                            statusBadge.className = 'status-badge status-completed';
                            statusBadge.textContent = '×× ×•×™ ×¤×¢×™×œ';
                        }
                        
                        // ×¢×“×›×Ÿ ××ª ×”×ª×’ ×‘×¤×™× ×” ×©×œ ×”×ª××•× ×”
                        const cornerBadge = projectCard.querySelector('.absolute.top-3.right-3 > div');
                        if (cornerBadge) {
                            cornerBadge.className = 'bg-green-500 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1';
                            cornerBadge.innerHTML = `
                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                </svg>
                                ×–××™×Ÿ ×œ×¦×¤×™×™×”`;
                        }
                    }
                }
                
                showSuccess('×”×× ×•×™ ×œ×“×£ ×”×•×¤×¢×œ ×‘×”×¦×œ×—×”! ×›×¢×ª × ×™×ª×Ÿ ×œ×¦×¤×•×ª ×‘×“×£');
                
                // ×¨×¢× ×Ÿ ××ª ×”×“×©×‘×•×¨×“ ×œ××—×¨ ×©× ×™×”
                setTimeout(() => {
                    console.log('ğŸ”„ Reloading projects...');
                    loadProjects();
                }, 1000);
                
            } catch (error) {
                console.error('âŒ Page subscription error:', error);
                showError('×©×’×™××” ×‘×”×¤×¢×œ×ª ×”×× ×•×™ ×œ×“×£');
            }
        }
        
        // --- ×œ×•×’×™×§×ª ××™××•×ª ---
        window.onload = async function() {
            console.log("=== PAGE LOAD CHECK ===");
            
            // ×‘×“×•×§ ×× ×—×–×¨× ×• ××™×¦×™×¨×ª ×“×£ ×—×“×©
            const urlParams = new URLSearchParams(window.location.search);
            const fromCreator = urlParams.get('fromCreator');
            if (fromCreator === 'true') {
                // × ×§×” ××ª ×”×¤×¨××˜×¨ ××”-URL
                window.history.replaceState({}, document.title, window.location.pathname);
                // ×¢×“×›×Ÿ ××ª ×”××•×“×œ ×× ×”×•× ×¤×ª×•×— (×¨×§ ×× ×‘×××ª ×¦×¨×™×š)
                // ×”×•×¡×¨ ×¨×¢× ×•×Ÿ ××•×˜×•××˜×™ ×©×’×¨× ×œ×‘×¢×™×•×ª
            }
            
            // × ×¡×” ×œ×˜×¢×•×Ÿ ××©×ª××© ×-sessionStorage
            const savedUser = loadCurrentUser();
            if (savedUser) {
                console.log("Found saved user in session:", savedUser.email);
                currentUser = savedUser;
                // ×”××ª×Ÿ ×§×¦×ª ×œ×¤× ×™ ×”×¦×’×ª ×”×“×©×‘×•×¨×“
                setTimeout(() => {
                showDashboard();
                }, 100);
                return;
            }
            
            console.log("Supabase URL:", supabaseUrl);
            console.log("Supabase Key:", supabaseKey ? 'Present' : 'Missing');
            
            try {
                const { data: { session }, error } = await supabaseClient.auth.getSession();
                console.log("Session data:", session);
                console.log("Session error:", error);
                
                if (session && session.user) {
                    console.log("Found existing session!");
                    console.log("User ID:", session.user.id);
                    console.log("User email:", session.user.email);
                    currentUser = session.user;
                    saveCurrentUser(currentUser);
                    setTimeout(() => {
                    showDashboard();
                    }, 100);
                } else {
                    console.log("No session found, showing login");
                    loginView.classList.remove('hidden');
                    initGoogleSignIn();
                }
            } catch (err) {
                console.error("Error checking session:", err);
                loginView.classList.remove('hidden');
                initGoogleSignIn();
            }
        };

        function initCarousel() {
            const DEMOS = [
                {src:'https://images.pexels.com/photos/1779487/pexels-photo-1779487.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', caption:'×“×£ × ×—×™×ª×” ×œ×¢×¡×§'},
                {src:'https://images.pexels.com/photos/262978/pexels-photo-262978.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', caption:'×ª×¤×¨×™×˜ ×œ××¡×¢×“×”'},
                {src:'https://images.pexels.com/photos/374631/pexels-photo-374631.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', caption:'×§×˜×œ×•×’ ××•×¦×¨×™×'},
                {src:'https://images.pexels.com/photos/5077063/pexels-photo-5077063.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', caption:'×¤×•×¡×˜ ×©×™×•×•×§×™'},
                {src:'https://images.pexels.com/photos/4050315/pexels-photo-4050315.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', caption:'×›×¨×˜×™×¡ ×‘×™×§×•×¨ ×“×™×’×™×˜×œ×™'},
                {src:'https://images.pexels.com/photos/326503/pexels-photo-326503.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', caption:'××ª×¨ ×ª×“××™×ª'}
            ];
            const slidesContainer = document.getElementById('slides-container');
            if (slidesContainer) {
                const dotsC = document.getElementById('dots');
                const prevBtn = document.getElementById('prev');
                const nextBtn = document.getElementById('next');
                const count = DEMOS.length;
                let i = 0;
                let timer;
                slidesContainer.innerHTML = DEMOS.map((d) => `
                    <figure class="absolute inset-0 w-full h-full transition-opacity duration-700 ease-in-out opacity-0">
                        <img loading="lazy" src="${d.src}" alt="${d.caption}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https.placehold.co/800x600/cccccc/ffffff?text=Image+Not+Found';">
                        <figcaption class="absolute bottom-3 right-3 bg-white/85 px-3 py-1 rounded text-xs font-medium text-gray-700 shadow">${d.caption}</figcaption>
                    </figure>
                `).join('');
                const slides = Array.from(slidesContainer.children);
                dotsC.innerHTML = DEMOS.map(() => '<button class="w-2.5 h-2.5 rounded-full bg-white/60 transition-colors"></button>').join('');
                const dots = [...dotsC.children];
                function setDot() { dots.forEach((d, j) => { d.className = 'w-2.5 h-2.5 rounded-full transition-colors ' + (j === i ? 'bg-white shadow' : 'bg-white/60'); }); }
                function go(n) { i = (n + count) % count; slides.forEach((slide, index) => { slide.classList.toggle('opacity-100', index === i); }); setDot(); }
                function reset() { clearInterval(timer); auto(); }
                function auto() { timer = setInterval(() => go(i + 1), 5000); }
                prevBtn.onclick = () => { go(i - 1); reset(); };
                nextBtn.onclick = () => { go(i + 1); reset(); };
                dots.forEach((d, idx) => d.onclick = () => { go(idx); reset(); });
                go(0);
                auto();
            }
        }

        // --- ×¤×•× ×§×¦×™×•×ª ××™××•×ª ×¨×’×™×œ ---
        function showAuthTab(tab) {
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            
            if (tab === 'login') {
                loginTab.className = 'flex-1 py-3 px-4 text-center font-medium text-indigo-600 border-b-2 border-indigo-600';
                registerTab.className = 'flex-1 py-3 px-4 text-center font-medium text-gray-500 hover:text-gray-700';
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
            } else {
                registerTab.className = 'flex-1 py-3 px-4 text-center font-medium text-indigo-600 border-b-2 border-indigo-600';
                loginTab.className = 'flex-1 py-3 px-4 text-center font-medium text-gray-500 hover:text-gray-700';
                registerForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            }
        }

        async function loginWithEmail() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            console.log("=== LOGIN ATTEMPT ===");
            console.log("Email:", email);
            
            if (!email || !password) {
                showError('×× × ××œ× ××ª ×›×œ ×”×©×“×•×ª');
                return;
            }
            
            showLoading(true);
            
            try {
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                console.log("Login response:", { data, error });
                
                if (error) {
                    console.error("Login error:", error);
                    showError('×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª: ' + error.message);
                } else if (data && data.user) {
                    console.log("Login successful!");
                    console.log("User ID:", data.user.id);
                    currentUser = data.user;
                    saveCurrentUser(currentUser);
                    setTimeout(() => {
                    showDashboard();
                    }, 100);
                } else {
                    console.error("No user data in response");
                    showError('×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª');
                }
            } catch (error) {
                console.error("Login exception:", error);
                showError('×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª');
            } finally {
                showLoading(false);
            }
        }

        async function registerWithEmail() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!email || !password || !confirmPassword) {
                showError('×× × ××œ× ××ª ×›×œ ×”×©×“×•×ª');
                return;
            }
            
            if (password !== confirmPassword) {
                showError('×”×¡×™×¡×××•×ª ××™× ×Ÿ ×ª×•×××•×ª');
                return;
            }
            
            if (password.length < 6) {
                showError('×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 6 ×ª×•×•×™×');
                return;
            }
            
            showLoading(true);
            
            try {
                console.log("=== REGISTRATION ATTEMPT ===");
                console.log("Email:", email);
                
                const { data, error } = await supabaseClient.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            name: email.split('@')[0],
                            full_name: email.split('@')[0]
                        }
                    }
                });
                
                console.log("Registration response:", { data, error });
                
                if (error) {
                    console.error("Registration error:", error);
                    showError('×©×’×™××” ×‘×”×¨×©××”: ' + error.message);
                } else if (data && data.user) {
                    console.log("Registration successful!");
                    console.log("User ID:", data.user.id);
                    showSuccess('×”×¨×©××” ×‘×•×¦×¢×” ×‘×”×¦×œ×—×”! ×‘×“×•×§ ××ª ×”××™××™×™×œ ×©×œ×š ×œ××™×©×•×¨ ×”×—×©×‘×•×Ÿ.');
                    // ×¢×‘×¨ ×œ×˜×‘ ×”×ª×—×‘×¨×•×ª
                    showAuthTab('login');
                    // × ×§×” ××ª ×”×©×“×•×ª
                    document.getElementById('registerEmail').value = '';
                    document.getElementById('registerPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                } else {
                    console.error("No user data in registration response");
                    showError('×©×’×™××” ×‘×”×¨×©××”');
                }
            } catch (error) {
                showError('×©×’×™××” ×‘×”×¨×©××”');
            } finally {
                showLoading(false);
            }
        }

        async function resetPassword() {
            const email = document.getElementById('loginEmail').value;
            
            if (!email) {
                showError('×× × ×”×›× ×¡ ××ª ×”××™××™×™×œ ×©×œ×š ×ª×—×™×œ×”');
                return;
            }
            
            showLoading(true);
            
            try {
                const { error } = await supabaseClient.auth.resetPasswordForEmail(email, {
                    redirectTo: window.location.origin + '/reset-password'
                });
                
                if (error) {
                    showError('×©×’×™××” ×‘×©×œ×™×—×ª ××™××™×™×œ ×©×—×–×•×¨: ' + error.message);
                } else {
                    showSuccess('× ×©×œ×— ××™××™×™×œ ×©×—×–×•×¨ ×¡×™×¡××”. ×‘×“×•×§ ××ª ×ª×™×‘×ª ×”×“×•××¨ ×©×œ×š.');
                }
            } catch (error) {
                showError('×©×’×™××” ×‘×©×œ×™×—×ª ××™××™×™×œ ×©×—×–×•×¨');
            } finally {
                showLoading(false);
            }
        }

        function showLoading(show) {
            const loadingEl = document.getElementById('loading');
            if (show) {
                loadingEl.classList.remove('hidden');
            } else {
                loadingEl.classList.add('hidden');
            }
        }

        function showSuccess(message) {
            // ×™×¦×™×¨×ª ×”×•×“×¢×ª ×”×¦×œ×—×” ×–×× ×™×ª
            const successDiv = document.createElement('div');
            successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            successDiv.textContent = message;
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        }

        function initGoogleSignIn() {
            console.log("=== INIT GOOGLE SIGNIN ===");
            if (typeof google === 'undefined') {
                console.log("Google not loaded yet, retrying...");
                setTimeout(initGoogleSignIn, 100);
                return;
            }
            
            console.log("Google loaded, initializing...");
            initCarousel();
            google.accounts.id.initialize({
                client_id: googleClientId,
                callback: handleGoogleResponse,
                auto_select: false,
                cancel_on_tap_outside: false,
            });
            
            // Use renderButton instead of prompt() - more reliable
            const buttonDiv = document.getElementById('googleSignInBtn');
            
            // Hide the custom button and create a wrapper for Google's button
            buttonDiv.style.display = 'none';
            const googleButtonWrapper = document.createElement('div');
            googleButtonWrapper.id = 'google-button-wrapper';
            googleButtonWrapper.style.width = '100%';
            buttonDiv.parentNode.insertBefore(googleButtonWrapper, buttonDiv.nextSibling);
            
            // Render Google's official button
            google.accounts.id.renderButton(
                googleButtonWrapper,
                {
                    theme: 'filled_blue',
                    size: 'large',
                    width: buttonDiv.offsetWidth || 350,
                    text: 'signin_with',
                    locale: 'he',
                    logo_alignment: 'left'
                }
            );
            
            console.log("Google Sign-In button rendered");
        }

        async function handleGoogleResponse(response) {
            console.log("=== GOOGLE RESPONSE ===");
            console.log("Google credential:", response.credential);
            
            // Show loading immediately
            showLoading(true);
            const googleButtonWrapper = document.getElementById('google-button-wrapper');
            if (googleButtonWrapper) {
                googleButtonWrapper.style.display = 'none';
            }
            
            try {
                const { data, error } = await supabaseClient.auth.signInWithIdToken({
                    provider: 'google',
                    token: response.credential,
                });
                
                console.log("Google sign-in response:", { data, error });
                
                if (error) {
                    console.error("Supabase auth error:", error);
                    showError('×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª ×¢× Google: ' + error.message);
                    showLoading(false);
                    if (googleButtonWrapper) {
                        googleButtonWrapper.style.display = 'block';
                    }
                } else if (data && data.user) {
                    currentUser = data.user;
                    saveCurrentUser(currentUser);
                    console.log("âœ… Google login successful!");
                    console.log("User ID:", currentUser.id);
                    console.log("User email:", currentUser.email);
                    console.log("User metadata:", currentUser?.user_metadata);
                    
                    showSuccess('×”×ª×—×‘×¨×ª ×‘×”×¦×œ×—×”! ×˜×•×¢×Ÿ ××ª ×”×“×©×‘×•×¨×“...');
                    setTimeout(() => {
                    showDashboard();
                    }, 800);
                } else {
                    console.error("No user data in Google response");
                    showError('×©×’×™××”: ×œ× ×”×ª×§×‘×œ×• × ×ª×•× ×™ ××©×ª××© ×-Google');
                    showLoading(false);
                    if (googleButtonWrapper) {
                        googleButtonWrapper.style.display = 'block';
                    }
                }
            } catch (err) {
                console.error("Google sign-in exception:", err);
                showError('×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª: ' + (err.message || '× ×¡×” ×©×•×‘'));
                showLoading(false);
                if (googleButtonWrapper) {
                    googleButtonWrapper.style.display = 'block';
                }
            }
        }
        
        // ×¤×•× ×§×¦×™×” ×—×›××” ×œ×—×™×œ×•×¥ × ×ª×•× ×™×
        function extractUserData(user) {
            console.log("=== EXTRACTING USER DATA ===");
            console.log("Raw user object:", user);
            console.log("User metadata:", user.user_metadata);
            console.log("User email:", user.email);
            
            // ×—×™×œ×•×¥ ×©× - × ×¡×” ×›××” ××¤×©×¨×•×™×•×ª
            let name = '××©×ª××© ×¨×©×•×';
            
            // ×‘×“×•×§ user_metadata
            if (user.user_metadata) {
                if (user.user_metadata.name) name = user.user_metadata.name;
                else if (user.user_metadata.full_name) name = user.user_metadata.full_name;
                else if (user.user_metadata.display_name) name = user.user_metadata.display_name;
                else if (user.user_metadata.first_name || user.user_metadata.last_name) {
                    name = `${user.user_metadata.first_name || ''} ${user.user_metadata.last_name || ''}`.trim();
                }
            }
            
            // ×× ×œ× ××¦×× ×• ×©×, × ×¡×” ××”××™××™×™×œ
            if (name === '××©×ª××© ×¨×©×•×' && user.email) {
                const emailName = user.email.split('@')[0];
                name = emailName.charAt(0).toUpperCase() + emailName.slice(1);
            }
            
            // ×—×™×œ×•×¥ ×ª××•× ×” - × ×¡×” ×›××” ××¤×©×¨×•×™×•×ª
            let avatar = null;
            if (user.user_metadata?.avatar_url) avatar = user.user_metadata.avatar_url;
            else if (user.user_metadata?.picture) avatar = user.user_metadata.picture;
            else if (user.user_metadata?.picture_url) avatar = user.user_metadata.picture_url;
            else avatar = 'https://placehold.co/80x80/E2E8F0/4A5568?text=' + encodeURIComponent(name.charAt(0));
            
            console.log("Extracted name:", name);
            console.log("Extracted avatar:", avatar);
            console.log("========================");
            
            return { name, avatar };
        }
        
        // --- Admin Functions ---
        function checkAdminStatus() {
            isAdmin = currentUser && currentUser.id === ADMIN_USER_ID;
            console.log('Checking admin status:', { 
                currentUser: currentUser?.email, 
                userId: currentUser?.id, 
                adminId: ADMIN_USER_ID, 
                isAdmin 
            });
            if (isAdmin) {
                adminPanelBtn.classList.remove('hidden');
                console.log('Admin panel button shown');
            } else {
                adminPanelBtn.classList.add('hidden');
                console.log('Admin panel button hidden');
            }
        }

        function openAdminPanel() {
            adminPanel.classList.remove('hidden');
            loadAdminData();
            updateAdminTime();
            // Clear previous interval to prevent memory leak
            if (adminTimeInterval) {
                clearInterval(adminTimeInterval);
            }
            adminTimeInterval = setInterval(updateAdminTime, 1000); // ×¢×“×›×Ÿ ×›×œ ×©× ×™×™×”
        }

        function closeAdminPanelHandler() {
            adminPanel.classList.add('hidden');
            // Clear interval when closing to prevent memory leak
            if (adminTimeInterval) {
                clearInterval(adminTimeInterval);
                adminTimeInterval = null;
            }
        }

        function updateAdminTime() {
            if (adminCurrentTime) {
                const now = new Date();
                adminCurrentTime.textContent = now.toLocaleString('he-IL');
            }
        }

        async function loadAdminData() {
            console.log('Loading admin data...', { isAdmin, currentUser: currentUser?.email, userId: currentUser?.id });
            if (!isAdmin) {
                console.log('User is not admin, skipping admin data load');
                return;
            }
            
            try {
                // ×˜×¢×Ÿ × ×ª×•× ×™ ××©×ª××©×™×
                console.log('Loading users data...');
                await loadUsersData();
                
                // ×˜×¢×Ÿ × ×ª×•× ×™ ×›×¡×¤×™×
                console.log('Loading finance data...');
                await loadFinanceData();
                
                // ×˜×¢×Ÿ ×¡×˜×˜×™×¡×˜×™×§×•×ª
                console.log('Loading analytics data...');
                await loadAnalyticsData();
                
                // ×¨×¢× ×Ÿ ××ª ×”×“×©×‘×•×¨×“ ×”×¨××©×™
                console.log('Loading projects...');
                await loadProjects();
                
                console.log('Admin data loaded successfully');
            } catch (error) {
                console.error('Error loading admin data:', error);
            }
        }

        async function loadUsersData() {
            try {
                // ×˜×¢×Ÿ ××ª ×›×œ ×”××©×ª××©×™× ××”×©×¨×ª
                const response = await fetch('/api/users');
                const serverUsers = await response.json();
                
                console.log('Server users:', serverUsers);
                
                const usersTableBody = document.getElementById('users-table-body');
                usersTableBody.innerHTML = '';

                // ×˜×¢×Ÿ ××ª ×›×œ ×”×“×¤×™× ×›×“×™ ×œ×—×©×‘ ×× ×•×™×™× ×××™×ª×™×™×
                const allPagesResponse = await fetch('/api/all-pages');
                const allPages = await allPagesResponse.json();
                
                console.log('All pages for subscription calculation:', allPages);

                // ×”×¦×’ ××ª ×›×œ ×”××©×ª××©×™× ××”×©×¨×ª (×›×•×œ×œ ×”×× ×”×œ ×× ×”×•× ×§×™×™×)
                serverUsers.forEach(user => {
                    // ×—×©×‘ ×× ×•×™×™× ×¤×¢×™×œ×™× ×××™×ª×™×™× ×œ××©×ª××©
                    let activeSubscriptions = 0;
                    let totalRevenue = 0;
                    
                    // ××¦× ××ª ×›×œ ×”×“×¤×™× ×©×œ ×”××©×ª××© ×”×–×”
                    const userPages = allPages.filter(page => page.userId === user.id);
                    
                    userPages.forEach(page => {
                        // ×‘×“×•×§ ×× ×™×© ×× ×•×™ ×¤×¢×™×œ ×œ×“×£ ×”×–×” - × ×¡×” ×›××” ××¤×ª×—×•×ª
                        let pageSubscription = null;
                        
                        // 1. × ×¡×” ×¢× ×©× ×”×§×•×‘×¥ ×”××œ×
                        pageSubscription = localStorage.getItem(`page_subscription_${page.fileName}`);
                        
                        // 2. × ×¡×” ×¢× ×©× ×§×•×‘×¥ ×œ×œ× ×¡×™×•××ª
                        if (!pageSubscription) {
                            const fileNameWithoutExt = page.fileName.replace('.html', '');
                            pageSubscription = localStorage.getItem(`page_subscription_${fileNameWithoutExt}`);
                        }
                        
                        // 3. × ×¡×” ×¢× ID ×©×œ ×”×“×£
                        if (!pageSubscription) {
                            pageSubscription = localStorage.getItem(`page_subscription_${page.id || page.fileName}`);
                        }
                        
                        // 4. × ×¡×” ×¢× ×›×œ ×”××¤×ª×—×•×ª ×”×§×™×™××™×
                        if (!pageSubscription) {
                            const allKeys = Object.keys(localStorage).filter(key => key.includes('page_subscription'));
                            for (const key of allKeys) {
                                const keyValue = localStorage.getItem(key);
                                try {
                                    const sub = JSON.parse(keyValue);
                                    // ×‘×“×•×§ ×× ×–×” ×”×× ×•×™ ×©×œ ×”×“×£ ×”×–×”
                                    if (sub.pageId === page.fileName || 
                                        sub.pageId === page.id || 
                                        key.includes(page.fileName) ||
                                        key.includes(page.id)) {
                                        pageSubscription = keyValue;
                                        break;
                                    }
                                } catch (e) {
                                    // ×”××©×š ×œ×—×¤×©
                                }
                            }
                        }
                        
                        if (pageSubscription) {
                            try {
                                const subscription = JSON.parse(pageSubscription);
                                if (subscription.isActive) {
                                    activeSubscriptions++;
                                    totalRevenue += 39;
                                }
                            } catch (e) {
                                console.error('Error parsing subscription:', e);
                            }
                        }
                    });
                    
                    // ×¢×“×›×Ÿ ××ª ×”× ×ª×•× ×™×
                    user.activeSubscriptions = activeSubscriptions;
                    user.totalRevenue = totalRevenue;
                    user.subscription_status = activeSubscriptions > 0 ? 'active' : 'inactive';
                    user.totalPages = userPages.length;
                    
                    console.log(`User ${user.email}: ${activeSubscriptions} active subscriptions, status: ${user.subscription_status}`);
                    console.log(`User pages:`, userPages.map(p => ({ fileName: p.fileName, hasSubscription: !!localStorage.getItem(`page_subscription_${p.fileName}`) })));
                    
                    // ×¦×•×¨ ××ª ×”×©×•×¨×”
                    const row = createUserRow(user);
                    usersTableBody.appendChild(row);
                });

                console.log('Loaded users:', serverUsers.length, 'from server');

            } catch (error) {
                console.error('Error loading users:', error);
                loadLocalUsersData();
            }
        }

        function loadLocalUsersData() {
            // ×˜×¢×Ÿ × ×ª×•× ×™× ××§×•××™×™×
            const usersTableBody = document.getElementById('users-table-body');
            usersTableBody.innerHTML = '';

            // ×§×‘×œ ××ª ×›×œ ×”××©×ª××©×™× ×-localStorage
            const localData = JSON.parse(localStorage.getItem('autopage_data') || '{}');
            const pages = localData.pages || [];
            
            // ×—×©×‘ ×¡×˜×˜×™×¡×˜×™×§×•×ª ××©×ª××©
            let totalPages = pages.length;
            let activeSubscriptions = 0;
            let totalRevenue = 0;
            
            // ×—×©×‘ ×× ×•×™×™× ×¤×¢×™×œ×™× ×××™×ª×™×™×
            activeSubscriptions = 0;
            totalRevenue = 0;
            
            pages.forEach(page => {
                // ×‘×“×•×§ ×× ×™×© ×× ×•×™ ×¤×¢×™×œ ×œ×“×£ ×”×–×” - × ×¡×” ×›××” ××¤×ª×—×•×ª
                let pageSubscription = null;
                
                // 1. × ×¡×” ×¢× ×©× ×”×§×•×‘×¥ ×”××œ×
                pageSubscription = localStorage.getItem(`page_subscription_${page.fileName}`);
                
                // 2. × ×¡×” ×¢× ×©× ×§×•×‘×¥ ×œ×œ× ×¡×™×•××ª
                if (!pageSubscription) {
                    const fileNameWithoutExt = page.fileName.replace('.html', '');
                    pageSubscription = localStorage.getItem(`page_subscription_${fileNameWithoutExt}`);
                }
                
                // 3. × ×¡×” ×¢× ID ×©×œ ×”×“×£
                if (!pageSubscription) {
                    pageSubscription = localStorage.getItem(`page_subscription_${page.id || page.fileName}`);
                }
                
                // 4. × ×¡×” ×¢× ×›×œ ×”××¤×ª×—×•×ª ×”×§×™×™××™×
                if (!pageSubscription) {
                    const allKeys = Object.keys(localStorage).filter(key => key.includes('page_subscription'));
                    for (const key of allKeys) {
                        const keyValue = localStorage.getItem(key);
                        try {
                            const sub = JSON.parse(keyValue);
                            // ×‘×“×•×§ ×× ×–×” ×”×× ×•×™ ×©×œ ×”×“×£ ×”×–×”
                            if (sub.pageId === page.fileName || 
                                sub.pageId === page.id || 
                                key.includes(page.fileName) ||
                                key.includes(page.id)) {
                                pageSubscription = keyValue;
                                break;
                            }
                        } catch (e) {
                            // ×”××©×š ×œ×—×¤×©
                        }
                    }
                }
                
                if (pageSubscription) {
                    try {
                        const subscription = JSON.parse(pageSubscription);
                        if (subscription.isActive) {
                            activeSubscriptions++;
                            totalRevenue += 39;
                        }
                    } catch (e) {
                        console.error('Error parsing subscription:', e);
                    }
                }
            });
            
            // ×”×•×¡×£ ××ª ×”××©×ª××© ×”× ×•×›×—×™ ×¢× × ×ª×•× ×™× ×××™×ª×™×™×
            if (currentUser) {
                const isCurrentAdmin = currentUser.id === ADMIN_USER_ID;
                const row = createUserRow({
                    id: currentUser.id,
                    email: currentUser.email,
                    full_name: currentUser.user_metadata?.full_name || (isCurrentAdmin ? '×× ×”×œ' : '××©×ª××©'),
                    created_at: new Date().toISOString(),
                    subscription_status: activeSubscriptions > 0 ? 'active' : 'inactive',
                    totalPages: totalPages,
                    activeSubscriptions: activeSubscriptions,
                    totalRevenue: totalRevenue,
                    isAdmin: isCurrentAdmin
                });
                usersTableBody.appendChild(row);
            }

            console.log('User Data:', {
                totalPages,
                activeSubscriptions,
                totalRevenue,
                user: currentUser?.user_metadata?.full_name,
                isAdmin: isAdmin,
                userId: currentUser?.id,
                adminId: ADMIN_USER_ID
            });
        }

        function createUserRow(user) {
            const row = document.createElement('tr');
            row.setAttribute('data-user-id', user.id);
            const joinDate = new Date(user.created_at).toLocaleDateString('he-IL');
            // ×‘×“×•×§ ×× ×”××©×ª××© ××—×•×‘×¨ (×›×¨×’×¢ ×¨×§ ×”×× ×”×œ ××—×•×‘×¨)
            const isConnected = user.id === currentUser?.id;
            const statusBadge = isConnected ? 
                '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">××—×•×‘×¨</span>' :
                '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">×œ× ××—×•×‘×¨</span>';

            // ×‘×“×•×§ ×× ×–×” ×”×× ×”×œ
            const isCurrentAdmin = user.id === currentUser?.id || user.isAdmin;
            const adminBadge = isCurrentAdmin ? 
                '<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 mr-2">×× ×”×œ</span>' : '';

            // ×”×•×¡×£ ××™×“×¢ × ×•×¡×£ ×¢×œ ×”××©×ª××©
            const additionalInfo = user.totalPages ? 
                `<div class="text-xs text-gray-400 mt-1">
                    ×“×¤×™×: ${user.totalPages} | ×× ×•×™×™× ×¤×¢×™×œ×™×: ${user.activeSubscriptions || 0} | ×”×›× ×¡×•×ª: â‚ª${user.totalRevenue || 0}
                </div>` : '';

            // ×›×¤×ª×•×¨×™ ×¤×¢×•×œ×” - ×× ×”×œ ×™×›×•×œ ×œ×©×œ×•×˜ ×‘×›×œ ×”××©×ª××©×™×
            const actionButtons = isCurrentAdmin ? 
                `<span class="text-gray-400 text-sm">×× ×”×œ ×”××¢×¨×›×ª</span>` :
                `<button onclick="toggleUserStatus('${user.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">
                    ${isConnected ? '× ×ª×§' : '×”×ª×—×‘×¨'}
                </button>
                <button onclick="viewUserPages('${user.id}')" class="text-blue-600 hover:text-blue-900 mr-3">
                    ×“×¤×™×
                </button>
                <button onclick="deleteUser('${user.id}')" class="text-red-600 hover:text-red-900">
                    ××—×§
                </button>`;

            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 h-10 w-10">
                            <div class="h-10 w-10 rounded-full ${isCurrentAdmin ? 'bg-red-600' : 'bg-indigo-600'} flex items-center justify-center text-white font-bold">
                                ${user.full_name.charAt(0)}
                            </div>
                        </div>
                        <div class="mr-4">
                            <div class="text-sm font-medium text-gray-900 flex items-center">
                                ${user.full_name}
                                ${adminBadge}
                            </div>
                            <div class="text-sm text-gray-500">${user.id}</div>
                            ${additionalInfo}
                        </div>
                    </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${user.email}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${joinDate}</td>
                <td class="px-6 py-4 whitespace-nowrap">${statusBadge}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    ${actionButtons}
                </td>
            `;
            return row;
        }

        async function loadFinanceData() {
            // ×˜×¢×Ÿ × ×ª×•× ×™× ×××™×ª×™×™× ××”×©×¨×ª
            try {
                // ×§×‘×œ ××ª ×›×œ ×”×“×¤×™× ×‘××¢×¨×›×ª ××”×©×¨×ª
                const response = await fetch('/api/all-pages');
                const allPages = await response.json();
                
                console.log('All pages in system:', allPages);
                
                // ×—×©×‘ ×× ×•×™×™× ×¤×¢×™×œ×™× ×•×œ× ×¤×¢×™×œ×™×
                let activeSubscriptions = 0;
                let inactivePages = 0;
                
                allPages.forEach(page => {
                    // ×‘×“×•×§ ×× ×™×© ×× ×•×™ ×¤×¢×™×œ ×œ×“×£ ×”×–×”
                    const pageSubscription = localStorage.getItem(`page_subscription_${page.fileName}`);
                    if (pageSubscription) {
                        const subscription = JSON.parse(pageSubscription);
                        if (subscription.isActive) {
                            activeSubscriptions++;
                        } else {
                            inactivePages++;
                        }
                    } else {
                        // ××™×Ÿ ×× ×•×™ ×‘×›×œ×œ - × ×—×©×‘ ×›×œ× ×¤×¢×™×œ
                        inactivePages++;
                    }
                });
                
                let totalRevenue = activeSubscriptions * 39; // â‚ª39 ×œ×›×œ ×“×£ ×¤×¢×™×œ ×‘×œ×‘×“
                
                // ×—×©×‘ × ×ª×•× ×™× ×××™×ª×™×™×
                const totalPages = allPages.length;
                
                // ××©×ª××©×™× ××—×•×‘×¨×™× - ×›×¨×’×¢ ×¨×§ ×”×× ×”×œ ××—×•×‘×¨
                const connectedUsers = 1; // ×¨×§ ×”×× ×”×œ ××—×•×‘×¨ ×›×¨×’×¢
                
                const monthlyRevenue = totalRevenue; // ×¨×§ ×× ×•×™×™× ×¤×¢×™×œ×™×, ×œ× ×›×œ ×”×“×¤×™×
                
                console.log('Finance Data:', {
                    totalPages,
                    connectedUsers,
                    activeSubscriptions,
                    inactivePages,
                    monthlyRevenue,
                    publishedPagesRevenue: totalPages * 39,
                    pages: allPages.map(p => ({ name: p.title, fileName: p.fileName, userId: p.userId }))
                });
                
                // ×¢×“×›×Ÿ ××ª ×”×“×©×‘×•×¨×“
                document.getElementById('monthly-revenue').textContent = `â‚ª${monthlyRevenue}`;
                document.getElementById('active-users').textContent = connectedUsers.toString();
                document.getElementById('total-pages').textContent = totalPages.toString();
                
                // ×¢×“×›×Ÿ ×’× ××ª ×”×“×©×‘×•×¨×“ ×”×¨××©×™
                const dashboardTotalUsers = document.getElementById('dashboard-total-users');
                const dashboardMonthlyRevenue = document.getElementById('dashboard-monthly-revenue');
                const dashboardActivePages = document.getElementById('dashboard-active-pages');
                const dashboardInactivePages = document.getElementById('dashboard-inactive-pages');
                
                // ×§×‘×œ ××ª ××¡×¤×¨ ×”××©×ª××©×™× ×”×›×•×œ×œ ×‘××¢×¨×›×ª
                const usersResponse = await fetch('/api/users');
                const users = await usersResponse.json();
                const totalUsersInSystem = users.length;
                
                if (dashboardTotalUsers) dashboardTotalUsers.textContent = totalUsersInSystem.toString();
                if (dashboardMonthlyRevenue) dashboardMonthlyRevenue.textContent = `â‚ª${monthlyRevenue}`;
                if (dashboardActivePages) dashboardActivePages.textContent = activeSubscriptions.toString();
                if (dashboardInactivePages) dashboardInactivePages.textContent = inactivePages.toString();
                
            } catch (error) {
                console.error('Error loading finance data:', error);
                // × ×ª×•× ×™× ×“××• ×‘××§×¨×” ×©×œ ×©×’×™××”
                document.getElementById('monthly-revenue').textContent = 'â‚ª0';
                document.getElementById('active-users').textContent = '1';
                document.getElementById('total-pages').textContent = '0';
            }

            // ×˜×¢×Ÿ ×”×™×¡×˜×•×¨×™×™×ª ×ª×©×œ×•××™×
            const paymentsTableBody = document.getElementById('payments-table-body');
            paymentsTableBody.innerHTML = '';

            // ×¦×•×¨ ×ª×©×œ×•××™× ×××™×ª×™×™× ×¢×œ ×‘×¡×™×¡ ×”×“×¤×™× ×¢× ×× ×•×™×™× ×¤×¢×™×œ×™×
            const allPagesResponse = await fetch('/api/all-pages');
            const allPages = await allPagesResponse.json();
            
            const realPayments = [];
            
            allPages.forEach((page, index) => {
                // ×‘×“×•×§ ×× ×™×© ×× ×•×™ ×¤×¢×™×œ ×œ×“×£ ×”×–×”
                const pageSubscription = localStorage.getItem(`page_subscription_${page.fileName}`);
                if (pageSubscription) {
                    const subscription = JSON.parse(pageSubscription);
                    if (subscription.isActive) {
                        // ×¨×§ ×“×¤×™× ×¢× ×× ×•×™ ×¤×¢×™×œ × ×—×©×‘×™× ×›×ª×©×œ×•×
                        realPayments.push({
                            user: currentUser?.user_metadata?.full_name || '××©×ª××©',
                            amount: 'â‚ª39',
                            date: new Date(subscription.purchaseDate || page.created_at || Date.now() - (index * 86400000)).toLocaleDateString('he-IL'),
                            status: 'completed',
                            pageName: page.title || '×“×£ × ×—×™×ª×”'
                        });
                    }
                }
            });
            
            console.log('Real Payments:', realPayments);
            
            // ×× ××™×Ÿ ×ª×©×œ×•××™×, ×”×•×¡×£ ×”×•×“×¢×”
            const demoPayments = realPayments.length > 0 ? realPayments : [{
                user: '××™×Ÿ ×ª×©×œ×•××™×',
                amount: 'â‚ª0',
                date: '-',
                status: 'none',
                pageName: '××™×Ÿ ×“×¤×™× ×¢× ×× ×•×™ ×¤×¢×™×œ'
            }];

            demoPayments.forEach(payment => {
                const row = document.createElement('tr');
                let statusBadge;
                
                if (payment.status === 'completed') {
                    statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">×”×•×©×œ×</span>';
                } else if (payment.status === 'none') {
                    statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">××™×Ÿ × ×ª×•× ×™×</span>';
                } else {
                    statusBadge = '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">×××ª×™×Ÿ</span>';
                }

                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${payment.user}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${payment.amount}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${payment.date}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${statusBadge}</td>
                `;
                paymentsTableBody.appendChild(row);
            });
        }

        async function loadAnalyticsData() {
            // ×˜×¢×Ÿ × ×ª×•× ×™× ×××™×ª×™×™× ×œ×¡×˜×˜×™×¡×˜×™×§×•×ª
            try {
                const response = await fetch('/api/all-pages');
                const allPages = await response.json();
                
                // ×—×©×‘ ×“×¤×™× ×©× ×•×¦×¨×• ×”×©×‘×•×¢
                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                const weeklyPages = allPages.filter(page => {
                    const pageDate = new Date(page.created_at || Date.now());
                    return pageDate >= weekAgo;
                }).length;
                
                // ×—×©×‘ ×× ×•×™×™× ×¤×¢×™×œ×™× ×”×©×‘×•×¢
                let weeklyActiveSubscriptions = 0;
                let weeklyRevenue = 0;
                
                const weeklyPagesList = allPages.filter(page => {
                    const pageDate = new Date(page.created_at || Date.now());
                    return pageDate >= weekAgo;
                });
                
                weeklyPagesList.forEach(page => {
                    const pageSubscription = localStorage.getItem(`page_subscription_${page.fileName}`);
                    if (pageSubscription) {
                        const subscription = JSON.parse(pageSubscription);
                        if (subscription.isActive) {
                            weeklyActiveSubscriptions++;
                            weeklyRevenue += 39;
                        }
                    }
                });
                
                console.log('Analytics Data:', {
                    weeklyPages,
                    weeklyActiveSubscriptions,
                    weeklyRevenue,
                    totalPages: allPages.length
                });
                
                // ×¢×“×›×Ÿ ××ª ×”×¡×˜×˜×™×¡×˜×™×§×•×ª
                const weeklyNewUsers = document.getElementById('weekly-new-users');
                const weeklyNewPages = document.getElementById('weekly-new-pages');
                const weeklyRevenueEl = document.getElementById('weekly-revenue');
                const conversionRate = document.getElementById('conversion-rate');
                
                // ××©×ª××©×™× ××—×•×‘×¨×™× - ×›×¨×’×¢ ×¨×§ ×”×× ×”×œ ××—×•×‘×¨
                const totalUsers = 1; // ×¨×§ ×”×× ×”×œ ××—×•×‘×¨ ×›×¨×’×¢
                
                if (weeklyNewUsers) weeklyNewUsers.textContent = "1"; // ××©×ª××© ×—×“×© ×”×©×‘×•×¢ (×”×× ×”×œ)
                if (weeklyNewPages) weeklyNewPages.textContent = weeklyPages.toString();
                if (weeklyRevenueEl) weeklyRevenueEl.textContent = `â‚ª${weeklyRevenue}`;
                
                // ×—×©×‘ ×©×™×¢×•×¨ ×”××¨×” - ×“×¤×™× ×¤×¢×™×œ×™× ××ª×•×š ×¡×”"×› ×“×¤×™×
                let totalActiveSubscriptions = 0;
                allPages.forEach(page => {
                    const pageSubscription = localStorage.getItem(`page_subscription_${page.fileName}`);
                    if (pageSubscription) {
                        const subscription = JSON.parse(pageSubscription);
                        if (subscription.isActive) {
                            totalActiveSubscriptions++;
                        }
                    }
                });
                
                const conversionRateValue = allPages.length > 0 ? Math.round((totalActiveSubscriptions / allPages.length) * 100) : 0;
                if (conversionRate) conversionRate.textContent = `${conversionRateValue}%`;
                
                // ×˜×¢×Ÿ ×¤×¢×™×œ×•×ª ×××™×ª×™×ª
                await loadRecentActivity(allPages);
                
                // ×¢×“×›×Ÿ ×’×¨×¤×™×
                await updateAnalyticsCharts(allPages, totalUsers);
                
            } catch (error) {
                console.error('Error loading analytics data:', error);
            }
        }

        // ××©×ª× ×” ×’×œ×•×‘×œ×™ ×œ×ª×§×•×¤×ª ×”×¤×¢×™×œ×•×ª ×”× ×•×›×—×™×ª
        let currentActivityPeriod = 'weekly';

        async function updateAnalyticsCharts(allPages, totalUsers) {
            try {
                // ×—×©×‘ × ×ª×•× ×™× ×œ×’×¨×¤×™×
                let activePages = 0;
                let inactivePages = 0;
                let weeklyActivePages = 0;
                
                const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
                
                allPages.forEach(page => {
                    const pageSubscription = localStorage.getItem(`page_subscription_${page.fileName}`);
                    if (pageSubscription) {
                        const subscription = JSON.parse(pageSubscription);
                        if (subscription.isActive) {
                            activePages++;
                            // ×‘×“×•×§ ×× ×–×” ×”×©×‘×•×¢
                            const pageDate = new Date(page.created_at || Date.now());
                            if (pageDate >= weekAgo) {
                                weeklyActivePages++;
                            }
                        } else {
                            inactivePages++;
                        }
                    } else {
                        inactivePages++;
                    }
                });
                
                const totalPages = allPages.length;
                const percentage = totalPages > 0 ? Math.round((activePages / totalPages) * 100) : 0;
                const monthlyRevenue = activePages * 39;
                const potentialRevenue = totalPages * 39;
                
                // ×¢×“×›×Ÿ ×’×¨×£ ×¡×˜×˜×•×¡ ×“×¤×™×
                const pagesProgress = document.getElementById('pages-progress');
                const pagesPercentage = document.getElementById('pages-percentage');
                const activePagesCount = document.getElementById('active-pages-count');
                const inactivePagesCount = document.getElementById('inactive-pages-count');
                
                if (pagesProgress) {
                    const circumference = 251.2; // 2 * Ï€ * 40
                    const offset = circumference - (percentage / 100) * circumference;
                    pagesProgress.style.strokeDashoffset = offset;
                }
                
                if (pagesPercentage) pagesPercentage.textContent = `${percentage}%`;
                if (activePagesCount) activePagesCount.textContent = activePages.toString();
                if (inactivePagesCount) inactivePagesCount.textContent = inactivePages.toString();
                
                // ×¢×“×›×Ÿ ×’×¨×£ ×”×›× ×¡×•×ª
                const monthlyRevenueDisplay = document.getElementById('monthly-revenue-display');
                const revenueActivePages = document.getElementById('revenue-active-pages');
                const revenueInactivePages = document.getElementById('revenue-inactive-pages');
                const revenuePotential = document.getElementById('revenue-potential');
                
                if (monthlyRevenueDisplay) monthlyRevenueDisplay.textContent = `â‚ª${monthlyRevenue}`;
                if (revenueActivePages) revenueActivePages.textContent = activePages.toString();
                if (revenueInactivePages) revenueInactivePages.textContent = inactivePages.toString();
                if (revenuePotential) revenuePotential.textContent = `â‚ª${potentialRevenue}`;
                
                // ×©××•×¨ ××ª ×”× ×ª×•× ×™× ×œ×©×™××•×© ×‘×¤×•× ×§×¦×™×•×ª ××—×¨×•×ª
                window.allPagesData = allPages;
                
                // ×¢×“×›×Ÿ ×¤×¢×™×œ×•×ª ×œ×¤×™ ×”×ª×§×•×¤×” ×©× ×‘×—×¨×”
                updateActivityChart(allPages);
                
                const weeklyRevenue = weeklyActivePages * 39;
                
                const weeklyPagesCreatedEl = document.getElementById('weekly-pages-created');
                const weeklyPagesActivatedEl = document.getElementById('weekly-pages-activated');
                const weeklyRevenueDisplay = document.getElementById('weekly-revenue-display');
                
                if (weeklyPagesCreatedEl) weeklyPagesCreatedEl.textContent = weeklyPagesCreated.toString();
                if (weeklyPagesActivatedEl) weeklyPagesActivatedEl.textContent = weeklyActivePages.toString();
                if (weeklyRevenueDisplay) weeklyRevenueDisplay.textContent = `â‚ª${weeklyRevenue}`;
                
                // ×¢×“×›×Ÿ ×¡×˜×˜×™×¡×˜×™×§×•×ª ××©×ª××©×™×
                // ×§×‘×œ ××ª ××¡×¤×¨ ×”××©×ª××©×™× ×”×›×•×œ×œ ×‘××¢×¨×›×ª
                const usersResponse = await fetch('/api/users');
                const allUsers = await usersResponse.json();
                const totalUsersInSystem = allUsers.length;
                
                const activeUsers = 1; // ×¨×§ ×”×× ×”×œ ××—×•×‘×¨ ×›×¨×’×¢
                const inactiveUsers = Math.max(0, totalUsersInSystem - activeUsers); // ××©×ª××©×™× ×œ× ××—×•×‘×¨×™×
                const conversionRate = totalPages > 0 ? Math.round((activePages / totalPages) * 100) : 0;
                
                const totalUsersCount = document.getElementById('total-users-count');
                const activeUsersCount = document.getElementById('active-users-count');
                const inactiveUsersCount = document.getElementById('inactive-users-count');
                const conversionRateDisplay = document.getElementById('conversion-rate-display');
                
                if (totalUsersCount) totalUsersCount.textContent = totalUsersInSystem.toString();
                if (activeUsersCount) activeUsersCount.textContent = activeUsers.toString();
                if (inactiveUsersCount) inactiveUsersCount.textContent = inactiveUsers.toString();
                if (conversionRateDisplay) conversionRateDisplay.textContent = `${conversionRate}%`;
                
            } catch (error) {
                console.error('Error updating analytics charts:', error);
            }
        }

        function changeActivityPeriod(period) {
            currentActivityPeriod = period;
            
            // ×¢×“×›×Ÿ ××ª ×¢×™×¦×•×‘ ×”×›×¤×ª×•×¨×™×
            document.getElementById('daily-btn').className = 'px-3 py-1 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-md transition-colors';
            document.getElementById('weekly-btn').className = 'px-3 py-1 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-md transition-colors';
            document.getElementById('monthly-btn').className = 'px-3 py-1 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-md transition-colors';
            
            if (period === 'daily') {
                document.getElementById('daily-btn').className = 'px-3 py-1 text-sm font-medium bg-white text-gray-900 shadow-sm rounded-md transition-colors';
            } else if (period === 'weekly') {
                document.getElementById('weekly-btn').className = 'px-3 py-1 text-sm font-medium bg-white text-gray-900 shadow-sm rounded-md transition-colors';
            } else if (period === 'monthly') {
                document.getElementById('monthly-btn').className = 'px-3 py-1 text-sm font-medium bg-white text-gray-900 shadow-sm rounded-md transition-colors';
            }
            
            // ×¢×“×›×Ÿ ××ª ×”×’×¨×£
            updateActivityChart(window.allPagesData || []);
        }

        function updateActivityChart(allPages) {
            const now = new Date();
            let periodAgo, periodLabel, createdLabel, activatedLabel;
            
            if (currentActivityPeriod === 'daily') {
                periodAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);
                periodLabel = '×”×™×•×';
                createdLabel = '×“×¤×™× ×©× ×•×¦×¨×• ×”×™×•×';
                activatedLabel = '×“×¤×™× ×©×”×•×¤×¢×œ×• ×”×™×•×';
            } else if (currentActivityPeriod === 'weekly') {
                periodAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                periodLabel = '×”×©×‘×•×¢';
                createdLabel = '×“×¤×™× ×©× ×•×¦×¨×• ×”×©×‘×•×¢';
                activatedLabel = '×“×¤×™× ×©×”×•×¤×¢×œ×• ×”×©×‘×•×¢';
            } else {
                periodAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                periodLabel = '×”×—×•×“×©';
                createdLabel = '×“×¤×™× ×©× ×•×¦×¨×• ×”×—×•×“×©';
                activatedLabel = '×“×¤×™× ×©×”×•×¤×¢×œ×• ×”×—×•×“×©';
            }
            
            const pagesCreated = allPages.filter(page => {
                const pageDate = new Date(page.created_at || Date.now());
                return pageDate >= periodAgo;
            }).length;
            
            const pagesActivated = allPages.filter(page => {
                const pageDate = new Date(page.created_at || Date.now());
                const pageSubscription = localStorage.getItem(`page_subscription_${page.fileName}`);
                return pageDate >= periodAgo && pageSubscription;
            }).length;
            
            // ×¢×“×›×Ÿ ××ª ×”×ª×•×›×Ÿ ×‘×’×¨×£
            const chartContainer = document.getElementById('weekly-activity-chart');
            if (chartContainer) {
                chartContainer.innerHTML = `
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 bg-blue-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-blue-500 rounded-full ml-2"></div>
                                <span class="text-sm text-gray-600">${createdLabel}</span>
                            </div>
                            <span class="text-lg font-semibold text-blue-600" id="period-pages-created">${pagesCreated}</span>
                        </div>
                        <div class="flex items-center justify-between p-4 bg-green-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-green-500 rounded-full ml-2"></div>
                                <span class="text-sm text-gray-600">${activatedLabel}</span>
                            </div>
                            <span class="text-lg font-semibold text-green-600" id="period-pages-activated">${pagesActivated}</span>
                        </div>
                        <div class="flex items-center justify-between p-4 bg-purple-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-purple-500 rounded-full ml-2"></div>
                                <span class="text-sm text-gray-600">×”×›× ×¡×•×ª ${periodLabel}</span>
                            </div>
                            <span class="text-lg font-semibold text-purple-600">â‚ª${pagesActivated * 39}</span>
                        </div>
                        <div class="flex items-center justify-between p-4 bg-orange-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-orange-500 rounded-full ml-2"></div>
                                <span class="text-sm text-gray-600">×©×™×¢×•×¨ ×”××¨×” ${periodLabel}</span>
                            </div>
                            <span class="text-lg font-semibold text-orange-600">${pagesCreated > 0 ? Math.round((pagesActivated / pagesCreated) * 100) : 0}%</span>
                        </div>
                    </div>
                `;
            }
        }

        async function loadRecentActivity(allPages) {
            try {
                const recentActivityContainer = document.getElementById('recent-activity');
                recentActivityContainer.innerHTML = '';
                
                // ×¦×•×¨ ×¨×©×™××ª ×¤×¢×™×œ×•×™×•×ª ×›×•×œ×œ ×™×¦×™×¨×ª ×“×¤×™× ×•×¤×¨×¡×•×
                const activities = [];
                
                // ×”×•×¡×£ ×¤×¢×™×œ×•×ª ×™×¦×™×¨×ª ×“×¤×™×
                allPages.forEach(page => {
                    activities.push({
                        type: 'created',
                        page: page,
                        date: new Date(page.created_at),
                        timestamp: new Date(page.created_at).getTime()
                    });
                });
                
                // ×”×•×¡×£ ×¤×¢×™×œ×•×ª ×¤×¨×¡×•× ×“×¤×™× (×× ×•×™×™×)
                const subscriptionKeys = Object.keys(localStorage).filter(key => key.includes('page_subscription'));
                subscriptionKeys.forEach(key => {
                    try {
                        const subscription = JSON.parse(localStorage.getItem(key));
                        if (subscription && subscription.isActive) {
                            // ××¦× ××ª ×”×“×£ ×”××ª××™×
                            const page = allPages.find(p => 
                                p.fileName === subscription.pageId || 
                                p.id === subscription.pageId ||
                                key.includes(p.fileName) ||
                                key.includes(p.id)
                            );
                            
                            if (page) {
                                activities.push({
                                    type: 'published',
                                    page: page,
                                    subscription: subscription,
                                    date: new Date(subscription.startDate || subscription.endDate),
                                    timestamp: new Date(subscription.startDate || subscription.endDate).getTime()
                                });
                            }
                        }
                    } catch (e) {
                        console.error('Error parsing subscription:', e);
                    }
                });
                
                // ××™×•×Ÿ ×›×œ ×”×¤×¢×™×œ×•×™×•×ª ×œ×¤×™ ×ª××¨×™×š (×”×—×“×©×™× ×‘×™×•×ª×¨ ×¨××©×•×Ÿ)
                activities.sort((a, b) => b.timestamp - a.timestamp);
                
                // ×”×¦×’ ××ª 10 ×”×¤×¢×™×œ×•×™×•×ª ×”××—×¨×•× ×•×ª
                const recentActivities = activities.slice(0, 10);
                
                if (recentActivities.length === 0) {
                    recentActivityContainer.innerHTML = `
                        <div class="text-center text-gray-500 py-4">
                            <p>××™×Ÿ ×¤×¢×™×œ×•×ª ××—×¨×•× ×”</p>
                        </div>
                    `;
                    return;
                }
                
                recentActivities.forEach((activity, index) => {
                    const timeAgo = getTimeAgo(activity.date);
                    const activityItem = document.createElement('div');
                    activityItem.className = 'flex items-center';
                    
                    // ×‘×—×¨ ××™×™×§×•×Ÿ ×•×˜×§×¡×˜ ×œ×¤×™ ×¡×•×’ ×”×¤×¢×™×œ×•×ª
                    let iconBg, iconColor, activityText;
                    if (activity.type === 'published') {
                        iconBg = 'bg-green-100';
                        iconColor = 'text-green-600';
                        activityText = '×“×£ ×¤×•×¨×¡×';
                    } else {
                        iconBg = 'bg-blue-100';
                        iconColor = 'text-blue-600';
                        activityText = '×“×£ ×—×“×© × ×•×¦×¨';
                    }
                    
                    activityItem.innerHTML = `
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 ${iconBg} rounded-full flex items-center justify-center">
                                <svg class="w-4 h-4 ${iconColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    ${activity.type === 'published' ? 
                                        `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>` :
                                        `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>`
                                    }
                                </svg>
                            </div>
                        </div>
                        <div class="mr-4">
                            <p class="text-sm font-medium text-gray-900">${activityText}</p>
                            <p class="text-sm text-gray-500">${activity.page.title || '×“×£ × ×—×™×ª×”'}</p>
                        </div>
                        <div class="mr-auto text-sm text-gray-500">${timeAgo}</div>
                    `;
                    
                    recentActivityContainer.appendChild(activityItem);
                });
                
            } catch (error) {
                console.error('Error loading recent activity:', error);
            }
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) {
                return '×œ×¤× ×™ ×¨×’×¢';
            } else if (diffInSeconds < 3600) {
                const minutes = Math.floor(diffInSeconds / 60);
                return `×œ×¤× ×™ ${minutes} ×“×§×•×ª`;
            } else if (diffInSeconds < 86400) {
                const hours = Math.floor(diffInSeconds / 3600);
                return `×œ×¤× ×™ ${hours} ×©×¢×•×ª`;
            } else {
                const days = Math.floor(diffInSeconds / 86400);
                return `×œ×¤× ×™ ${days} ×™××™×`;
            }
        }

        function toggleUserStatus(userId) {
            console.log('Toggling user status for:', userId);
            showSuccess('×¡×˜×˜×•×¡ ×”××©×ª××© ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”');
            loadUsersData(); // ×¨×¢× ×Ÿ ××ª ×”×¨×©×™××”
        }

        function deleteUser(userId) {
            if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”××©×ª××©?')) {
                console.log('Deleting user:', userId);
                showSuccess('×”××©×ª××© × ××—×§ ×‘×”×¦×œ×—×”');
                loadUsersData(); // ×¨×¢× ×Ÿ ××ª ×”×¨×©×™××”
            }
        }

        async function viewUserPages(userId) {
            try {
                // ×§×‘×œ ××ª ×›×œ ×”×“×¤×™× ×©×œ ×”××©×ª××©
                const response = await fetch(`/api/pages/${userId}`);
                const userPages = await response.json();
                
                console.log('User pages:', userPages);
                
                // ×¤×ª×— ××•×“×œ ×¢× ×¨×©×™××ª ×”×“×¤×™×
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
                modal.innerHTML = `
                    <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[80vh] overflow-y-auto">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xl font-bold text-gray-900">×“×¤×™× ×©×œ ×”××©×ª××©</h3>
                                <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                ${userPages.map(page => `
                                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                        <h4 class="font-medium text-gray-900 mb-2">${page.title || '×“×£ × ×—×™×ª×”'}</h4>
                                        <p class="text-sm text-gray-600 mb-3">${page.fileName}</p>
                                        <div class="flex space-x-2">
                                            <button onclick="editUserPage('${page.fileName}', '${userId}')" class="text-blue-600 hover:text-blue-800 text-sm">
                                                ×¢×¨×•×š
                                            </button>
                                            <button onclick="deleteUserPage('${page.fileName}', '${userId}')" class="text-red-600 hover:text-red-800 text-sm">
                                                ××—×§
                                            </button>
                                            <button onclick="viewUserPage('${page.fileName}', '${userId}')" class="text-green-600 hover:text-green-800 text-sm">
                                                ×¦×¤×”
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            ${userPages.length === 0 ? '<p class="text-gray-500 text-center">××™×Ÿ ×“×¤×™× ×œ××©×ª××© ×”×–×”</p>' : ''}
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
            } catch (error) {
                console.error('Error loading user pages:', error);
                alert('×©×’×™××” ×‘×˜×¢×™× ×ª ×“×¤×™ ×”××©×ª××©');
            }
        }

        function editUserPage(fileName, userId = null) {
            // ×¤×ª×— ××ª ×¢×•×¨×š ×”×“×¤×™× ×¢× ×”×“×£ ×©×œ ×”××©×ª××©
            const targetUserId = userId || currentUser.id;
            window.open(`/page-creator/page-creator.html?edit=${fileName}&userId=${targetUserId}`, '_blank');
        }

        async function deleteUserPage(fileName, userId) {
            if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×“×£?')) {
                try {
                    const response = await fetch(`/api/delete-page`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ fileName, userId })
                    });
                    
                    if (response.ok) {
                        alert('×”×“×£ × ××—×§ ×‘×”×¦×œ×—×”');
                        viewUserPages(userId); // ×¨×¢× ×Ÿ ××ª ×”×¨×©×™××”
                    } else {
                        alert('×©×’×™××” ×‘××—×™×§×ª ×”×“×£');
                    }
                } catch (error) {
                    console.error('Error deleting page:', error);
                    alert('×©×’×™××” ×‘××—×™×§×ª ×”×“×£');
                }
            }
        }

        function viewUserPage(fileName, userId = null) {
            // ×¤×ª×— ××ª ×”×“×£ ×‘×˜××‘ ×—×“×©
            const targetUserId = userId || currentUser.id;
            window.open(`/pages/${targetUserId}/${fileName}`, '_blank');
        }
        
        // --- ×¤×•× ×§×¦×™×•×ª ×¡×™×›×•× ×—×©×‘×•×Ÿ ---
        async function updateAccountSummary() {
            console.log('=== updateAccountSummary called ===');
            
            if (!currentUser || !currentUser.id) {
                console.log('No current user, skipping account summary update');
                return;
            }
            
            try {
                // ×§×‘×œ ××ª ×”×“×¤×™× ××”×©×¨×ª (×›××• ×‘-loadProjects)
                console.log('Fetching pages from server...');
                const response = await fetch(`/api/pages/${currentUser.id}`);
                const serverData = await response.json();
                const serverPages = serverData.pages || [];
                console.log('Server pages:', serverPages);
                
                // ×§×‘×œ ×’× ×“×¤×™× ××§×•××™×™×
                const localData = JSON.parse(localStorage.getItem('autopage_data') || '{}');
                const localPages = localData.pages || [];
                console.log('Local pages:', localPages);
                
                // ×©×œ×‘ ××ª ×”×“×¤×™× ××”×©×¨×ª ×•×”×“×¤×™× ×”××§×•××™×™×
                const allPages = [...serverPages, ...localPages];
                console.log('All pages combined:', allPages);
                
                // ×—×©×‘ ×× ×•×™×™× ×¤×¢×™×œ×™×
                let activeSubscriptions = 0;
                let totalRevenue = 0;
                
                console.log('Checking subscriptions for pages...');
                allPages.forEach((page, index) => {
                    // ×”×©×ª××© ×‘××•×ª×• ××¤×ª×— ×›××• ×‘-loadProjects - project.id
                    const pageKey = page.id || `local_${page.fileName}`;
                    const pageSubscription = localStorage.getItem(`page_subscription_${pageKey}`);
                    console.log(`Page ${index + 1}: ${pageKey}, subscription:`, pageSubscription);
                    
                    if (pageSubscription) {
                        const subscription = JSON.parse(pageSubscription);
                        console.log(`Subscription data:`, subscription);
                        if (subscription.isActive) {
                            activeSubscriptions++;
                            totalRevenue += 39;
                            console.log(`Active subscription found for: ${pageKey}`);
                        }
                    }
                });
                
                console.log(`Total active subscriptions: ${activeSubscriptions}`);
                
                // ×¢×“×›×Ÿ ××ª ×”×¡×™×›×•×
                document.getElementById('account-total-pages').textContent = allPages.length;
                document.getElementById('account-active-pages').textContent = activeSubscriptions;
                
                // ×¢×“×›×Ÿ ××ª ×”×ª×¦×•×’×•×ª ×”××§×“×™××•×ª ×”×§×˜× ×•×ª
                document.getElementById('total-pages-icon').textContent = allPages.length;
                document.getElementById('active-pages-icon').textContent = activeSubscriptions;
                
                // ×—×©×‘ ×—×™×•×‘ ×—×•×“×©×™ (â‚ª39 ×œ×›×œ ×“×£ ×¤×¢×™×œ ×‘×œ×‘×“)
                const monthlyCharge = activeSubscriptions * 39;
                document.getElementById('account-monthly-charge').textContent = `â‚ª${monthlyCharge}`;
                document.getElementById('monthly-charge-amount').textContent = monthlyCharge;
                
                // ×¢×“×›×Ÿ ×–××Ÿ ×¢×“×›×•×Ÿ ××—×¨×•×Ÿ
                const lastUpdateTime = new Date().toLocaleString('he-IL');
                
                // ×¢×“×›×Ÿ ××ª ×”××•×“×œ ×¨×§ ×× ×”××©×ª××© ×‘×™×§×© ×–××ª ×‘××¤×•×¨×©
                // ×”×•×¡×¨ ×¨×¢× ×•×Ÿ ××•×˜×•××˜×™ ×©×’×¨× ×œ×‘×¢×™×•×ª
                
                console.log('Account Summary Updated:', {
                    totalPages: allPages.length,
                    activePages: activeSubscriptions,
                    activeSubscriptions,
                    monthlyCharge,
                    serverPages: serverPages.length,
                    localPages: localPages.length
                });
                
            } catch (error) {
                console.error('Error updating account summary:', error);
            }
        }

        function updatePagesBreakdown(pages) {
            const pagesBreakdown = document.getElementById('pages-breakdown');
            if (!pagesBreakdown) return;
            
            pagesBreakdown.innerHTML = '';
            
            if (pages.length === 0) {
                pagesBreakdown.innerHTML = '<div class="text-sm text-gray-500 text-center py-2">××™×Ÿ ×“×¤×™× ×©×¤×•×¨×¡××•</div>';
                return;
            }
            
            // ××™×•×Ÿ ×”×“×¤×™× ×œ×¤×™ ×ª××¨×™×š (×”×—×“×© ×‘×™×•×ª×¨ ×¨××©×•×Ÿ)
            const sortedPages = pages.sort((a, b) => {
                const dateA = new Date(a.created_at || a.fileName.split('_').pop() || Date.now());
                const dateB = new Date(b.created_at || b.fileName.split('_').pop() || Date.now());
                return dateB - dateA;
            });
            
            sortedPages.forEach((page, index) => {
                const pageDiv = document.createElement('div');
                pageDiv.className = 'flex items-center justify-between p-2 bg-white rounded border border-gray-200';
                
                // ×—×œ×¥ ×ª××¨×™×š ××”×©× ××• ×”×©×ª××© ×‘×ª××¨×™×š × ×•×›×—×™
                let publishDate;
                try {
                    // × ×¡×” ×œ×—×œ×¥ ×ª××¨×™×š ××”×©×
                    const timestampMatch = page.fileName.match(/(\d{13})/);
                    if (timestampMatch) {
                        publishDate = new Date(parseInt(timestampMatch[1]));
                    } else {
                        publishDate = new Date(page.created_at || Date.now());
                    }
                } catch (error) {
                    publishDate = new Date();
                }
                
                const formattedDate = publishDate.toLocaleDateString('he-IL', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                // × ×§×” ××ª ×©× ×”×“×£
                let cleanPageName = page.title || page.fileName || '×“×£ × ×—×™×ª×”';
                if (cleanPageName.includes('_')) {
                    const parts = cleanPageName.split('_');
                    cleanPageName = parts[0] || '×“×£ × ×—×™×ª×”';
                }
                
                pageDiv.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center">
                            <span class="text-xs font-semibold text-indigo-600">${index + 1}</span>
                        </div>
                        <div>
                            <div class="text-sm font-medium text-gray-800">${cleanPageName}</div>
                            <div class="text-xs text-gray-500">×¤×•×¨×¡×: ${formattedDate}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-semibold text-green-600">â‚ª39</div>
                        <div class="text-xs text-gray-500">×“×£ ×©×¤×•×¨×¡×</div>
                    </div>
                `;
                
                pagesBreakdown.appendChild(pageDiv);
            });
        }

        function createTestSubscriptions() {
            console.log('Creating test subscriptions...');
            
            // ×§×‘×œ ××ª ×”×“×¤×™× ××”×©×¨×ª
            fetch(`/api/pages/${currentUser.id}`)
                .then(response => response.json())
                .then(serverData => {
                    const serverPages = serverData.pages || [];
                    
                    // ×¦×•×¨ ×× ×•×™×™× ×œ×“×¤×™× ×”×¨××©×•× ×™× (×¢×“ 3)
                    serverPages.slice(0, 3).forEach((page, index) => {
                        const pageKey = `local_${page.fileName}`; // ××•×ª×• ××¤×ª×— ×›××• ×‘-loadProjects
                        const subscriptionData = {
                            isActive: true,
                            createdAt: new Date().toISOString(),
                            userId: currentUser.id,
                            pageId: pageKey
                        };
                        
                        localStorage.setItem(`page_subscription_${pageKey}`, JSON.stringify(subscriptionData));
                        console.log(`Created subscription for: ${pageKey}`);
                    });
                    
                    // ×¢×“×›×Ÿ ××ª ×”××•×“×œ ×¨×§ ×× ×”××©×ª××© ×‘×™×§×© ×–××ª ×‘××¤×•×¨×©
                    // ×”×•×¡×¨ ×¨×¢× ×•×Ÿ ××•×˜×•××˜×™ ×©×’×¨× ×œ×‘×¢×™×•×ª
                    
                    showSuccess('× ×•×¦×¨×• 3 ×× ×•×™×™× ×œ×“×¤×™× ×”×¨××©×•× ×™×');
                })
                .catch(error => {
                    console.error('Error creating test subscriptions:', error);
                    showError('×©×’×™××” ×‘×™×¦×™×¨×ª ×× ×•×™×™×');
                });
        }
        
        // --- ×œ×•×’×™×§×ª ×“×©×‘×•×¨×“ (××ª×•×§× ×ª) ---
        async function showDashboard() {
            console.log("=== SHOW DASHBOARD ===");
            console.log("currentUser:", currentUser);
            
            if (!currentUser) {
                console.error("currentUser ×œ× ××•×’×“×¨ ×‘-showDashboard!");
                return;
            }
            
            // Prevent multiple simultaneous loads
            if (isDashboardLoading) {
                console.log("Dashboard already loading, skipping...");
                return;
            }
            isDashboardLoading = true;
            
            loginView.classList.add('hidden');
            dashboardView.classList.remove('hidden');
            document.body.classList.add('bg-gray-50');
            
            // ×‘×“×•×§ ×¡×˜×˜×•×¡ ×× ×”×œ
            checkAdminStatus();
            
            // ×¢×“×›×Ÿ ××ª ×”××•×“×œ ×¨×§ ×× ×”××©×ª××© ×‘×™×§×© ×–××ª ×‘××¤×•×¨×©
            // ×”×•×¡×¨ ×¨×¢× ×•×Ÿ ××•×˜×•××˜×™ ×©×’×¨× ×œ×‘×¢×™×•×ª
            
            // ×˜×¢×Ÿ × ×ª×•× ×™ ×× ×•×™
            loadSubscriptionData();

            if (!currentUser || !currentUser.id) {
                console.error("Invalid user object:", currentUser);
                showError("×©×’×™××” ×‘×–×™×”×•×™ ×”××©×ª××©. × ×¡×” ×œ×”×ª×—×‘×¨ ××—×“×©.");
                return;
            }

            // ×—×œ×¥ × ×ª×•× ×™×
            const userData = extractUserData(currentUser);
            
            // ×”×¦×’ ×‘×××©×§ ××™×™×“×™×ª (×œ×¤× ×™ ×‘×“×™×§×ª ×”×¤×¨×•×¤×™×œ)
            const nameElement = document.getElementById('user-name');
            const avatarElement = document.getElementById('user-avatar');
            
            if (nameElement && avatarElement) {
                nameElement.textContent = userData.name;
                avatarElement.src = userData.avatar;
                avatarElement.onerror = function() {
                    this.src = 'https://placehold.co/80x80/E2E8F0/4A5568?text=' + encodeURIComponent(userData.name.charAt(0));
                };
                console.log("âœ… UI Updated immediately with:", userData);
            } else {
                console.error("UI elements not found:", { nameElement, avatarElement });
            }

            // ×›×¢×ª × ×˜×¤×œ ×‘×¤×¨×•×¤×™×œ ×‘×¨×§×¢
            try {
                let { data: profile, error: profileError } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();

                if (profileError && profileError.code !== 'PGRST116') {
                    console.error("Profile fetch error:", profileError);
                }

                // ×× ××™×Ÿ ×¤×¨×•×¤×™×œ ××• ×”×¤×¨×•×¤×™×œ ×¨×™×§, ×¦×•×¨/×¢×“×›×Ÿ
                if (!profile) {
                    console.log("Creating new profile...");
                    await supabaseClient
                        .from('profiles')
                        .upsert({
                            id: currentUser.id,
                            display_name: userData.name,
                            avatar_url: userData.avatar,
                        });
                } else if (!profile.display_name || profile.display_name === '××©×ª××©') {
                    console.log("Updating existing profile...");
                    await supabaseClient
                        .from('profiles')
                        .update({
                            display_name: userData.name,
                            avatar_url: userData.avatar,
                        })
                        .eq('id', currentUser.id);
                }
            } catch (err) {
                console.error("Profile operations error:", err);
                // ×œ× ×—×©×•×‘ - ×”UI ×›×‘×¨ ××¢×•×“×›×Ÿ
            }
            
            // ×”××ª×Ÿ ×§×¦×ª ×œ×¤× ×™ ×˜×¢×™× ×ª ×”×¤×¨×•×™×§×˜×™×
            setTimeout(() => {
            loadProjects();
            isDashboardLoading = false; // Release lock after projects loaded
            }, 200);
            console.log("======================");
        }
        
        // --- Helper Functions ---
        async function detectPageType(project) {
            // PRIORITY 1: Check if pageType is already in project metadata (from server)
            if (project.pageType === 'onlineStore' || project.pageType === 'store') {
                console.log(`âœ… Using metadata pageType: store (from ${project.fileName})`);
                return 'store';
            }
            if (project.pageType === 'event') {
                console.log(`âœ… Using metadata pageType: event (from ${project.fileName})`);
                return 'event';
            }
            
            // Detect page type based on name, metadata, or content
            const name = (project.name || '').toLowerCase();
            const fileName = (project.fileName || project.local_file || '').toLowerCase();
            const description = (project.description || '').toLowerCase();
            
            // Event page keywords (×”×–×× ×”, ×—×ª×•× ×”, ××™×¨×•×¢)
            const eventKeywords = ['×—×ª×•× ×”', '××™×¨×•×¢', '×”×–×× ×”', '×‘×¨ ××¦×•×•×”', '×‘×ª ××¦×•×•×”', '×—×™× ×”', '×‘×¨×™×ª', 'wedding', 'event'];
            const isEventByName = eventKeywords.some(keyword => 
                name.includes(keyword) || fileName.includes(keyword) || description.includes(keyword)
            );
            
            // Store page keywords - EXPANDED LIST
            const storeKeywords = [
                '×—× ×•×ª', '××•×¦×¨', '×§×˜×œ×•×’', '×××ª×§', '××›×™×¨×”', '×§× ×™×”', '××—×™×¨', '×¢×’×œ×”',
                'store', 'shop', 'product', 'catalog', 'buy', 'cart', 'price',
                'sweet', 'candy', 'food', 'bakery', '×××¤×”', '×§×•× ×“×™×˜×•×¨×™×”'
            ];
            const isStoreByName = storeKeywords.some(keyword => 
                name.includes(keyword) || fileName.includes(keyword) || description.includes(keyword)
            );
            
            // Try to detect by checking page content (only if HTML file exists)
            let isStoreByContent = false;
            let isEventByContent = false;
            
            // Skip content checking for pages without HTML files
            if (project.hasHtmlFile !== false) {
                try {
                    // Fetch the page to check its content
                    const pageUrl = `/users/${project.userId || currentUser?.id}/${fileName}`;
                    const response = await fetch(pageUrl);
                    if (response.ok) {
                    const htmlContent = await response.text();
                    const lowerContent = htmlContent.toLowerCase();
                    
                    // Check for store indicators in content
                    const hasAddToCart = lowerContent.includes('addtocart') || 
                                        lowerContent.includes('×”×•×¡×£ ×œ×¢×’×œ×”') ||
                                        lowerContent.includes('add to cart');
                    const hasCartElement = lowerContent.includes('cart-sidebar') || 
                                          lowerContent.includes('shopping-cart') ||
                                          lowerContent.includes('×¢×’×œ×ª ×§× ×™×•×ª');
                    const hasPrice = (lowerContent.match(/â‚ª\d+/g) || []).length > 3;
                    
                    isStoreByContent = hasAddToCart || hasCartElement || (hasPrice && lowerContent.includes('product'));
                    
                    // Check for event indicators
                    const hasRSVP = lowerContent.includes('rsvp') || lowerContent.includes('××™×©×•×¨ ×”×’×¢×”');
                    const hasEventDate = lowerContent.includes('×ª××¨×™×š ×”××™×¨×•×¢') || lowerContent.includes('event date');
                    
                    isEventByContent = hasRSVP || hasEventDate;
                    
                    console.log('ğŸ” Page type detection:', {
                        fileName,
                        isStoreByName,
                        isStoreByContent,
                        isEventByName,
                        isEventByContent,
                        hasAddToCart,
                        hasCartElement
                    });
                    }
                } catch (error) {
                    console.log('Could not fetch page content for type detection:', error);
                }
            } else {
                console.log('â© Skipping content check for page without HTML file:', fileName);
            }
            
            // PRIORITY 2: Content-based detection
            if (isEventByContent || isEventByName) {
                console.log(`âœ… Detected event from ${isEventByContent ? 'content' : 'name'}`);
                return 'event';
            }
            if (isStoreByContent || isStoreByName) {
                console.log(`âœ… Detected store from ${isStoreByContent ? 'content' : 'name'}`);
                return 'store';
            }
            
            console.log(`â„¹ï¸ No specific type detected for ${fileName}, defaulting to 'other'`);
            return 'other';
        }
        
        function getManageButtonText(pageType) {
            switch(pageType) {
                case 'event': return '× ×™×”×•×œ ××•×–×× ×™×';
                case 'store': 
                case 'onlineStore': return '× ×™×”×•×œ ×—× ×•×ª';
                case 'course': return '× ×™×”×•×œ ×§×•×¨×¡×™×';
                case 'workshop': return '× ×™×”×•×œ × ×¨×©××™×';
                default: return '× ×™×”×•×œ';
            }
        }
        
        function getManageUrl(pageType, fileName, userId) {
            switch(pageType) {
                case 'event': return `/event-admin.html?page=${fileName}&userId=${userId}`;
                case 'store':
                case 'onlineStore': return `/page-management.html?page=${fileName}&userId=${userId}`;
                case 'course': return `/course-management.html?pageId=${fileName}&userId=${userId}`;
                case 'workshop': return `/leads-admin.html?page=${fileName}&userId=${userId}`;
                default: return `/leads-admin.html?page=${fileName}&userId=${userId}`;
            }
        }
        
        // --- ×¤×¨×•×™×§×˜×™× ---
        async function loadProjects() {
            // Prevent concurrent calls - CRITICAL for Edge performance
            if (isLoadingProjects) {
                console.log('âš ï¸ loadProjects already running, skipping...');
                return;
            }
            isLoadingProjects = true;
            
            // Edge: Force timeout after 5 seconds
            if (isEdge) {
                setTimeout(() => {
                    if (isLoadingProjects) {
                        console.error('â° loadProjects timeout - forcing unlock');
                        isLoadingProjects = false;
                    }
                }, window.EDGE_TIMEOUT || 5000);
            }
            
            console.log('loadProjects ×”×ª×—×™×œ');
            console.log('currentUser:', currentUser);
            
            const projectsList = document.getElementById('projects-list');
            if (!projectsList) {
                console.error('×œ× × ××¦× projects-list element');
                isLoadingProjects = false;
                return;
            }
            
            if (!currentUser) {
                console.error('currentUser ×œ× ××•×’×“×¨!');
                projectsList.innerHTML = '<div class="text-center py-16 col-span-full">×©×’×™××”: ××©×ª××© ×œ× ××—×•×‘×¨</div>';
                isLoadingProjects = false;
                return;
            }
            projectsList.innerHTML = `
                <div class="col-span-full flex flex-col items-center justify-center py-8">
                    <div class="gen-loader">
                        <div class="inner one"></div>
                        <div class="inner two"></div>
                        <div class="inner three"></div>
                    </div>
                    <p class="gen-text">×˜×•×¢×Ÿ ×“×¤×™×...</p>
                </div>
            `;
            console.log('×”×•×¡×¤×ª×™ loader');
            
            projects = []; // Reset global projects array
            let supabaseError = null;
            
            // × ×¡×” ×œ×˜×¢×•×Ÿ ×-Supabase
            try {
                console.log('×× ×¡×” ×œ×˜×¢×•×Ÿ ×-Supabase...');
                const { data: supabaseProjects, error } = await supabaseClient
                    .from('projects')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('created_at', { ascending: false });
                
                if (!error && supabaseProjects) {
                    projects = supabaseProjects;
                    console.log('× ×˜×¢× ×• ×-Supabase:', projects.length, '×¤×¨×•×™×§×˜×™×');
                    
                    // Try to enrich Supabase projects with pageType from local API
                    try {
                        const localResponse = await fetch(`/api/pages/${currentUser.id}`);
                        const localData = await localResponse.json();
                        
                        if (localData.pages && localData.pages.length > 0) {
                            // Create a map of fileName -> pageType
                            const pageTypeMap = {};
                            localData.pages.forEach(page => {
                                if (page.pageType) {
                                    pageTypeMap[page.fileName] = page.pageType;
                                }
                            });
                            
                            // Enrich Supabase projects with pageType
                            projects.forEach(project => {
                                // Try to match by various fields
                                let matchingPageType = pageTypeMap[project.local_file] || 
                                                      pageTypeMap[project.id];
                                
                                // If no match, try fuzzy matching by name
                                if (!matchingPageType) {
                                    const projectName = (project.name || '').toLowerCase();
                                    for (const [fileName, pageType] of Object.entries(pageTypeMap)) {
                                        const cleanFileName = fileName.replace(/_html$/, '').replace(/\.html$/, '').replace(/_/g, ' ').toLowerCase();
                                        if (projectName.includes(cleanFileName) || cleanFileName.includes(projectName)) {
                                            matchingPageType = pageType;
                                            console.log(`ğŸ” Fuzzy matched: "${projectName}" â†” "${cleanFileName}" â†’ ${pageType}`);
                                            break;
                                        }
                                    }
                                }
                                
                                // If still no match and it's a store-like name, default to 'store'
                                if (!matchingPageType) {
                                    const projectName = (project.name || '').toLowerCase();
                                    const storeKeywords = ['×××ª×§', '×©×•×§×•×œ×“', '×—× ×•×ª', '××›×™×¨×”', 'store', 'shop', 'sweet', '×©×¢×•× '];
                                    if (storeKeywords.some(kw => projectName.includes(kw))) {
                                        matchingPageType = 'store';
                                        console.log(`ğŸª Auto-detected as store by name: ${project.name}`);
                                    }
                                }
                                
                                if (matchingPageType) {
                                    project.pageType = matchingPageType;
                                    console.log(`âœ… Enriched project with pageType: ${matchingPageType} for ${project.name}`);
                                }
                            });
                        }
                    } catch (enrichErr) {
                        console.log('Could not enrich with local pageTypes:', enrichErr);
                    }
                } else {
                    console.log('×©×’×™××” ×‘-Supabase:', error);
                    supabaseError = error;
                }
            } catch (err) {
                console.log('×©×’×™××” ×‘-Supabase, ×¢×•×‘×¨ ×œ× ×ª×•× ×™× ××§×•××™×™×:', err);
                supabaseError = err;
            }
            
            // ×× Supabase × ×›×©×œ, ×˜×¢×Ÿ ××§×•××™×ª
            if (supabaseError || projects.length === 0) {
                try {
                    console.log('×× ×¡×” ×œ×˜×¢×•×Ÿ × ×ª×•× ×™× ××§×•××™×™×...');
                    const localResponse = await fetch(`/api/pages/${currentUser.id}`);
                    const localData = await localResponse.json();
                    
                    if (localData.pages && localData.pages.length > 0) {
                        // ×”××¨ ×“×¤×™× ××§×•××™×™× ×œ×¤×•×¨××˜ Supabase
                        projects = localData.pages.map(page => {
                            // ×—×œ×¥ ×©× × ×§×™ ××ª×•×š ×©× ×”×§×•×‘×¥
                            let cleanName = page.title || '×“×£ × ×—×™×ª×”';
                            
                            // DISABLED: Removed multiple fetch requests that caused Edge to freeze
                            // Instead, we extract title from filename only
                            // This prevents dozens of simultaneous HTTP requests
                            
                            // ×× ×™×© ×©× ×§×•×‘×¥ ×¢× timestamp, × ×¡×” ×œ×—×œ×¥ ×©× ×™×•×ª×¨ ×˜×•×‘
                            if (page.fileName && page.fileName.includes('_')) {
                                const namePart = page.fileName.split('_')[0];
                                if (namePart && namePart !== 'page' && namePart !== '×“×£' && namePart.length > 2) {
                                    cleanName = decodeURIComponent(namePart);
                                }
                            }
                            
                            const projectObj = {
                            id: `local_${page.fileName}`,
                                name: cleanName,
                                description: '×“×£ × ×—×™×ª×” ××§×¦×•×¢×™',
                            html_content: null, // × ×˜×¢×Ÿ ×‘× ×¤×¨×“
                            template_type: 'local',
                            status: 'completed',
                            created_at: new Date().toISOString(),
                            local_file: page.fileName,
                            local_url: page.url,
                                user_id: currentUser.id,
                                userId: currentUser.id,
                                pageType: page.pageType // CRITICAL: Pass pageType from server!
                            };
                            
                            console.log(`âœ… Local page loaded with pageType: ${page.pageType} for ${page.fileName}`);
                            
                            return projectObj;
                        });
                        console.log('× ×˜×¢× ×• ×“×¤×™× ××§×•××™×™×:', projects.length);
                    }
                } catch (localErr) {
                    console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×“×¤×™× ××§×•××™×™×:', localErr);
                    console.log('××¦×™×’ ×”×•×“×¢×” ×¨×™×§×”...');
                }
            }
            
            console.log('×¡×™×™××ª×™ ×œ×˜×¢×•×Ÿ, ×™×©', projects.length, '×¤×¨×•×™×§×˜×™×');
            
            // ×× ×™×© ×©×’×™××” ×-Supabase ××‘×œ ×™×© ×“×¤×™× ××§×•××™×™×, × ××©×™×š
            // ×× ××™×Ÿ ×“×¤×™× ×‘×›×œ×œ, × ×¦×™×’ ×”×•×“×¢×” ×¨×™×§×”
            
            if (projects && projects.length > 0) {
                console.log('××¦×™×’', projects.length, '×¤×¨×•×™×§×˜×™×');
                projectsList.innerHTML = '';
                
                projects.forEach((project, index) => {
                    console.log(`××¦×™×’ ×¤×¨×•×™×§×˜ ${index + 1}:`, project.name);
                    
                    // Use pageType from server (already detected and saved)
                    const pageType = project.pageType || 'other';
                    const manageButtonText = getManageButtonText(pageType);
                    console.log(`ğŸ“‹ Page type: ${pageType} â†’ Button text: "${manageButtonText}" for ${project.name}`);
                    
                    const creationDate = new Date(project.created_at).toLocaleDateString('he-IL');
                    const projectCard = document.createElement('div');
                    projectCard.className = 'bg-white p-4 rounded-xl border border-gray-200 shadow-md hover:shadow-lg hover:border-indigo-400 hover:-translate-y-1 transition-all duration-300 flex flex-col overflow-hidden backdrop-blur-sm bg-white/95';
        projectCard.style.minHeight = '450px';
        projectCard.style.maxHeight = '450px';
        projectCard.style.display = 'flex';
        projectCard.style.flexDirection = 'column';
        projectCard.style.position = 'relative';
                    projectCard.setAttribute('data-project-id', project.id);
                    
                    const hasHtmlContent = (project.html_content && project.html_content.trim() !== '') || project.local_url;
                    
                    // ×‘×“×•×§ ×× ×”×“×£ ×”×–×” ×™×© ×œ×• ×× ×•×™ ×¤×¢×™×œ - USE project.id!
                    const storageKey = `page_subscription_${project.id}`;
                    const pageSubscription = localStorage.getItem(storageKey);
                    const hasPageSubscription = pageSubscription && JSON.parse(pageSubscription).isActive;
                    
                    console.log(`ğŸ“„ Page ID: ${project.id}`);
                    console.log(`ğŸ”‘ Storage key: ${storageKey}`);
                    console.log(`ğŸ“¦ Subscription data: ${pageSubscription}`);
                    console.log(`âœ… Has active subscription: ${hasPageSubscription}`);
                    
                    // ×“×¤×™× ×—×“×©×™× ××ª×—×™×œ×™× ×œ×œ× ×× ×•×™ (××™×Ÿ ×× ×•×™ ×‘-localStorage)
                    const finalHasSubscription = hasPageSubscription;
                    
                    const statusBadge = finalHasSubscription ? 
                        '<span class="status-badge status-completed">×× ×•×™ ×¤×¢×™×œ</span>' :
                        '<span class="status-badge status-processing">×× ×•×™ ×œ× ×¤×¢×™×œ</span>';
                    
                    // ×§×‘×œ ××ª ×›×ª×•×‘×ª ×”×“×£
                    const pageUrl = project.local_url || (project.html_content ? '#' : '');
                    
        const actionButtons = `
            <div class="flex items-center justify-between gap-2 w-full">
                <div class="flex items-center gap-2 flex-wrap flex-1">
                    ${hasHtmlContent && finalHasSubscription ?
                        `<button onclick="viewProject('${project.id}')" class="bg-green-500 text-white px-3 py-2 rounded text-sm font-medium hover:bg-green-600 transition shadow-sm" style="min-width: 60px;">
                            ×¦×¤×”
                        </button>` :
                        hasHtmlContent && !finalHasSubscription ?
                        `<button onclick="openPageSubscriptionModal('${project.id}')" class="bg-yellow-500 text-white px-3 py-2 rounded text-sm font-medium hover:bg-yellow-600 transition shadow-sm" style="min-width: 80px;">
                            ×”×¤×¢×œ ×× ×•×™
                        </button>` : ''
                    }
                    ${pageUrl && finalHasSubscription ?
                        `<button onclick="copyToClipboard('${window.location.origin}${pageUrl}')" class="bg-purple-500 text-white px-3 py-2 rounded text-sm font-medium hover:bg-purple-600 transition shadow-sm" style="min-width: 60px;">
                            ×”×¢×ª×§ ×§×™×©×•×¨
                        </button>` : ''
                    }
                </div>
                
                <!-- ×›×¤×ª×•×¨ ×ª×¤×¨×™×˜ -->
                <div class="relative dropdown-container">
                    <button onclick="toggleDropdown(event, '${project.id}')" class="bg-gray-700 text-white px-3 py-2 rounded text-sm font-medium hover:bg-gray-800 transition shadow-sm flex items-center gap-1" style="min-width: 60px;">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"></path>
                    </svg>
                </button>
                    
                    <!-- ×ª×¤×¨×™×˜ × ×¤×ª×— -->
                    <div id="dropdown-${project.id}" class="dropdown-menu hidden absolute left-0 bottom-full mb-2 bg-white rounded-lg shadow-xl border border-gray-200 py-1 z-50" style="min-width: 150px;">
                        <button onclick="editProject('${project.id}')" class="w-full text-right px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 flex items-center gap-2">
                            <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                        ×¢×¨×•×š
                        </button>
                        ${hasHtmlContent ?
                            `<button data-action="manage" data-page-type="${pageType}" onclick="manageProject('${project.id}', '${pageType}')" class="w-full text-right px-4 py-2 text-sm text-gray-700 hover:bg-indigo-50 flex items-center gap-2">
                                <svg class="w-4 h-4 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                <span class="manage-button-text">${manageButtonText}</span>
                            </button>` : ''
                        }
                        <button onclick="deleteProject('${project.id}')" class="w-full text-right px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2 border-t border-gray-100">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                        ××—×§
                        </button>
                    </div>
                </div>
            </div>
        `;
                    
                    projectCard.innerHTML = `
                            <!-- ×ª×¦×•×’×” ××§×“×™××” ×©×œ ×”××ª×¨ -->
                        <div class="relative rounded-t-xl overflow-hidden bg-gradient-to-br from-gray-50 to-gray-100" style="height: 200px; flex-shrink: 0;">
                                ${pageUrl ? `
                                    <!-- ×ª×¦×•×’×” ××§×“×™××” ×©×œ ×”××ª×¨ -->
                                    <div class="absolute inset-2 bg-white rounded-lg overflow-hidden shadow-lg border border-gray-300">
                                        <iframe 
                                            src="${window.location.origin}${pageUrl}" 
                                            class="w-full h-full border-0"
                                            style="pointer-events: none; transform: scale(0.6) translateX(65%); transform-origin: top left; width: 166.67%; height: 166.67%;"
                                            title="×ª×¦×•×’×” ××§×“×™××” ×©×œ ${project.name}"
                                            loading="lazy"
                                            importance="low"
                                            sandbox="allow-same-origin allow-scripts allow-popups allow-forms">
                                        </iframe>
                                    </div>
                                ` : `
                                    <!-- ×ª×¦×•×’×” ××§×“×™××” ×¡×˜×˜×™×ª -->
                                    <div class="absolute inset-0 bg-gradient-to-br from-indigo-500/10 to-purple-500/10"></div>
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <div class="text-center">
                                            <div class="w-16 h-16 bg-white/90 rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg border-2 border-indigo-200">
                                                <span class="text-2xl font-bold text-indigo-600">${project.name.charAt(0)}</span>
                                            </div>
                                            <div class="text-sm font-medium text-gray-700 bg-white/90 px-3 py-1 rounded-full shadow-sm border border-gray-200">
                                                ××™×Ÿ ×ª×•×›×Ÿ
                                            </div>
                                        </div>
                                    </div>
                                `}
                                ${finalHasSubscription ? `
                                    <div class="absolute top-3 right-3">
                                        <div class="bg-green-500 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1">
                                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                            </svg>
                                            ×–××™×Ÿ ×œ×¦×¤×™×™×”
                                        </div>
                                    </div>
                                ` : `
                                    <div class="absolute top-3 right-3">
                                        <div class="bg-amber-500 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1">
                                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                            </svg>
                                            ×××ª×™×Ÿ
                                        </div>
                                    </div>
                                `}
                            </div>
                            
                        <!-- ×ª×•×›×Ÿ ×”×›×¨×˜×™×¡ -->
                        <div class="p-4 flex-1 flex flex-col" style="min-height: 0; overflow: hidden;">
                            <!-- ×›×•×ª×¨×ª ×•×¡×˜×˜×•×¡ -->
                            <div class="mb-3 flex-shrink-0">
                                    <h3 class="font-semibold text-lg text-gray-800 mb-2" style="min-height: 24px;">${project.name}</h3>
                                <p class="text-sm text-gray-500 mb-3 line-clamp-2" style="min-height: 32px;">${project.description || '×“×£ × ×—×™×ª×” ××§×¦×•×¢×™'}</p>
                                <div class="flex items-center justify-between text-xs text-gray-400 mb-2">
                                    <span>× ×•×¦×¨: ${creationDate}</span>
                                    ${statusBadge}
                                </div>
                            </div>
                            
                        </div>
                        
                        <!-- ×¤×¡ ×›×¤×ª×•×¨×™× ×‘×ª×—×ª×™×ª -->
                        <div class="border-t border-gray-100 bg-gray-50 px-4 py-3 rounded-b-xl flex-shrink-0" style="min-height: 70px; display: flex; align-items: center;">
                            <div class="flex items-center justify-center gap-2 flex-wrap w-full">${actionButtons}</div>
                        </div>
                    `;
                    console.log(`××•×¡×™×£ ×›×¨×˜×™×¡ ${index + 1} ×œ-DOM`);
                    projectsList.appendChild(projectCard);
                });
                console.log('×¡×™×™××ª×™ ×œ×”×•×¡×™×£ ×›×¨×˜×™×¡×™×');
                
                // ×¢×“×›×Ÿ ××ª ×”××•×“×œ ×¨×§ ×× ×”××©×ª××© ×‘×™×§×© ×–××ª ×‘××¤×•×¨×©
                // ×”×•×¡×¨ ×¨×¢× ×•×Ÿ ××•×˜×•××˜×™ ×©×’×¨× ×œ×‘×¢×™×•×ª
            } else {
                 projectsList.innerHTML = `
                    <div class="text-center py-16 col-span-full">
                        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path vector-effect="non-scaling-stroke" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" /></svg>
                        <h3 class="mt-2 text-lg font-medium text-gray-900">×¢×“×™×™×Ÿ ××™×Ÿ ×“×¤×™ × ×—×™×ª×”</h3>
                        <p class="mt-1 text-sm text-gray-500">×”×’×™×¢ ×”×–××Ÿ ×œ×™×¦×•×¨ ××ª ×“×£ ×”× ×—×™×ª×” ×”×¨××©×•×Ÿ ×©×œ×š.</p>
                        <div class="mt-6">
                            <button onclick="goToFullApp()" class="bg-indigo-600 text-white py-2 px-6 rounded-lg font-bold hover:bg-indigo-700 transition-transform transform hover:scale-105 flex items-center gap-2 mx-auto">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                                <span>×¦×•×¨ ×“×£ ×—×“×©</span>
                            </button>
                        </div>
                    </div>
                `;
            }
            
            // Release lock after loading completes
            isLoadingProjects = false;
        }

        async function viewProject(projectId) {
            console.log('ğŸ‘ï¸ viewProject called with:', projectId);
            
            try {
            // ×‘×“×•×§ ×× ×–×” ×“×£ ××§×•××™
            if (projectId.startsWith('local_')) {
                const fileName = projectId.replace('local_', '');
                    
                    if (!currentUser || !currentUser.id) {
                        console.error('âŒ currentUser not defined!');
                        alert('×©×’×™××”: ××©×ª××© ×œ× ××—×•×‘×¨');
                        return;
                    }
                    
                const url = `/pages/${currentUser.id}/${fileName}`;
                    console.log('ğŸŒ Opening URL:', url);
                
                // ×¤×ª×— ×‘×—×œ×•×Ÿ ×—×“×©
                const newWindow = window.open(url, '_blank');
                    if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
                        console.warn('âš ï¸ Popup blocked, trying same tab');
                        window.location.href = url;
                    } else {
                        console.log('âœ… Page opened in new tab');
                    }
                    return;
                }
            } catch (error) {
                console.error('âŒ Error in viewProject:', error);
                alert('×©×’×™××” ×‘×¤×ª×™×—×ª ×”×“×£: ' + error.message);
                return;
            }
            
            // ×“×£ ×-Supabase
            try {
                const { data: project, error } = await supabaseClient.from('projects').select('html_content, name').eq('id', projectId).single();
                if (error || !project) return showError('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×¤×¨×•×™×§×˜.');
                if (!project.html_content) return showError('×œ× × ××¦× ×ª×•×›×Ÿ HTML ×œ×¤×¨×•×™×§×˜ ×–×”.');

                // ×¤×ª×— ×‘×—×œ×•×Ÿ ×—×“×©
                const newWindow = window.open("");
                if (newWindow) {
                    newWindow.document.write(project.html_content);
                    newWindow.document.close();
                    newWindow.document.title = project.name || '×“×£ × ×—×™×ª×”';
                } else {
                    showError('×¤×ª×™×—×ª ×—×œ×•×Ÿ ×—×“×© × ×›×©×œ×”. ×‘×“×•×§ ×—×•×¡× ×¤×•×¤-××¤×™×.');
                }
            } catch (err) {
                console.error('Error viewing project:', err);
                showError('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×¤×¨×•×™×§×˜.');
            }
        }

        function editProject(projectId) {
            window.location.href = `/page-creator?edit=${projectId}&redirectUrl=${encodeURIComponent(window.location.href)}`;
        }

        function updateManagementButton(projectCard, pageType) {
            const manageButton = projectCard.querySelector('[data-action="manage"]');
            if (manageButton) {
                if (pageType === 'store' || pageType === 'onlineStore') {
                    manageButton.textContent = 'ğŸ›’ × ×™×”×•×œ ×—× ×•×ª';
                } else if (pageType === 'event') {
                    manageButton.textContent = 'ğŸ‰ × ×™×”×•×œ ××•×–×× ×™×';
                } else {
                    manageButton.textContent = 'âš™ï¸ × ×™×”×•×œ';
                }
            }
        }

        function getManagementButtonText(project) {
            // First check if pageType was auto-detected
            if (project.pageType === 'store' || project.pageType === 'onlineStore') {
                return '× ×™×”×•×œ ×—× ×•×ª';
            }
            if (project.pageType === 'event') {
                return '× ×™×”×•×œ ××•×–×× ×™×';
            }
            
            // Fallback: Detect page type from name or description  
            const name = (project.name || '').toLowerCase();
            const desc = (project.description || '').toLowerCase();
            const fileName = (project.local_file || project.id || '').toLowerCase();
            const combined = name + ' ' + desc + ' ' + fileName;
            
            // Store detection - ALL products/shops
            if (combined.includes('×—× ×•×ª') || combined.includes('××•×¦×¨') || combined.includes('×§× ×™×”') || 
                combined.includes('store') || combined.includes('shop') || combined.includes('××§×¨×•× ×™') ||
                combined.includes('×¦×¢×¦×•×¢') || combined.includes('×¡×¤×¨×™×') || combined.includes('×××ª×§') ||
                combined.includes('×¤×™×¦') || combined.includes('pizza') || combined.includes('××¡×¢×“') ||
                combined.includes('×‘×™×™×’×œ') || combined.includes('bagel') || combined.includes('×××¤×”') ||
                combined.includes('×œ×—×') || combined.includes('×§×¤×”') || combined.includes('××©×§×”') ||
                combined.includes('×‘×’×“') || combined.includes('× ×¢×œ') || combined.includes('××•×¤× ×”') ||
                combined.includes('××œ×§×˜×¨×•× ×™×§×”') || combined.includes('××—×©×‘') || combined.includes('×˜×œ×¤×•×Ÿ') ||
                combined.includes('×™×”×œ×•××™') || combined.includes('×™×”×œ×•×') || combined.includes('×ª×›×©×™×˜') || combined.includes('×©×¢×•×Ÿ') ||
                combined.includes('×–×”×‘') || combined.includes('×›×¡×£') || combined.includes('jewelry') ||
                combined.includes('××›×•×œ×ª') || combined.includes('×¡×•×¤×¨') || combined.includes('market') ||
                combined.includes('×•×™×œ×•× ×•×ª') || combined.includes('×¨×”×™×˜') || combined.includes('×¢×™×¦×•×‘ ×¤× ×™×') ||
                combined.includes('×¦××—') || combined.includes('×¤×¨×—') || combined.includes('×’×™× ×”') ||
                combined.includes('candy') || combined.includes('sweet') || combined.includes('chocolate')) {
                return '× ×™×”×•×œ ×—× ×•×ª';
            }
            // Event detection - EXPANDED
            if (combined.includes('××™×¨×•×¢') || combined.includes('×›× ×¡') || combined.includes('××¤×’×©') || 
                combined.includes('××•×–××Ÿ') || combined.includes('×—×ª×•× ×”') || combined.includes('×‘×¨ ××¦×•×”') ||
                combined.includes('×‘×ª ××¦×•×”') || combined.includes('×”×–×× ×”') || combined.includes('event') ||
                combined.includes('wedding') || combined.includes('invitation') || combined.includes('×—×™× ×”') ||
                combined.includes('××¡×™×‘×”') || combined.includes('×™×•× ×”×•×œ×“×ª')) {
                return '× ×™×”×•×œ ××•×–×× ×™×';
            }
            // Course detection
            if (combined.includes('×§×•×¨×¡') || combined.includes('×œ×™××•×“') || combined.includes('×”×“×¨×›×”') ||
                combined.includes('course') || combined.includes('workshop')) {
                return '× ×™×”×•×œ ×§×•×¨×¡';
            }
            // Default
            return '× ×™×”×•×œ';
        }
        
        function toggleDropdown(event, projectId) {
            event.stopPropagation();
            
            // ×¡×’×•×¨ ×›×œ ×”×ª×¤×¨×™×˜×™× ×”×¤×ª×•×—×™×
            document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                if (menu.id !== `dropdown-${projectId}`) {
                    menu.classList.remove('show');
                }
            });
            
            // ×¤×ª×—/×¡×’×•×¨ ××ª ×”×ª×¤×¨×™×˜ ×”× ×•×›×—×™
            const dropdown = document.getElementById(`dropdown-${projectId}`);
            dropdown.classList.toggle('show');
        }
        
        async function manageProject(projectId, detectedPageType = null) {
            console.log('ğŸ” manageProject called with:', projectId, 'pageType:', detectedPageType);
            
            // ×—×œ×¥ ××ª ×©× ×”×§×•×‘×¥ ×•×”××©×ª××©
            const fileName = projectId.startsWith('local_') ? projectId.replace('local_', '') : projectId;
            
            // ××¦× ××ª ×”×¤×¨×•×™×§×˜ ×›×“×™ ×œ×§×‘×œ ××ª ×”-userId ×©×œ×•
            const project = projects.find(p => p.id === projectId);
            
            console.log('ğŸ“¦ Project object:', project);
            
            // Try to get userId from multiple sources
            let userId = currentUser?.id;
            if (!userId && project?.userId) {
                userId = project.userId;
            }
            if (!userId && project?.user_id) {
                userId = project.user_id;
            }
            // If still no userId, extract from URL
            if (!userId && project?.local_url) {
                const urlMatch = project.local_url.match(/\/pages\/([^\/]+)\//);
                if (urlMatch) {
                    userId = urlMatch[1];
                }
            }
            
            console.log('ğŸ‘¤ userId:', userId, 'ğŸ“„ fileName:', fileName);
            
            if (!userId) {
                alert('×©×’×™××”: ×œ× × ×™×ª×Ÿ ×œ×–×”×•×ª ××ª ×”××©×ª××©.');
                return;
            }
            
            // Use detected page type or load from metadata
            let pageType = detectedPageType || project?.pageType;
            
            if (!pageType) {
                try {
                    const metadataUrl = `/pages/${userId}/${fileName}_data/metadata.json`;
                    const response = await fetch(metadataUrl);
                    if (response.ok) {
                        const metadata = await response.json();
                        pageType = metadata.pageType;
                        console.log('ğŸ“‹ Loaded pageType from metadata:', pageType);
                    }
                } catch (err) {
                    console.log('âš ï¸ No metadata, using default');
                }
            }
            
            // Determine management URL based on pageType
            let managementUrl;
            
            console.log('ğŸ” FINAL pageType for routing:', pageType, 'Type:', typeof pageType);
            
            if (pageType === 'event') {
                // ×“×£ ××™×¨×•×¢/×”×–×× ×” â†’ × ×™×”×•×œ ××•×–×× ×™×
                managementUrl = `/event-guests.html?eventId=${fileName}&userId=${userId}`;
                console.log('ğŸ‰ Opening EVENT management (guests)');
            } else if (pageType === 'store' || pageType === 'onlineStore') {
                // ×“×£ ×—× ×•×ª â†’ × ×™×”×•×œ ×—× ×•×ª
                managementUrl = `/page-management.html?page=${fileName}&userId=${userId}`;
                console.log('ğŸ›’ Opening STORE management for:', fileName);
            } else {
                // ×“×¤×™× ××—×¨×™× â†’ × ×™×”×•×œ ×œ×™×“×™×
                managementUrl = `/leads-admin.html?page=${fileName}&userId=${userId}`;
                console.log('ğŸ“‹ Opening LEADS management (pageType was:', pageType, ')');
            }
            
            console.log('ğŸŒ Opening:', managementUrl);
            
            // Open in new tab
            const newWindow = window.open(managementUrl, '_blank');
            
            // Fallback: if popup blocked, open in same tab
            if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
                console.warn('âš ï¸ Popup blocked, opening in same tab');
                window.location.href = managementUrl;
            }
        }
        
        // ×¡×’×•×¨ ×ª×¤×¨×™×˜×™× ×›×©×œ×•×—×¦×™× ××—×•×¥ ×œ×”×
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.dropdown-container')) {
                document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                    menu.classList.remove('show');
                });
            }
        });

        async function cleanOrphanedData() {
            if (!confirm('ğŸ§¹ ×”×× ×œ× ×§×•×ª × ×ª×•× ×™× ×™×ª×•××™× (×§× ×™×•×ª ×•××•×–×× ×™× ××“×¤×™× ×©× ××—×§×•)?')) return;
            
            try {
                const response = await fetch('/api/clean-orphaned-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: currentUser.id
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    showSuccess(data.message);
                    console.log('âœ… Cleaned:', data);
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || '×©×’×™××” ×‘× ×™×§×•×™ × ×ª×•× ×™×');
                }
            } catch (error) {
                console.error('Error cleaning data:', error);
                showError('×©×’×™××” ×‘× ×™×§×•×™ × ×ª×•× ×™×: ' + error.message);
            }
        }

        async function deleteProject(projectId) {
            if (!confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×“×£ ×”× ×—×™×ª×”? ×”×¤×¢×•×œ×” ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ.')) return;
            
            try {
                // ×‘×“×•×§ ×× ×–×” ×“×£ ××§×•××™
                if (projectId.startsWith('local_')) {
                    const fileName = projectId.replace('local_', '');
                    console.log('Deleting local file:', fileName);
                    
                    // ××—×§ ××”×©×¨×ª ×”××§×•××™
                    const response = await fetch(`/api/delete-page`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            userId: currentUser.id,
                            fileName: fileName
                        })
                    });
                    
                    if (response.ok) {
                        showSuccess('×”×“×£ × ××—×§ ×‘×”×¦×œ×—×”');
                        loadProjects(); // ×¨×¢× ×Ÿ ××ª ×”×¨×©×™××”
                    } else {
                        const errorData = await response.json();
                        throw new Error(errorData.error || '×©×’×™××” ×‘××—×™×§×ª ×”×“×£ ×”××§×•××™');
                    }
                    return;
                }
                
                // ×“×£ ×-Supabase
                const { error } = await supabaseClient.from('projects').delete().eq('id', projectId);
                if (error) throw error;
                
                showSuccess('×”×“×£ × ××—×§ ×‘×”×¦×œ×—×”');
                loadProjects(); // ×¨×¢× ×Ÿ ××ª ×”×¨×©×™××”
            } catch (error) {
                console.error('Error deleting project:', error);
                showError('×©×’×™××” ×‘××—×™×§×ª ×”×¤×¨×•×™×§×˜: ' + error.message);
            }
        }

        async function signOut() {  
            // Clear all intervals to prevent memory leaks
            if (subscriptionTimer) {
                clearInterval(subscriptionTimer);
                subscriptionTimer = null;
            }
            if (adminTimeInterval) {
                clearInterval(adminTimeInterval);
                adminTimeInterval = null;
            }
            
            // Clear user data
            clearCurrentUser();
            currentUser = null;
            subscriptionData = null;
            isAdmin = false;
            
            // Sign out from Supabase
            await supabaseClient.auth.signOut();  
        }

        function goToFullApp() {  
            window.location.href = '/page-creator?redirectUrl=' + encodeURIComponent(window.location.href);  
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);

            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showSuccess('×”×›×ª×•×‘×ª ×”×•×¢×ª×§×” ×œ×œ×•×—');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                showError('×©×’×™××” ×‘×”×¢×ª×§×ª ×”×›×ª×•×‘×ª');
            });
        }

        // --- Event Listeners ---
        adminPanelBtn.addEventListener('click', openAdminPanel);
        closeAdminPanel.addEventListener('click', closeAdminPanelHandler);
        
        // Account summary button
        const accountSummaryBtn = document.getElementById('account-summary-btn');
        if (accountSummaryBtn) {
            accountSummaryBtn.addEventListener('click', openAccountSummaryModal);
        }

        // Admin tab switching
        document.getElementById('dashboard-tab').addEventListener('click', () => switchAdminTab('dashboard', '×“×©×‘×•×¨×“'));
        document.getElementById('users-tab').addEventListener('click', () => switchAdminTab('users', '× ×™×”×•×œ ××©×ª××©×™×'));
        document.getElementById('finance-tab').addEventListener('click', () => switchAdminTab('finance', '× ×™×”×•×œ ×›×¡×¤×™×'));
        document.getElementById('analytics-tab').addEventListener('click', () => switchAdminTab('analytics', '×¡×˜×˜×™×¡×˜×™×§×•×ª'));
        document.getElementById('settings-tab').addEventListener('click', () => switchAdminTab('settings', '×”×’×“×¨×•×ª'));

        function switchAdminTab(tabName, title) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active class from all sidebar tabs
            document.querySelectorAll('[id$="-tab"]').forEach(tab => {
                tab.classList.remove('text-white', 'bg-indigo-600');
                tab.classList.add('text-gray-700', 'hover:bg-gray-50', 'hover:text-gray-900');
            });
            
            // Show selected tab content
            document.getElementById(`${tabName}-content`).classList.remove('hidden');
            
            // Add active class to selected tab
            const selectedTab = document.getElementById(`${tabName}-tab`);
            selectedTab.classList.add('text-white', 'bg-indigo-600');
            selectedTab.classList.remove('text-gray-700', 'hover:bg-gray-50', 'hover:text-gray-900');
            
            // Update page title
            if (adminPageTitle) {
                adminPageTitle.textContent = title;
            }
        }

        // --- ×××–×™× ×™× ×œ××™×¨×•×¢×™× ---
        supabaseClient.auth.onAuthStateChange((event, session) => {
            console.log('Auth state changed:', event);
            if (event === 'SIGNED_OUT') {
                currentUser = null;
                clearCurrentUser();
                isAdmin = false;
                isDashboardLoading = false; // Reset dashboard lock
                dashboardView.classList.add('hidden');
                loginView.classList.remove('hidden');
                document.body.classList.remove('bg-gray-50');
                if (!document.getElementById('googleSignInBtn').onclick) {
                   initGoogleSignIn();
                }
            } else if (event === 'SIGNED_IN' && session) {
                // Only update if not already showing dashboard
                if (dashboardView.classList.contains('hidden')) {
                currentUser = session.user;
                saveCurrentUser(currentUser);
                setTimeout(() => {
                showDashboard();
                }, 100);
                } else {
                    console.log('Dashboard already shown, skipping SIGNED_IN handler');
                }
            }
        });
    </script>

    <!-- Account Summary Modal -->
    <div id="account-summary-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-bold text-gray-900">×¡×™×›×•× ×—×©×‘×•×Ÿ</h3>
                    <button onclick="closeAccountSummaryModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="mb-4">
                    <div class="text-sm text-gray-500">×¢×“×›×•×Ÿ ××—×¨×•×Ÿ: <span id="modal-last-update"></span></div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-lg">
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <p class="text-sm font-medium text-blue-600">×“×¤×™× ×©× ×•×¦×¨×•</p>
                                <p class="text-2xl font-bold text-blue-800" id="modal-account-total-pages">0</p>
                            </div>
                            <svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                        <!-- ×ª×¦×•×’×” ××§×“×™××” ×§×˜× ×” -->
                        <div class="relative bg-white rounded-lg overflow-hidden shadow-sm border border-blue-200 h-24">
                            <div id="modal-total-pages-preview" class="absolute inset-0 bg-gradient-to-br from-blue-100 to-blue-200 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-1">
                                        <span class="text-white text-sm font-bold" id="modal-total-pages-icon">0</span>
                                    </div>
                                    <div class="text-xs text-blue-700 font-medium">×“×¤×™×</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-green-50 to-green-100 p-4 rounded-lg">
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <p class="text-sm font-medium text-green-600">×“×¤×™× ×¤×¢×™×œ×™×</p>
                                <p class="text-2xl font-bold text-green-800" id="modal-account-active-pages">0</p>
                            </div>
                            <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <!-- ×ª×¦×•×’×” ××§×“×™××” ×§×˜× ×” -->
                        <div class="relative bg-white rounded-lg overflow-hidden shadow-sm border border-green-200 h-24">
                            <div id="modal-active-pages-preview" class="absolute inset-0 bg-gradient-to-br from-green-100 to-green-200 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-1">
                                        <span class="text-white text-sm font-bold" id="modal-active-pages-icon">0</span>
                                    </div>
                                    <div class="text-xs text-green-700 font-medium">×¤×¢×™×œ×™×</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-50 to-purple-100 p-4 rounded-lg">
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <p class="text-sm font-medium text-purple-600">×—×™×•×‘ ×—×•×“×©×™</p>
                                <p class="text-2xl font-bold text-purple-800" id="modal-account-monthly-charge">â‚ª0</p>
                            </div>
                            <svg class="w-8 h-8 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                        </div>
                        <!-- ×ª×¦×•×’×” ××§×“×™××” ×§×˜× ×” -->
                        <div class="relative bg-white rounded-lg overflow-hidden shadow-sm border border-purple-200 h-24">
                            <div id="modal-monthly-charge-preview" class="absolute inset-0 bg-gradient-to-br from-purple-100 to-purple-200 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center mx-auto mb-1">
                                        <span class="text-white text-xs font-bold">â‚ª</span>
                                    </div>
                                    <div class="text-xs text-purple-700 font-medium" id="modal-monthly-charge-amount">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 flex justify-end">
                    <button onclick="closeAccountSummaryModal()" class="bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 px-4 rounded-lg font-medium transition-colors">
                        ×¡×’×•×¨
                    </button>
                </div>
            </div>
        </div>
    </div>

</body>
</html>

