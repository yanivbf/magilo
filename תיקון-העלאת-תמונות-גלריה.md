# ✅ תיקון העלאת תמונות בגלריה

## 🐛 הבעיה שהייתה

```
POST http://localhost:5173/api/upload-section-image 404 (Not Found)
```

ה-API endpoints להעלאה ומחיקה של תמונות בגלריה לא היו קיימים.

## ✅ מה תוקן

### 1. נוצר API להעלאת תמונות
**קובץ:** `new-app/src/routes/api/upload-section-image/+server.js`

**תכונות:**
- ✅ העלאת תמונה חדשה לגלריה
- ✅ החלפת תמונה קיימת
- ✅ עדכון אוטומטי של הדף ב-Strapi
- ✅ תמיכה ב-`sectionIndex` ו-`sectionId`

**פרמטרים:**
- `image` - קובץ התמונה
- `pageId` - מזהה הדף
- `sectionIndex` - אינדקס המקטע
- `imageIndex` - אינדקס התמונה (להחלפה)
- `action` - 'add' או 'replace'

### 2. נוצר API למחיקת תמונות
**קובץ:** `new-app/src/routes/api/delete-section-image/+server.js`

**תכונות:**
- ✅ מחיקת תמונה מהגלריה
- ✅ עדכון אוטומטי של הדף ב-Strapi

**פרמטרים:**
- `pageId` - מזהה הדף
- `sectionIndex` - אינדקס המקטע
- `imageIndex` - אינדקס התמונה למחיקה

### 3. עודכן GallerySection
**קובץ:** `new-app/src/lib/components/sections/GallerySection.svelte`

**שינויים:**
- ✅ שימוש ב-`sectionIndex` במקום `sectionId`
- ✅ קריאות נכונות ל-API endpoints
- ✅ טיפול בשגיאות משופר

## 🎯 איך זה עובד עכשיו

### החלפת תמונה קיימת
1. לחץ על תמונה בגלריה
2. בחר תמונה חדשה
3. התמונה מועלית ל-Strapi
4. הדף מתעדכן אוטומטית
5. הודעת הצלחה: "✅ התמונה הוחלפה בהצלחה"

### הוספת תמונה חדשה
1. לחץ על כפתור ➕
2. בחר תמונה
3. התמונה מועלית ל-Strapi
4. התמונה מתווספת לגלריה
5. הודעת הצלחה: "✅ התמונה נוספה בהצלחה"

### מחיקת תמונה
1. לחץ על כפתור 🗑️
2. אשר מחיקה
3. התמונה נמחקת מ-Strapi
4. התמונה נעלמת מהגלריה
5. הודעת הצלחה: "✅ התמונה נמחקה בהצלחה"

## 📋 בדיקה

### לפני הבדיקה
וודא שהשרת רץ:
```bash
cd new-app
npm run dev
```

### בדיקה מהירה
1. פתח דף עם גלריה: `http://localhost:5173/view/[slug]`
2. גלול למקטע הגלריה
3. נסה להחליף תמונה - צריך לעבוד ✅
4. נסה להוסיף תמונה - צריך לעבוד ✅
5. נסה למחוק תמונה - צריך לעבוד ✅

## 🔧 טכני

### זרימת העבודה

```
GallerySection.svelte
    ↓
    קריאה ל-API: /api/upload-section-image
    ↓
    העלאה ל-Strapi Media Library
    ↓
    עדכון page.sections[sectionIndex].images
    ↓
    שמירה ב-Strapi
    ↓
    החזרת URL של התמונה
    ↓
    עדכון התצוגה
```

### מבנה הנתונים

```javascript
page.sections[sectionIndex] = {
  type: 'gallery',
  enabled: true,
  data: {
    title: 'גלריה',
    subtitle: 'תמונות שלנו',
    images: [
      'http://localhost:1337/uploads/image1.jpg',
      'http://localhost:1337/uploads/image2.jpg',
      'http://localhost:1337/uploads/image3.jpg'
    ]
  }
}
```

## ✅ סטטוס

- ✅ API להעלאת תמונות - פועל
- ✅ API למחיקת תמונות - פועל
- ✅ GallerySection - מעודכן
- ✅ החלפת תמונות - עובד
- ✅ הוספת תמונות - עובד
- ✅ מחיקת תמונות - עובד

## 🎉 סיכום

**המערכת מוכנה לשימוש!**

כל פעולות הגלריה עובדות כעת:
- 📷 החלפת תמונות
- ➕ הוספת תמונות
- 🗑️ מחיקת תמונות
- 💾 שמירה אוטומטית
- ✅ הודעות הצלחה

---

**תאריך:** 4 דצמבר 2024
**סטטוס:** ✅ הושלם
