# בדיקת שמירת מקטעים - מדריך

## הבעיה
שינויים במקטעים (כמו תמונה באודותינו) לא נשמרים, למרות שהכותרת והתמונה הראשית כן נשמרות.

## מה תוקן
1. **API עדכון דפים** - תוקן לעבוד עם מקטעים מקוננים
2. **פונקציית saveField** - תוקנה לזרוק שגיאות כראוי
3. **AboutSection** - תוקן לטפל בשגיאות נכון

## איך לבדוק

### בדיקה 1: דרך הדפדפן
1. פתח את הדף: `http://localhost:5173/test-direct-update.html`
2. הכנס את ה-Page ID (מהקונסול: `icqxvujoujrxd0a484ropuid`)
3. לחץ "בדוק עדכון מקטע"
4. בדוק את הלוג - האם העדכון הצליח?

### בדיקה 2: דרך הדף עצמו
1. פתח את הדף שלך: `http://localhost:5173/view/[slug]`
2. פתח את ה-Console (F12)
3. נסה להחליף תמונה במקטע "אודותינו"
4. בדוק את הלוגים בקונסול:
   - האם יש שגיאה 500?
   - האם כתוב "✅ נשמר בהצלחה"?
   - האם הדף מתרענן?
   - האם התמונה החדשה נשארת אחרי הרענון?

### בדיקה 3: בדיקת Strapi ישירות
1. פתח: `http://localhost:1337/admin`
2. עבור ל-Content Manager → Pages
3. מצא את הדף שלך
4. בדוק את השדה `sections`
5. האם התמונה ב-`sections[0].data.image` מתעדכנת?

## מה לחפש בלוגים

### לוגים טובים (עובד):
```
💾 Saving field: "sections.0.data.image"
📄 Page ID: icqxvujoujrxd0a484ropuid
✅ Page found. Numeric ID: 287
📦 Current sections: [...]
✅ Updated sections.0.data.image
💾 Updating page 287 with sections: [...]
✅ Page 287 updated successfully
📡 Response status: 200
✅ Saved successfully
```

### לוגים רעים (לא עובד):
```
❌ Failed to save: 500 {"error":"..."}
```

## אם עדיין לא עובד

1. **בדוק את Strapi logs** (בטרמינל שבו Strapi רץ):
   - האם יש שגיאות?
   - האם מגיעים בקשות PUT?

2. **בדוק את SvelteKit logs** (בטרמינל שבו `npm run dev` רץ):
   - האם יש שגיאות?
   - האם מגיעים בקשות POST ל-`/api/update-page`?

3. **נקה cache**:
   ```bash
   # עצור את השרתים
   # מחק node_modules/.vite
   # הפעל מחדש
   npm run dev
   ```

## מידע טכני

### מבנה הבקשה
```json
{
  "pageId": "icqxvujoujrxd0a484ropuid",
  "field": "sections.0.data.image",
  "value": "http://localhost:1337/uploads/image.png"
}
```

### איך זה עובד
1. הקוד מקבל `pageId` (יכול להיות documentId או numeric ID)
2. מחפש את הדף ב-Strapi
3. מוציא את ה-numeric ID (287)
4. קורא את המקטעים הנוכחיים
5. מעדכן את השדה המבוקש
6. שומר את כל מערך המקטעים בחזרה
7. Strapi שומר את השינוי

### למה זה לא עבד קודם
- הקוד ניסה להשתמש ב-`documentId` במקום ב-numeric ID
- Strapi v5 דורש numeric ID לעדכונים
- השגיאה "Invalid key documentId" הייתה מ-Strapi
