<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ… ×‘×“×™×§×ª ×§×•×œ ×¡×ª×™×• ×‘××¨×§×˜×¤×œ×™×™×¡</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
        }
        .success-badge {
            background: #10b981;
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            display: inline-block;
            margin: 20px auto;
            font-weight: bold;
            text-align: center;
            width: 100%;
        }
        .test-box {
            background: linear-gradient(135deg, #f0f4ff 0%, #ffffff 100%);
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            border: 3px solid #667eea;
        }
        .test-box h3 {
            color: #667eea;
            margin-top: 0;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            margin: 10px 5px;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }
        button:active {
            transform: translateY(0);
        }
        button.stop {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 500;
            text-align: center;
        }
        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #ef4444;
        }
        .status.info {
            background: #dbeafe;
            color: #1e40af;
            border: 2px solid #3b82f6;
        }
        .instructions {
            background: #fffbeb;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-right: 5px solid #f59e0b;
        }
        .instructions h4 {
            color: #f59e0b;
            margin-top: 0;
        }
        .instructions ol {
            margin: 10px 0;
            padding-right: 20px;
        }
        .instructions li {
            margin: 8px 0;
            line-height: 1.6;
        }
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-family: Arial, sans-serif;
            font-size: 16px;
            margin: 10px 0;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .specs {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 14px;
            border-right: 4px solid #3b82f6;
        }
        .specs strong {
            color: #1e40af;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤ ×‘×“×™×§×ª ×§×•×œ ×¡×ª×™×• ×‘××¨×§×˜×¤×œ×™×™×¡</h1>
        <div class="success-badge">âœ… ×”×§×•×œ ×”××§×•×¨×™ ××•×›×Ÿ!</div>
        
        <div class="instructions">
            <h4>ğŸ“‹ ××™×š ×œ×‘×“×•×§?</h4>
            <ol>
                <li>×”×§×œ×“ ×˜×§×¡×˜ ×‘×ª×™×‘×” ×œ××˜×” (××• ×”×©××¨ ××ª ×”×˜×§×¡×˜ ×œ×“×•×’××”)</li>
                <li>×œ×—×¥ ×¢×œ "ğŸ”Š × ×’×Ÿ ×§×•×œ ×¡×ª×™×• ×”××§×•×¨×™"</li>
                <li>×ª×©××¢ ××ª ×”×§×•×œ ×”×¨×•×‘×•×˜×™ ×•×”××”×™×¨ ×©×œ ×¡×ª×™×•!</li>
                <li>×× ×”×§×•×œ × ×©××¢ ×¨×•×‘×•×˜×™ ×•××”×™×¨ - ×–×” ×¢×•×‘×“ ××•×©×œ×! âœ…</li>
            </ol>
        </div>

        <div class="test-box">
            <h3>ğŸ¯ ×‘×“×™×§×ª ×”×§×•×œ ×”××§×•×¨×™</h3>
            
            <div class="specs">
                <strong>××¤×¨×˜ ×˜×›× ×™:</strong><br>
                â€¢ ×§×•×œ: he-IL-Wavenet-A (× ×§×‘×”, Wavenet)<br>
                â€¢ Pitch: -5.0 (×¨×•×‘×•×˜×™)<br>
                â€¢ Speed: 1.35 (××”×™×¨)<br>
                â€¢ Effects: small-bluetooth-speaker-class-device<br>
                â€¢ ×§×¨×™××” ×™×©×™×¨×” ×œ-Google TTS (×›××• ×‘××¢×¨×›×ª ×”×™×©× ×”)
            </div>
            
            <label style="font-weight: bold; color: #667eea;">×˜×§×¡×˜ ×œ×‘×“×™×§×”:</label>
            <textarea id="testText" rows="3">×”×™×™! ×× ×™ ×¡×ª×™×•, ×”×¢×•×–×¨×ª ×”×“×™×’×™×˜×œ×™×ª ×©×œ×š. ×× ×™ ×›××Ÿ ×œ×¢×–×•×¨ ×œ×š ×œ××¦×•× ××ª ×”×“×£ ×”××•×©×œ× ×‘××¨×§×˜×¤×œ×™×™×¡!</textarea>
            
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="testStavVoice()">ğŸ”Š × ×’×Ÿ ×§×•×œ ×¡×ª×™×• ×”××§×•×¨×™</button>
                <button class="stop" onclick="stopAudio()">â¹ï¸ ×¢×¦×•×¨</button>
            </div>
            
            <div id="status" class="status" style="display:none;"></div>
        </div>

        <div class="instructions">
            <h4>âœ… ××” ×××•×¨ ×œ×§×¨×•×ª?</h4>
            <p><strong>×”×§×•×œ ×¦×¨×™×š ×œ×”×™×©××¢:</strong></p>
            <ul>
                <li>âœ… ×¨×•×‘×•×˜×™ ×•×××•×›×Ÿ (×œ× ×˜×‘×¢×™)</li>
                <li>âœ… ××”×™×¨ (1.35x ××”×™×¨×•×ª ×¨×’×™×œ×”)</li>
                <li>âœ… ×¢× ××¤×§×˜ ×¨××§×•×œ ×§×˜×Ÿ</li>
                <li>âœ… ×§×•×œ × ×©×™ ××‘×œ ×œ× ×˜×‘×¢×™</li>
            </ul>
            <p><strong>×× ×”×§×•×œ × ×©××¢ ×›×›×” - ×–×” ×¢×•×‘×“ ××•×©×œ×! ğŸ‰</strong></p>
        </div>

        <div style="background: #e0f2fe; padding: 20px; border-radius: 10px; margin-top: 30px; text-align: center;">
            <h4 style="color: #0369a1; margin-top: 0;">ğŸš€ ××™×¤×” ×œ×‘×“×•×§ ×‘××¢×¨×›×ª?</h4>
            <p style="margin: 10px 0;">
                <a href="http://localhost:5174/marketplace" target="_blank" style="color: #0369a1; font-weight: bold; text-decoration: none; border-bottom: 2px solid #0369a1;">
                    ğŸ“ ×¤×ª×— ××ª ×”××¨×§×˜×¤×œ×™×™×¡
                </a>
            </p>
            <p style="color: #0c4a6e; margin: 5px 0;">×œ×—×¥ ×¢×œ ×”×‘×•×¢×” ×”×¡×’×•×œ×” ×©×œ ×¡×ª×™×• ×•×‘×“×•×§ ××ª ×›×¤×ª×•×¨ ×”×¨××§×•×œ!</p>
        </div>
    </div>

    <script>
        let currentAudio = null;

        function showStatus(message, type = 'info') {
            const el = document.getElementById('status');
            el.textContent = message;
            el.className = 'status ' + type;
            el.style.display = 'block';
        }

        function stopAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio = null;
                showStatus('ğŸ”‡ ×”×§×•×œ × ×¢×¦×¨', 'info');
                console.log('ğŸ”‡ Audio stopped');
            }
        }

        async function testStavVoice() {
            stopAudio();
            
            const text = document.getElementById('testText').value;
            
            if (!text.trim()) {
                showStatus('âŒ ×× × ×”×›× ×¡ ×˜×§×¡×˜', 'error');
                return;
            }
            
            // Clean text (same as in the components)
            const cleanText = text
                .replace(/<[^>]*>/g, '')
                .replace(/&[^;]+;/g, '')
                .replace(/[ğŸ˜ŠğŸ’¡ğŸ“ğŸ“ğŸ“§ğŸ ğŸ’°âœ…âŒğŸ”—ğŸ“„ğŸªğŸ‰ğŸ“ğŸ”§ğŸ‘ï¸ğŸ¯ğŸ”ğŸ“šğŸ“ğŸ”ŠğŸ¤ğŸ”´]/g, '')
                .replace(/\*\*/g, '')
                .replace(/\*/g, '')
                .replace(/\([^)]*\)/g, '')
                .replace(/\.{2,}/g, '')
                .replace(/\n\n+/g, '. ')
                .replace(/\n/g, '. ')
                .replace(/â€¢/g, '')
                .replace(/\|/g, '')
                .replace(/\s+/g, ' ')
                .trim();
            
            showStatus('â³ ××ª×—×‘×¨ ×œ-Google TTS API...', 'info');
            
            try {
                // ğŸ¯ EXACT same implementation as in the components
                const API_KEY = 'AIzaSyBexR71l9bdJ28OKx8P7QhyQDQpqTPa56o';
                
                console.log('ğŸ¤– Calling Google TTS API directly...');
                
                const response = await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        input: { text: cleanText },
                        voice: {
                            languageCode: 'he-IL',
                            name: 'he-IL-Wavenet-A',
                            ssmlGender: 'FEMALE'
                        },
                        audioConfig: {
                            audioEncoding: 'MP3',
                            pitch: -5.0,
                            speakingRate: 1.35,
                            volumeGainDb: 0.0,
                            effectsProfileId: ['small-bluetooth-speaker-class-device']
                        }
                    })
                });

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message);
                }
                
                if (data.audioContent) {
                    showStatus('âœ… ×× ×’×Ÿ ××ª ×”×§×•×œ ×”××§×•×¨×™ ×©×œ ×¡×ª×™×•...', 'success');
                    console.log('âœ… Audio received, playing...');
                    
                    // Convert base64 to audio and play (EXACT same way)
                    const audio = new Audio('data:audio/mp3;base64,' + data.audioContent);
                    currentAudio = audio;
                    
                    audio.onended = () => {
                        showStatus('âœ… ×”×§×•×œ ×”×¡×ª×™×™× - ×–×” ×”×§×•×œ ×”××§×•×¨×™! ğŸ‰', 'success');
                        currentAudio = null;
                        console.log('âœ… Speech finished');
                    };
                    
                    audio.onerror = (e) => {
                        console.error('âŒ Audio playback error:', e);
                        showStatus('âŒ ×©×’×™××” ×‘× ×™×’×•×Ÿ ×”××•×“×™×•', 'error');
                        currentAudio = null;
                    };
                    
                    await audio.play();
                } else {
                    throw new Error('No audio content received');
                }
            } catch (error) {
                console.error('âŒ Error:', error);
                showStatus('âŒ ×©×’×™××”: ' + error.message, 'error');
            }
        }

        console.log('ğŸ¤ Test page loaded. Ready to test Stav voice!');
    </script>
</body>
</html>
