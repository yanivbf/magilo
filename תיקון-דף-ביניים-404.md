# ✅ תיקון שגיאת 404 בדף הביניים

## הבעיה
לאחר יצירת דף חדש, המערכת הפנתה ל-`/pages/[slug]` אבל קיבלנו שגיאת 404 עם הודעה:
```
Cannot read properties of undefined (reading 'user')
```

השגיאה הייתה בשורה 30 של `pages/[slug]/+page.server.js` שניסתה לגשת ל-`page.attributes.user` אבל `page.attributes` היה undefined.

## הסיבה
Strapi v5 משתמש בפורמט שטוח (flat format) - הנתונים נמצאים ישירות על אובייקט ה-page, לא תחת `page.attributes`.

**Strapi v4 (ישן):**
```javascript
page.attributes.title
page.attributes.sections.data
```

**Strapi v5 (חדש):**
```javascript
page.title
page.sections
```

## הפתרון
עדכנתי את `new-app/src/routes/pages/[slug]/+page.server.js` לתמוך בשני הפורמטים:

### 1. הוספת משתנה `attrs` שתומך בשני הפורמטים
```javascript
// Handle both Strapi v4 (nested) and v5 (flat) formats
const attrs = page.attributes || page;
```

### 2. החלפת כל הפניות ל-`page.attributes` ב-`attrs`
```javascript
// לפני:
title: page.attributes.title,
sections: page.attributes.sections

// אחרי:
title: attrs.title,
sections: attrs.sections
```

### 3. תיקון בדיקת הבעלות על הדף
```javascript
// v5: attrs.user?.data?.id or attrs.user?.id, v4: attrs.user?.data?.id
const pageOwnerId = attrs.user?.data?.id || attrs.user?.id || attrs.userId;
```

### 4. תיקון טעינת מוצרים ומקטעים
```javascript
// Products
const productsData = Array.isArray(attrs.storeProducts) 
    ? attrs.storeProducts 
    : (attrs.storeProducts?.data || []);

// Sections
const sectionsData = Array.isArray(attrs.sections) 
    ? attrs.sections 
    : (attrs.sections?.data || []);
```

## התוצאה
✅ דף הביניים נטען בהצלחה  
✅ מציג שני כפתורים: "צפה בדף" ו-"נהל דף"  
✅ תומך גם ב-Strapi v4 וגם ב-v5  
✅ אין שגיאות בקונסול  

## מה הלאה?
עכשיו כשהדף הביניים עובד, המשתמש יכול:
1. ללחוץ על "צפה בדף" כדי לראות את הדף המוגמר עם כל המקטעים
2. ללחוץ על "נהל דף" כדי לערוך את הדף (להעלות תמונות, לשנות טקסט, צבעים וכו')

## קבצים ששונו
- `new-app/src/routes/pages/[slug]/+page.server.js` - תיקון תמיכה ב-Strapi v5
